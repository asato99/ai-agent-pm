# Kanban Board Scenario
#
# 単一ワーカーによる看板ボード開発シナリオ

name: kanban-board
description: "看板ボード開発 - ドラッグ&ドロップを含むUIの検証"
version: "1.0"

# プロジェクト設定
project:
  id: pilot-kanban-board
  name: "看板ボード"
  working_directory: /tmp/pilot_kanban_board

# 期待する成果物
expected_artifacts:
  - path: index.html
    description: "メインHTMLファイル"

# タイムアウト設定（秒）
timeouts:
  task_creation: 600
  task_completion: 1800   # 30分（より複雑なため）

# 初期アクション
initial_action:
  type: chat
  from: owner-kanban
  to: worker-dev
  message: |
    看板ボード（カンバンボード）を作成してください。

    ## 機能要件
    - 3つのカラム: To Do, In Progress, Done
    - カードの追加（タイトルを入力して追加）
    - カードの削除
    - ドラッグ&ドロップでカラム間移動
    - ページリロード後も内容が復元される

    ## テスト用識別子（必須）
    以下のdata-testid属性を必ず付与してください：

    カラム:
    - data-testid="column-todo"
    - data-testid="column-in-progress"
    - data-testid="column-done"

    カード追加:
    - 入力欄: data-testid="new-card-input"
    - 追加ボタン: data-testid="add-card-button"

    カード（動的に生成）:
    - 各カード: data-testid="card-{連番}"
    - 削除ボタン: data-testid="delete-card-{連番}"

    作業ディレクトリに保存してください。

# E2Eテストケース
e2e_tests:
  # 構造テスト
  - id: ST-01
    name: "3カラム表示確認"
    steps:
      - action: assert_exists
        selector: '[data-testid="column-todo"]'
      - action: assert_exists
        selector: '[data-testid="column-in-progress"]'
      - action: assert_exists
        selector: '[data-testid="column-done"]'

  - id: ST-02
    name: "カラムヘッダー表示"
    steps:
      - action: assert_text
        selector: '[data-testid="column-todo"]'
        expected: "To Do"
      - action: assert_text
        selector: '[data-testid="column-in-progress"]'
        expected: "In Progress"
      - action: assert_text
        selector: '[data-testid="column-done"]'
        expected: "Done"

  # カード追加テスト
  - id: CA-01
    name: "新規カード作成"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Test Card 1"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 500
      - action: assert_exists
        selector: '[data-testid^="card-"]'

  - id: CA-02
    name: "カードはTo Doに配置"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "New Task"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 500
      - action: assert_text
        selector: '[data-testid="column-todo"]'
        expected: "New Task"

  # カード削除テスト
  - id: CD-01
    name: "カード削除"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "To Delete"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 500
      - action: assert_text
        selector: '[data-testid="column-todo"]'
        expected: "To Delete"
      - action: click
        selector: '[data-testid^="delete-card-"]'
      - action: wait
        timeout: 500
      - action: assert_not_text
        selector: '[data-testid="column-todo"]'
        expected: "To Delete"

  # ドラッグ&ドロップテスト
  - id: DD-01
    name: "To Do → In Progress"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Drag Test 1"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 500
      - action: drag
        from: '[data-testid^="card-"]'
        to: '[data-testid="column-in-progress"]'
      - action: wait
        timeout: 500
      - action: assert_text
        selector: '[data-testid="column-in-progress"]'
        expected: "Drag Test 1"

  - id: DD-02
    name: "In Progress → Done"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Drag Test 2"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 500
      - action: drag
        from: '[data-testid^="card-"]'
        to: '[data-testid="column-in-progress"]'
      - action: wait
        timeout: 500
      - action: drag
        from: '[data-testid="column-in-progress"] [data-testid^="card-"]'
        to: '[data-testid="column-done"]'
      - action: wait
        timeout: 500
      - action: assert_text
        selector: '[data-testid="column-done"]'
        expected: "Drag Test 2"

  - id: DD-03
    name: "Done → To Do（戻し）"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Drag Test 3"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 500
      - action: drag
        from: '[data-testid^="card-"]'
        to: '[data-testid="column-done"]'
      - action: wait
        timeout: 500
      - action: drag
        from: '[data-testid="column-done"] [data-testid^="card-"]'
        to: '[data-testid="column-todo"]'
      - action: wait
        timeout: 500
      - action: assert_text
        selector: '[data-testid="column-todo"]'
        expected: "Drag Test 3"

  # 永続化テスト
  - id: PS-01
    name: "リロード後カード復元"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Persistent Card"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 1000
      - action: reload
      - action: wait
        timeout: 500
      - action: assert_text
        selector: '[data-testid="column-todo"]'
        expected: "Persistent Card"

  - id: PS-02
    name: "カラム位置も復元"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Position Test"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 500
      - action: drag
        from: '[data-testid^="card-"]'
        to: '[data-testid="column-done"]'
      - action: wait
        timeout: 1000
      - action: reload
      - action: wait
        timeout: 500
      - action: assert_text
        selector: '[data-testid="column-done"]'
        expected: "Position Test"

  # 複数カードテスト
  - id: MT-01
    name: "複数カード追加"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Card A"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 300
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Card B"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 300
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Card C"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 500
      - action: assert_text
        selector: '[data-testid="column-todo"]'
        expected: "Card A"
      - action: assert_text
        selector: '[data-testid="column-todo"]'
        expected: "Card B"
      - action: assert_text
        selector: '[data-testid="column-todo"]'
        expected: "Card C"

  - id: MT-02
    name: "複数カラムに分散"
    steps:
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Multi A"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 300
      - action: fill
        selector: '[data-testid="new-card-input"]'
        value: "Multi B"
      - action: click
        selector: '[data-testid="add-card-button"]'
      - action: wait
        timeout: 500
      - action: drag
        from: '[data-testid="column-todo"] [data-testid^="card-"]:first-child'
        to: '[data-testid="column-in-progress"]'
      - action: wait
        timeout: 500
      - action: assert_text
        selector: '[data-testid="column-in-progress"]'
        expected: "Multi A"
      - action: assert_text
        selector: '[data-testid="column-todo"]'
        expected: "Multi B"
