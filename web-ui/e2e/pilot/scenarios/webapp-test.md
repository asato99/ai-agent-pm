# パイロットシナリオ: webapp-test

## 概要

Webアプリケーションのテスト実施シナリオ。
`webapp-testing` スキルの有無による、問題発見効率の差を測定する。

## 目的

- スキル割り当ての効果を定量的に検証
- Webアプリケーションテストにおけるスキルの有用性を評価
- 問題発見までの時間を測定

## 評価指標

| 指標 | 説明 |
|------|------|
| 問題発見時間 | テスト開始から問題報告までの時間 |
| 問題特定精度 | 根本原因を正しく特定できたか |
| 調査プロセス | どのような手順で調査したか |

## エージェント構成

### Owner（人間役 = テストスクリプト）

| 項目 | 値 |
|------|-----|
| ID | `owner-webapp-test` |
| 名前 | テストオーナー |
| 種別 | `human` |
| 階層 | `owner` |

---

### Worker-Tester（AI）

| 項目 | 値 |
|------|-----|
| ID | `worker-tester` |
| 名前 | テストエンジニア |
| 種別 | `ai` |
| 階層 | `worker` |
| 親エージェント | `owner-webapp-test` |
| Provider | `anthropic` |
| Model | `claude-sonnet-4-20250514` |

**システムプロンプト**:

```text
あなたはQAテストエンジニアです。

## 責務
- Webアプリケーションの動作テストを実施する
- 問題を発見した場合、原因を特定して報告する
- テスト結果を明確に記録する

## 行動指針
- 実際にアプリケーションを動かしてテストする
- 正常系・異常系の両方を確認する
- 問題発見時は再現手順と原因を明記する
```

**スキル割り当て（バリエーションで制御）**:
- `with-skill`: `webapp-testing` スキルを割り当て
- `without-skill`: スキル割り当てなし

---

## プロジェクト設定

| 項目 | 値 |
|------|-----|
| ID | `project-webapp-test` |
| 名前 | Webアプリテスト |
| 作業ディレクトリ | `web-ui/e2e/pilot/workspaces/webapp-test` |

## テスト対象アプリケーション

シンプルなショッピングカートアプリ。

### ファイル構成

```
webapp-test/
├── index.html      # UI
├── style.css       # スタイル
├── app.js          # メインロジック
└── data.js         # データ管理（バグの原因箇所）
```

### 埋め込まれた問題

**症状**: ページリロード後、商品追加時に合計金額が異常値になる

**原因**: localStorageからの読み込み時に文字列として取得され、
加算時に文字列連結が発生する

**発見条件**:
1. 商品を追加して合計を確認（正常）
2. ページをリロード
3. 再度商品を追加（異常値が表示）

---

## テスト実行フロー

### Phase 1: 準備

1. 作業ディレクトリをクリーンアップ
2. テスト対象アプリケーションを配置
3. エージェントをDBに登録

### Phase 2: テスト指示

テストスクリプトが Owner 役として以下のメッセージを送信：

```
作業ディレクトリにあるショッピングカートアプリケーションのテストを実施してください。

アプリの概要:
- 商品を追加すると合計金額が計算される
- カートの状態はブラウザに保存される

確認観点:
- 商品追加機能が正しく動作するか
- 合計金額の計算が正しいか
- ページリロード後も正しく動作するか

問題を発見した場合は、再現手順と原因を報告してください。
```

### Phase 3: テスト実行（AIエージェントが実行）

Worker-Tester がテストを実施：
1. アプリケーションを起動
2. 基本機能をテスト
3. リロード後の動作をテスト
4. 問題を発見・報告

### Phase 4: 結果評価

テストスクリプトが以下を記録：
1. 問題発見までの時間
2. 報告された問題の正確性
3. 原因特定の正確性

---

## 成功基準

| # | 基準 | 検証方法 |
|---|------|----------|
| 1 | テストが実施される | Playwrightの実行ログ |
| 2 | 問題が報告される | タスクコンテキストに問題記載 |
| 3 | 原因が特定される | 「localStorage」「型変換」等のキーワード |

## バリエーション

### with-skill

`webapp-testing` スキルを割り当てた状態でテスト。
スキルの「Reconnaissance パターン」やコンソール確認の指針が活用されることを期待。

### without-skill

スキル割り当てなしでテスト。
エージェントの基本能力のみで問題を発見できるか確認。

## 比較ポイント

| 観点 | with-skill | without-skill |
|------|------------|---------------|
| 発見時間 | 短い（期待） | 長い（予想） |
| 調査手順 | 体系的 | 試行錯誤的 |
| 原因特定 | 正確 | 表層的 |

## 所要時間（想定）

| フェーズ | 時間 |
|----------|------|
| 準備 | 30秒 |
| テスト指示 | 30秒 |
| テスト実行 | 5〜15分 |
| 結果評価 | 30秒 |
| **合計** | **約10〜20分** |

## 期待される報告例

### 理想的な報告

```
## 発見した問題

### 症状
ページリロード後に商品を追加すると、合計金額が
「150100」のような異常値になる。

### 再現手順
1. 商品を追加（例: りんご 100円）
2. ページをリロード
3. 別の商品を追加（例: バナナ 50円）
4. 合計が「10050」と表示される（期待値: 150）

### 原因
data.js の loadCart() 関数で localStorage から値を取得する際、
文字列として返される。その後 app.js で数値と加算すると
文字列連結が発生する。

### 修正案
loadCart() で Number() または parseInt() を使用して
数値に変換する。
```
