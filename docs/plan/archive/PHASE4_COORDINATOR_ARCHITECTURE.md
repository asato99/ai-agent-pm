# Phase 4: Coordinator + Agent ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

Phase 3ã®Runnerå®Ÿè£…ã‚’ç™ºå±•ã•ã›ã€è²¬å‹™ã‚’ã‚ˆã‚Šæ˜ç¢ºã«åˆ†é›¢ã—ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‚

---

> ## ğŸš¨ è‡´å‘½çš„ãªè¨­è¨ˆé•åè­¦å‘Š (2026-01-09)
>
> **ç¾åœ¨ã®å®Ÿè£…ã«ã¯è‡´å‘½çš„ãªè¨­è¨ˆé•åãŒã‚ã‚Šã¾ã™ã€‚**
>
> ### å•é¡Œç‚¹
>
> | é•åé …ç›® | å•é¡Œã®å†…å®¹ | æ­£ã—ã„è¨­è¨ˆ |
> |---------|-----------|-----------|
> | `mcp_server_command` | CoordinatorãŒã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’ä¿æŒ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯èµ·å‹•ã‚’çŸ¥ã‚‹ã¹ãã§ãªã„ |
> | `mcp_database_path` | CoordinatorãŒDBãƒ‘ã‚¹ã‚’ä¿æŒ | DBã¯å†…éƒ¨å®Ÿè£…è©³ç´° |
> | stdio transport | Agent Instanceã”ã¨ã«æ–°ã—ã„MCPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹• | å…¨å“¡ãŒåŒã˜ãƒ‡ãƒ¼ãƒ¢ãƒ³ã«æ¥ç¶šã™ã¹ã |
>
> ### è¨­è¨ˆåŸå‰‡é•å
>
> **Coordinator/Runnerã¯ã€Œç´”ç²‹ãªMCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã§ã‚ã‚‹ã¹ãï¼š**
> - âŒ ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•/åœæ­¢ã‚’åˆ¶å¾¡ã—ã¦ã¯ãªã‚‰ãªã„
> - âŒ DBãƒ‘ã‚¹ãªã©ã®å†…éƒ¨å®Ÿè£…è©³ç´°ã‚’çŸ¥ã£ã¦ã¯ãªã‚‰ãªã„
> - âœ… ã‚½ã‚±ãƒƒãƒˆãƒ‘ã‚¹ã ã‘ã‚’çŸ¥ã‚Šã€æ¥ç¶šã™ã‚‹ã ã‘
>
> ### ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆå•é¡Œã‚ã‚Šï¼‰
>
> ```
> [ã‚¢ãƒ—ãƒª]
> â””â”€ MCPãƒ‡ãƒ¼ãƒ¢ãƒ³èµ·å‹• (Unix Socket, DB=X)
>
> [Coordinator] â† å•é¡Œï¼
> â”œâ”€ mcp_socket_path â†’ âœ“
> â”œâ”€ mcp_server_command â†’ âœ— ä¸è¦
> â”œâ”€ mcp_database_path â†’ âœ— ä¸è¦
>
> [Agent Instance]
> â””â”€ --mcp-config ã§æ–°ã—ã„MCPã‚µãƒ¼ãƒãƒ¼(stdio)ã‚’èµ·å‹• â† è‡´å‘½çš„ï¼
>    â””â”€ 2ã¤ã®ç‹¬ç«‹ã—ãŸã‚µãƒ¼ãƒãƒ¼ãŒåŒã˜DBã«ã‚¢ã‚¯ã‚»ã‚¹
> ```
>
> ### æ­£ã—ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
>
> ```
> [ã‚¢ãƒ—ãƒª]
> â””â”€ MCPãƒ‡ãƒ¼ãƒ¢ãƒ³èµ·å‹• (å”¯ä¸€ã®MCPã‚µãƒ¼ãƒãƒ¼)
>
> [Coordinator] (ç´”ç²‹ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)
> â””â”€ mcp_socket_path ã®ã¿
>
> [Agent Instance]
> â””â”€ åŒã˜Unix Socketã«æ¥ç¶š
> ```
>
> ### ä¿®æ­£ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«
>
> - `runner/src/aiagent_runner/coordinator_config.py` - ä¸è¦ãªè¨­å®šé …ç›®ã‚’å‰Šé™¤
> - `runner/src/aiagent_runner/coordinator.py` - stdio transport ã‚’ Unix Socket ã«å¤‰æ›´
> - `scripts/tests/test_uc002_app_integration.sh` - ä¸è¦ãªè¨­å®šã‚’å‰Šé™¤
> - `scripts/tests/test_uc003_app_integration.sh` - ä¸è¦ãªè¨­å®šã‚’å‰Šé™¤

---

> **âš ï¸ é‡è¦: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦**
>
> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯**å°†æ¥ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»**ã§ã™ã€‚
>
> | é …ç›® | èª¬æ˜ |
> |-----|------|
> | **ç¾åœ¨ã®å®Ÿè£…** | `runner/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®RunnerãŒã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆCoordinatorï¼‰ã¨ã—ã¦å‹•ä½œä¸­ |
> | **Phase 4ã®ç›®çš„** | Runnerã®è²¬å‹™ã‚’åˆ†é›¢ã—ã€ã‚ˆã‚Šã‚¯ãƒªãƒ¼ãƒ³ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° |
> | **Coordinatorã¨ã¯** | æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ãªãã€Runnerã®å½¹å‰²ã®ä¸€éƒ¨ã‚’æŒ‡ã™å‘¼ç§° |
>
> **ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆPhase 3ï¼‰**ã‚’ç†è§£ã™ã‚‹ã«ã¯ `PHASE3_PULL_ARCHITECTURE.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## æ¦‚è¦

### è¨­è¨ˆåŸå‰‡

1. **è²¬å‹™ã®æ˜ç¢ºãªåˆ†é›¢**: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯å¿…è¦æœ€å°é™ã®æƒ…å ±ã®ã¿ã‚’æŒã¤
2. **ã‚«ãƒ—ã‚»ãƒ«åŒ–**: å†…éƒ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆ`in_progress`ç­‰ï¼‰ã¯å¤–éƒ¨ã«å…¬é–‹ã—ãªã„
3. **æ±ç”¨æ€§**: Claude Codeä»¥å¤–ã®MCPå¯¾å¿œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åˆ©ç”¨å¯èƒ½
4. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã®å®Ÿè¡Œåˆ†é›¢**: åŒä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã‚‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒç•°ãªã‚Œã°åˆ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

### å¤‰æ›´ã®èƒŒæ™¯

Phase 3ã§ã¯ã€RunnerãŒä»¥ä¸‹ã®è²¬å‹™ã‚’æŒã£ã¦ã„ãŸï¼š
- ãƒãƒ¼ãƒªãƒ³ã‚°
- ã‚¿ã‚¹ã‚¯è©³ç´°ã®æŠŠæ¡
- CLIå®Ÿè¡Œ
- çµæœå ±å‘Š

ã“ã‚Œã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†é›¢ã™ã‚‹ï¼š
- **Coordinator**: èµ·å‹•åˆ¤æ–­ã®ã¿ï¼ˆã‚¿ã‚¹ã‚¯è©³ç´°ã¯çŸ¥ã‚‰ãªã„ï¼‰
- **Agent Instance**: MCPã¨ã®å…¨ã‚„ã‚Šã¨ã‚Šã€ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ

```
Phase 3: Runner ãŒã™ã¹ã¦ã‚’ç®¡ç†
Phase 4: Coordinatorï¼ˆèµ·å‹•åˆ¤æ–­ï¼‰+ Agent Instanceï¼ˆå®Ÿè¡Œï¼‰ã«åˆ†é›¢
```

### ç”¨èªå®šç¾©

| ç”¨èª | èª¬æ˜ |
|------|------|
| **Coordinator** | Agent Instanceã‚’ç®¡ç†ã™ã‚‹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆãƒ‡ãƒ¼ãƒ¢ãƒ³ï¼‰ |
| **Agent Instance** | ç‰¹å®šã®(agent_id, project_id)ã«ç´ã¥ãå®Ÿè¡Œãƒ—ãƒ­ã‚»ã‚¹ |
| **Agent** | ã‚¢ãƒ—ãƒªå´ã§å®šç¾©ã•ã‚Œã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ï¼ˆsystem_prompt, ai_typeç­‰ï¼‰ |
| **Project** | ä½œæ¥­å¯¾è±¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆworking_directory ã‚’æŒã¤ï¼‰ |

### ç®¡ç†å˜ä½

**é‡è¦**: Agent Instanceã®ç®¡ç†å˜ä½ã¯ `(agent_id, project_id)` ã®çµ„ã¿åˆã‚ã›

```
åŒä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ Ã— è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ â†’ åˆ¥ã€…ã®Agent Instance

Project A (working_dir: /proj_a)
â””â”€â”€ Agent X ã®ã‚¿ã‚¹ã‚¯
    â†’ Agent Instance 1 (agent=X, project=A, cwd=/proj_a)

Project B (working_dir: /proj_b)
â””â”€â”€ Agent X ã®ã‚¿ã‚¹ã‚¯
    â†’ Agent Instance 2 (agent=X, project=B, cwd=/proj_b)
```

ã“ã‚Œã«ã‚ˆã‚Šï¼š
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ã®ä½œæ¥­ãŒå¹²æ¸‰ã—ãªã„
- å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯é©åˆ‡ãªworking_directoryã§å‹•ä½œ
- ä¸¦åˆ—å®Ÿè¡ŒãŒå¯èƒ½

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Coordinator                                  â”‚
â”‚                                                                      â”‚
â”‚  è²¬å‹™:                                                               â”‚
â”‚  - MCPã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ç¢ºèªï¼ˆãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰                             â”‚
â”‚  - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨å‰²ã‚Šå½“ã¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å–å¾—                    â”‚
â”‚  - å„(agent_id, project_id)ã®èµ·å‹•åˆ¤æ–­                                â”‚
â”‚  - Agent Instanceãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•ï¼ˆworking_directoryæŒ‡å®šï¼‰              â”‚
â”‚                                                                      â”‚
â”‚  çŸ¥ã‚‰ãªã„ã“ã¨:                                                        â”‚
â”‚  - ã‚¿ã‚¹ã‚¯ã®å†…å®¹ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹                                           â”‚
â”‚  - MCPã®å†…éƒ¨æ§‹é€                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ 1. health_check()
                               â”‚ 2. list_active_projects_with_agents()
                               â”‚ 3. should_start(agent_id, project_id) Ã— N
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MCP Server                                  â”‚
â”‚                                                                      â”‚
â”‚  Coordinatorå‘ã‘API:                                                 â”‚
â”‚  - health_check() â†’ { status }                                      â”‚
â”‚  - list_active_projects_with_agents()                               â”‚
â”‚      â†’ { projects: [{project_id, working_directory, agents}, ...] } â”‚
â”‚  - should_start(agent_id, project_id) â†’ { should_start, ai_type }   â”‚
â”‚                                                                      â”‚
â”‚  Agent Instanceå‘ã‘API:                                              â”‚
â”‚  - authenticate(agent_id, passkey, project_id)                      â”‚
â”‚      â†’ {token, system_prompt, instruction}                          â”‚
â”‚  - get_my_task(token) â†’ task details                                â”‚
â”‚  - report_completed(token, result)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–²
                               â”‚ èªè¨¼å¾Œã€ç›´æ¥ã‚„ã‚Šã¨ã‚Š
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Agent Instance                                 â”‚
â”‚                      (Claude Codeç­‰)                                 â”‚
â”‚                                                                      â”‚
â”‚  1. èµ·å‹•ã•ã‚Œã‚‹ï¼ˆagent_id, passkey, project_id, working_dirï¼‰          â”‚
â”‚  2. authenticate(project_idå«ã‚€) â†’ system_prompt, instruction        â”‚
â”‚  3. instruction ã«å¾“ã„ get_my_task() ã‚’å‘¼ã¶                          â”‚
â”‚  4. ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œï¼ˆworking_directoryå†…ã§ï¼‰                             â”‚
â”‚  5. report_completed() ã§å®Œäº†å ±å‘Š                                    â”‚
â”‚  6. çµ‚äº†                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŸ¥è­˜ç¯„å›²

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | çŸ¥ã£ã¦ã„ã‚‹ | çŸ¥ã‚‰ãªã„ |
|--------------|-----------|---------|
| **Coordinator** | MCPã‚µãƒ¼ãƒãƒ¼ã®çŠ¶æ…‹ã€projectä¸€è¦§ã€å„projectã®å‰²ã‚Šå½“ã¦agentã€passkey | ã‚¿ã‚¹ã‚¯ã®å†…å®¹ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| **Agent Instance** | è‡ªåˆ†ã®agent_idã€project_idã€èªè¨¼æƒ…å ±ã€ã‚¿ã‚¹ã‚¯è©³ç´°ã€working_directory | ä»–ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æƒ…å ± |
| **MCP Server** | ã™ã¹ã¦ | - |

---

## MCP APIè¨­è¨ˆ

### Coordinatorå‘ã‘API

#### health_check

MCPã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã€‚Coordinatorã¯ã¾ãšã“ã‚Œã‚’å‘¼ã³å‡ºã—ã¦ã‚µãƒ¼ãƒãƒ¼ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèªã™ã‚‹ã€‚

```python
health_check() â†’ {
    "status": "ok",
    "version": "1.0.0",
    "timestamp": "2025-01-06T10:00:00Z"
}

# ã‚µãƒ¼ãƒãƒ¼ç•°å¸¸æ™‚ï¼ˆæ¥ç¶šã‚¨ãƒ©ãƒ¼ç­‰ï¼‰
# â†’ æ¥ç¶šè‡ªä½“ãŒå¤±æ•—ã™ã‚‹ãŸã‚ã€Coordinatorã¯ãƒªãƒˆãƒ©ã‚¤ã¾ãŸã¯ã‚¹ã‚­ãƒƒãƒ—
```

**ç”¨é€”**:
- ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª
- æ¥ç¶šãƒ†ã‚¹ãƒˆ
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªï¼ˆå°†æ¥ã®äº’æ›æ€§ãƒã‚§ãƒƒã‚¯ç”¨ï¼‰

#### list_active_projects_with_agents

ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã¨ã€å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å–å¾—ã™ã‚‹ã€‚

```python
list_active_projects_with_agents() â†’ {
    "success": true,
    "projects": [
        {
            "project_id": "prj_frontend",
            "project_name": "Frontend App",
            "working_directory": "/projects/frontend",
            "agents": ["agt_developer", "agt_reviewer"]
        },
        {
            "project_id": "prj_backend",
            "project_name": "Backend API",
            "working_directory": "/projects/backend",
            "agents": ["agt_developer", "agt_infra"]
        }
    ]
}
```

**å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå†…éƒ¨ï¼‰**:
- `active` çŠ¶æ…‹ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¿è¿”ã™
- å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸ `active` çŠ¶æ…‹ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆIDã‚’è¿”ã™
- working_directoryã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å–å¾—

**é‡è¦**:
- åŒä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç™»å ´å¯èƒ½
- Coordinatorã¯å„ (agent_id, project_id) ã®çµ„ã¿åˆã‚ã›ã‚’å€‹åˆ¥ã«ç®¡ç†

#### should_start

ç‰¹å®šã®(agent_id, project_id)ã®çµ„ã¿åˆã‚ã›ã§Agent Instanceã‚’èµ·å‹•ã™ã¹ãã‹ã‚’è¿”ã™ã€‚

```python
should_start(
    agent_id: str,
    project_id: str
) â†’ {
    "should_start": true | false,
    "ai_type": "claude"  # should_start ãŒ true ã®å ´åˆã®ã¿
}
```

**å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå†…éƒ¨ï¼‰**:
- è©²å½“ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§è©²å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚¢ã‚µã‚¤ãƒ³ã•ã‚ŒãŸ `in_progress` ã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹
- ã‹ã¤ã€è©²å½“ (agent_id, project_id) ã®Agent InstanceãŒå®Ÿè¡Œä¸­ã§ãªã„
- â†’ `true` + `ai_type`
- ãã‚Œä»¥å¤– â†’ `false`

**é‡è¦**:
- ã‚¿ã‚¹ã‚¯æƒ…å ±ã¯å«ã‚ãªã„ï¼ˆCoordinatorã¯ã‚¿ã‚¹ã‚¯ã®å­˜åœ¨ã‚’çŸ¥ã‚‹å¿…è¦ãŒãªã„ï¼‰
- `ai_type` ã¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ã‹ã‚‰å–å¾—ã—ã€CoordinatorãŒé©åˆ‡ãªCLIã‚’é¸æŠã™ã‚‹ãŸã‚ã«ä½¿ç”¨
- å®Ÿè¡ŒçŠ¶æ…‹ã¯ (agent_id, project_id) å˜ä½ã§ç®¡ç†

### Agent Instanceå‘ã‘API

#### authenticateï¼ˆæ‹¡å¼µï¼‰

èªè¨¼å¾Œã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²ï¼ˆsystem_promptï¼‰ã¨æ¬¡ã«ä½•ã‚’ã™ã¹ãã‹ã® instruction ã‚’è¿”ã™ã€‚
project_idã‚’å«ã‚ã‚‹ã“ã¨ã§ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç‰¹å®šã®(agent_id, project_id)ã«ç´ã¥ãã€‚

```python
authenticate(
    agent_id: str,
    passkey: str,
    project_id: str
) â†’ {
    "success": true,
    "session_token": "sess_xxxxx",
    "expires_in": 3600,
    "agent_name": "frontend-dev",
    "project_name": "Frontend App",
    "system_prompt": "ã‚ãªãŸã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ã§ã™...",  # DBã‹ã‚‰å–å¾—
    "instruction": "get_my_task ã‚’å‘¼ã³å‡ºã—ã¦ã‚¿ã‚¹ã‚¯è©³ç´°ã‚’å–å¾—ã—ã¦ãã ã•ã„"
}

# èªè¨¼å¤±æ•—æ™‚
{
    "success": false,
    "error": "Invalid agent_id or passkey"
}

# æ—¢ã«å®Ÿè¡Œä¸­ã®å ´åˆ
{
    "success": false,
    "error": "Agent instance already running for this project"
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `system_prompt` ã¯ã‚¢ãƒ—ãƒªå´ï¼ˆDBï¼‰ã§ç®¡ç†ã•ã‚Œã€èªè¨¼æ™‚ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¸¡ã•ã‚Œã‚‹
- `project_id` ã«ã‚ˆã‚Šã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç´ã¥ã
- åŒä¸€ (agent_id, project_id) ã®äºŒé‡èµ·å‹•ã‚’é˜²æ­¢
- Coordinatorã¯èªè¨¼æƒ…å ±ã®ã¿ä¿æŒï¼ˆã‚·ãƒ³ãƒ—ãƒ«åŒ–ï¼‰
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²å¤‰æ›´ãŒã‚¢ãƒ—ãƒªUIã§å®Œçµ
- Single Source of Truth

#### get_my_task

èªè¨¼æ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯ã‚’å–å¾—ã€‚

```python
get_my_task(
    session_token: str
) â†’ {
    "success": true,
    "has_task": true,
    "task": {
        "task_id": "tsk_xxx",
        "title": "æ©Ÿèƒ½å®Ÿè£…",
        "description": "ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®UIã‚’å®Ÿè£…ã™ã‚‹",
        "working_directory": "/path/to/project",
        "context": { ... },      # å‰å›ã®é€²æ—ç­‰
        "handoff": { ... }       # å¼•ãç¶™ãæƒ…å ±ï¼ˆã‚ã‚Œã°ï¼‰
    },
    "instruction": "ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã—ãŸã‚‰ report_completed ã‚’å‘¼ã³å‡ºã—ã¦ãã ã•ã„"
}

# ã‚¿ã‚¹ã‚¯ãŒãªã„å ´åˆ
{
    "success": true,
    "has_task": false,
    "instruction": "ç¾åœ¨å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“"
}
```

#### report_completed

ã‚¿ã‚¹ã‚¯å®Œäº†ã‚’å ±å‘Šã€‚

```python
report_completed(
    session_token: str,
    result: str,           # "success" | "failed" | "blocked"
    summary: str = None,   # ä½œæ¥­ã‚µãƒãƒªãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    next_steps: str = None # æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
) â†’ {
    "success": true,
    "instruction": "ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã—ã¾ã™ã€‚"
}
```

---

## Coordinatorå®Ÿè£…

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```yaml
# coordinator_config.yaml

polling_interval: 10  # ç§’
max_concurrent: 3     # åŒæ™‚å®Ÿè¡Œæ•°
mcp_socket_path: ~/Library/Application Support/AIAgentPM/mcp.sock

# AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã”ã¨ã®èµ·å‹•æ–¹æ³•
ai_providers:
  claude:
    cli_command: claude
    cli_args: ["--dangerously-skip-permissions"]
  gemini:
    cli_command: gemini-cli
    cli_args: ["--project", "my-project"]
  codex:
    cli_command: codex
    cli_args: []

# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèªè¨¼æƒ…å ±
# æ³¨æ„:
# - ç›£è¦–å¯¾è±¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ list_active_projects_with_agents ã§å‹•çš„å–å¾—
# - ai_type, system_prompt ã¯ã‚¢ãƒ—ãƒªå´ï¼ˆDBï¼‰ã§ç®¡ç†
# - working_directory ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å–å¾—ï¼ˆã“ã“ã§ã¯æŒ‡å®šã—ãªã„ï¼‰
agents:
  agt_developer:
    passkey: ${DEV_PASSKEY}

  agt_reviewer:
    passkey: ${REVIEWER_PASSKEY}

  agt_infra:
    passkey: ${INFRA_PASSKEY}
```

**è¨­å®šé …ç›®**:

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | é …ç›® | èª¬æ˜ |
|-----------|------|------|
| `ai_providers` | `cli_command` | AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®CLIã‚³ãƒãƒ³ãƒ‰ |
| `ai_providers` | `cli_args` | CLIå¼•æ•° |
| `agents` | `passkey` | èªè¨¼ç”¨ãƒ‘ã‚¹ã‚­ãƒ¼ï¼ˆå¿…é ˆï¼‰ |

**ãƒã‚¤ãƒ³ãƒˆ**:
- `ai_type` ã¨ `system_prompt` ã¯ã‚¢ãƒ—ãƒªå´ã§ç®¡ç†ï¼ˆSingle Source of Truthï¼‰
- `working_directory` ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å–å¾—ï¼ˆCoordinatorè¨­å®šã«ã¯å«ã‚ãªã„ï¼‰
- åŒä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ã‚ã‚Œã¦ã‚‚ã€passkeyè¨­å®šã¯1ã¤ã§OK

### ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—

```python
class Coordinator:
    async def run(self):
        while self.running:
            # Step 1: MCPã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª
            try:
                health = await self.mcp_client.health_check()
                if health.status != "ok":
                    logger.warning("MCP server unhealthy, skipping cycle")
                    await asyncio.sleep(self.polling_interval)
                    continue
            except ConnectionError:
                logger.error("MCP server not available, retrying...")
                await asyncio.sleep(self.polling_interval)
                continue

            # Step 2: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨å‰²ã‚Šå½“ã¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸€è¦§ã‚’å–å¾—
            try:
                result = await self.mcp_client.list_active_projects_with_agents()
                projects = result.projects
            except MCPError as e:
                logger.error(f"Failed to get project list: {e}")
                await asyncio.sleep(self.polling_interval)
                continue

            # Step 3: å„ (project, agent) ã®çµ„ã¿åˆã‚ã›ã§èµ·å‹•åˆ¤æ–­
            for project in projects:
                project_id = project.project_id
                working_dir = project.working_directory

                for agent_id in project.agents:
                    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«passkeyè¨­å®šãŒãªã„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—
                    if agent_id not in self.agents:
                        logger.debug(f"No passkey config for {agent_id}, skipping")
                        continue

                    # èµ·å‹•ã™ã¹ãã‹ç¢ºèª
                    try:
                        result = await self.mcp_client.should_start(agent_id, project_id)
                        if result.should_start:
                            self.spawn_agent_instance(
                                agent_id=agent_id,
                                project_id=project_id,
                                working_dir=working_dir,
                                ai_type=result.ai_type
                            )
                    except MCPError as e:
                        logger.error(f"Failed to check {agent_id}/{project_id}: {e}")

            await asyncio.sleep(self.polling_interval)

    def spawn_agent_instance(
        self,
        agent_id: str,
        project_id: str,
        working_dir: str,
        ai_type: str
    ):
        """Agent Instanceãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•

        èµ·å‹•æ™‚ã«æ¸¡ã™æƒ…å ±:
        - agent_id: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè­˜åˆ¥å­
        - project_id: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè­˜åˆ¥å­
        - passkey: èªè¨¼ç”¨ãƒ‘ã‚¹ã‚­ãƒ¼
        - working_directory: ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆcwd ã¨ã—ã¦è¨­å®šï¼‰
        """
        agent_config = self.agents[agent_id]
        passkey = agent_config["passkey"]

        # ai_type ã‹ã‚‰èµ·å‹•æ–¹æ³•ã‚’å–å¾—
        provider = self.ai_providers.get(ai_type, self.ai_providers["claude"])
        cli_command = provider["cli_command"]
        cli_args = provider.get("cli_args", [])

        # èµ·å‹•æ™‚ã«æ¸¡ã™æƒ…å ±ï¼ˆç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®šï¼‰
        env = os.environ.copy()
        env["AGENT_ID"] = agent_id
        env["PROJECT_ID"] = project_id
        env["AGENT_PASSKEY"] = passkey
        env["WORKING_DIRECTORY"] = working_dir

        # èªè¨¼æƒ…å ± + æ‰‹é †ï¼ˆsystem_prompt ã¯ authenticate ã§å–å¾—ï¼‰
        prompt = f"""
Agent ID: {agent_id}
Project ID: {project_id}
Passkey: {passkey}

æ‰‹é †:
1. authenticate(agent_id="{agent_id}", passkey="{passkey}", project_id="{project_id}") ã§èªè¨¼
2. è¿”ã•ã‚ŒãŸ system_prompt ãŒã‚ãªãŸã®å½¹å‰²ã§ã™ã€‚ãã®å½¹å‰²ã«å¾“ã£ã¦è¡Œå‹•ã—ã¦ãã ã•ã„
3. get_my_task() ã§ã‚¿ã‚¹ã‚¯å–å¾—
4. ã‚¿ã‚¹ã‚¯å®Ÿè¡Œï¼ˆã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: {working_dir}ï¼‰
5. report_completed() ã§å®Œäº†å ±å‘Š
"""
        subprocess.Popen(
            [cli_command, *cli_args, "-p", prompt],
            cwd=working_dir,  # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®working_directoryã§èµ·å‹•
            env=env           # ç’°å¢ƒå¤‰æ•°ã§ã‚‚æƒ…å ±ã‚’æ¸¡ã™
        )
        logger.info(f"Spawned agent instance {agent_id}/{project_id} with {ai_type} at {working_dir}")
```

---

## å†ªç­‰æ€§ã¨å®Ÿè¡ŒçŠ¶æ…‹ç®¡ç†

### è¨­è¨ˆåŸå‰‡

Coordinatorã®é‡è¤‡èµ·å‹•ã‚’é˜²ããŸã‚ã€**MCPã‚µãƒ¼ãƒãƒ¼å´ã§å®Ÿè¡ŒçŠ¶æ…‹ã‚’ç®¡ç†**ã™ã‚‹ã€‚
å®Ÿè¡ŒçŠ¶æ…‹ã¯ **(agent_id, project_id) å˜ä½**ã§ç®¡ç†ã•ã‚Œã‚‹ã€‚

```
å®Ÿè¡ŒçŠ¶æ…‹ã®é·ç§»ï¼ˆagent_id, project_id å˜ä½ï¼‰:

  idle â”€â”€[authenticateæˆåŠŸ]â”€â”€â–º running â”€â”€[report_completed]â”€â”€â–º idle
                                  â”‚
                                  â””â”€â”€[ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé™åˆ‡ã‚Œ/ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ]â”€â”€â–º idle
```

### ãƒ¡ãƒªãƒƒãƒˆ

- **Single Source of Truth**: çŠ¶æ…‹ç®¡ç†ãŒMCPã‚µãƒ¼ãƒãƒ¼ã«é›†ç´„
- **CoordinatorãŒã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹**: ã€Œèµ·å‹•æ¸ˆã¿ã€ãƒªã‚¹ãƒˆã‚’æŒã¤å¿…è¦ãŒãªã„
- **è¤‡æ•°Coordinatorå¯¾å¿œ**: CoordinatorãŒè¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚ã£ã¦ã‚‚ç«¶åˆã—ãªã„
- **ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒªã‚«ãƒãƒªãƒ¼**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§è‡ªå‹•å¾©æ—§
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ†é›¢**: åŒä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã‚‚ç•°ãªã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½

### should_start ã®å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯

```python
def should_start(agent_id: str, project_id: str) -> ShouldStartResult:
    agent = get_agent(agent_id)
    project = get_project(project_id)

    # 1. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¾ãŸã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã—ãªã„ â†’ false
    if not agent or not project:
        return ShouldStartResult(should_start=False)

    # 2. è©²å½“ (agent_id, project_id) ã§æ—¢ã«å®Ÿè¡Œä¸­ â†’ false
    if has_active_session(agent_id, project_id):
        return ShouldStartResult(should_start=False)

    # 3. è©²å½“ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§è©²å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚¢ã‚µã‚¤ãƒ³ã•ã‚ŒãŸ in_progress ã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹ã‹
    has_task = has_in_progress_task(agent_id, project_id)

    if has_task:
        return ShouldStartResult(should_start=True, ai_type=agent.ai_type)
    else:
        return ShouldStartResult(should_start=False)
```

### authenticate ã§ã®çŠ¶æ…‹é·ç§»

```python
def authenticate(agent_id: str, passkey: str, project_id: str) -> AuthResult:
    agent = get_agent(agent_id)
    project = get_project(project_id)

    # èªè¨¼ãƒã‚§ãƒƒã‚¯
    if not agent or agent.passkey != passkey:
        return AuthResult(success=False, error="Invalid credentials")

    if not project:
        return AuthResult(success=False, error="Project not found")

    # è©²å½“ (agent_id, project_id) ã§æ—¢ã«å®Ÿè¡Œä¸­ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ï¼ˆäºŒé‡èµ·å‹•é˜²æ­¢ï¼‰
    if has_active_session(agent_id, project_id):
        return AuthResult(success=False, error="Agent instance already running for this project")

    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ â†’ å®Ÿè¡Œä¸­çŠ¶æ…‹ã«é·ç§»
    session = create_session(agent_id, project_id, expires_in=3600)

    return AuthResult(
        success=True,
        session_token=session.token,
        expires_in=session.expires_in,
        agent_name=agent.name,
        project_name=project.name,
        system_prompt=agent.system_prompt,
        instruction="get_my_task ã‚’å‘¼ã³å‡ºã—ã¦ã‚¿ã‚¹ã‚¯è©³ç´°ã‚’å–å¾—ã—ã¦ãã ã•ã„"
    )
```

### ãƒªã‚«ãƒãƒªãƒ¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

| ã‚·ãƒŠãƒªã‚ª | ãƒªã‚«ãƒãƒªãƒ¼æ–¹æ³• |
|---------|--------------|
| æ­£å¸¸çµ‚äº† | `report_completed()` ã§æ˜ç¤ºçš„ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº† |
| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¯ãƒ©ãƒƒã‚·ãƒ¥ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1æ™‚é–“ï¼‰ã§è‡ªå‹•ã‚¯ãƒªã‚¢ |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ–­ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§è‡ªå‹•ã‚¯ãƒªã‚¢ |
| æ‰‹å‹•ä»‹å…¥ | ç®¡ç†è€…ãŒUIã‹ã‚‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼·åˆ¶çµ‚äº† |

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

```yaml
session:
  default_timeout: 3600      # 1æ™‚é–“
  max_timeout: 86400         # 24æ™‚é–“ï¼ˆé•·æ™‚é–“ã‚¿ã‚¹ã‚¯ç”¨ï¼‰
  cleanup_interval: 300      # 5åˆ†ã”ã¨ã«æœŸé™åˆ‡ã‚Œã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```

---

## ãƒ•ãƒ­ãƒ¼å›³

### Coordinatorãƒãƒ¼ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

```
Coordinator                    MCP Server
     â”‚                              â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚  â”‚ Step 1: èµ·å‹•ç¢ºèª        â”‚ â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
     â”‚                              â”‚
     â”‚  health_check()              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚  { status: "ok" }            â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚  â”‚ Step 2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ    â”‚ â”‚
     â”‚  â”‚         +ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ   â”‚ â”‚
     â”‚  â”‚         ä¸€è¦§å–å¾—        â”‚ â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
     â”‚                              â”‚
     â”‚  list_active_projects_with_agents()
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚  { projects: [               â”‚
     â”‚      {prj_a, [agt_x, agt_y]},â”‚
     â”‚      {prj_b, [agt_x]}        â”‚
     â”‚  ]}                          â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚  â”‚ Step 3: å„(agent,proj)  â”‚ â”‚
     â”‚  â”‚         èµ·å‹•åˆ¤æ–­        â”‚ â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
     â”‚                              â”‚
     â”‚  should_start(agt_x, prj_a)  â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚  { should_start: false }     â”‚  â† å®Ÿè¡Œä¸­ or ã‚¿ã‚¹ã‚¯ãªã—
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚
     â”‚  should_start(agt_y, prj_a)  â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚  { should_start: true }      â”‚  â† ã‚¿ã‚¹ã‚¯ã‚ã‚Š & æœªå®Ÿè¡Œ
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚
     â”‚  [agt_y/prj_a ã‚’ spawn]      â”‚
     â”‚  [working_dir=/proj_a]       â”‚
     â”‚                              â”‚
     â”‚  should_start(agt_x, prj_b)  â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚  { should_start: true }      â”‚  â† åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ç‹¬ç«‹åˆ¤å®š
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚
     â”‚  [agt_x/prj_b ã‚’ spawn]      â”‚
     â”‚  [working_dir=/proj_b]       â”‚
     â”‚                              â”‚
     â”‚  [polling_interval å¾…æ©Ÿ]     â”‚
     â”‚                              â”‚
     â”‚  [ãƒ«ãƒ¼ãƒ—ç¶™ç¶š...]             â”‚
```

### Agent Instanceå®Ÿè¡Œãƒ•ãƒ­ãƒ¼ï¼ˆæ­£å¸¸ç³»ï¼‰

```
Coordinator                    MCP Server                    Agent Instance
     â”‚                              â”‚                              â”‚
     â”‚  should_start(agt_x, prj_a)  â”‚                              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
     â”‚  { should_start: true }      â”‚                              â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
     â”‚                              â”‚                              â”‚
     â”‚  spawn(agt_x, prj_a, /proj_a)â”‚                              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  authenticate(agt_x,key,prj_a)
     â”‚                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  [session(agt_x,prj_a) ON]   â”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  { token, system_prompt }    â”‚
     â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                              â”‚                              â”‚
     â”‚  should_start(agt_x, prj_a)  â”‚                              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
     â”‚  { should_start: false }     â”‚  â† (agt_x,prj_a)å®Ÿè¡Œä¸­       â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
     â”‚                              â”‚                              â”‚
     â”‚  should_start(agt_x, prj_b)  â”‚                              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
     â”‚  { should_start: true }      â”‚  â† (agt_x,prj_b)ã¯åˆ¥ãªã®ã§OK â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  get_my_task(token)          â”‚
     â”‚                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  { task details }            â”‚
     â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚    [ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ at /proj_a]    â”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  report_completed(token)     â”‚
     â”‚                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  [session(agt_x,prj_a) OFF]  â”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  { success, instruction }    â”‚
     â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚         [ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†]        â”‚
     â”‚                              â”‚                              â”‚
     â”‚  should_start(agt_x, prj_a)  â”‚                              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
     â”‚  { should_start: true/false }â”‚  â† æ¬¡ã®ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Œã° true   â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
```

### å†ªç­‰æ€§ã®ç¢ºä¿

```
Coordinator A                  MCP Server                  Coordinator B
     â”‚                              â”‚                              â”‚
     â”‚  should_start(agt_x, prj_a)  â”‚                              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
     â”‚  { should_start: true }      â”‚                              â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
     â”‚                              â”‚                              â”‚
     â”‚  [spawnæº–å‚™ä¸­...]            â”‚  should_start(agt_x, prj_a)  â”‚
     â”‚                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚  { should_start: true }      â”‚  â† ã¾ã èªè¨¼å‰
     â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                              â”‚                              â”‚
     â”‚  [Instanceèµ·å‹•â†’authenticate] â”‚                              â”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  [session(agt_x,prj_a) ON]   â”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚  [Instanceèµ·å‹•â†’authenticate] â”‚
     â”‚                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                              â”‚  { error: "Already running   â”‚  â† äºŒé‡èµ·å‹•é˜²æ­¢
     â”‚                              â”‚    for this project" }       â”‚
     â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                              â”‚                              â”‚
     â”‚                              â”‚     [Instance B çµ‚äº†]        â”‚
```

**ãƒã‚¤ãƒ³ãƒˆ**: å†ªç­‰æ€§ã¯ (agent_id, project_id) å˜ä½ã§ä¿è¨¼ã•ã‚Œã‚‹ã€‚
åŒä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã‚‚ç•°ãªã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èµ·å‹•ã¯è¨±å¯ã•ã‚Œã‚‹ã€‚

---

## ç§»è¡Œè¨ˆç”»

### Phase 4-0: ã‚¢ãƒ—ãƒªå´ã®å‰æå®Ÿè£…

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‰²ã‚Šå½“ã¦æ©Ÿèƒ½ï¼ˆUI + DBï¼‰
2. Project.workingDirectory ã®è¨­å®šUI
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆÃ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

### Phase 4-1: MCP APIè¿½åŠ ï¼ˆCoordinatorå‘ã‘ï¼‰

1. `health_check` ãƒ„ãƒ¼ãƒ«ã®è¿½åŠ  - ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª
2. `list_active_projects_with_agents` ãƒ„ãƒ¼ãƒ«ã®è¿½åŠ  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ+ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸€è¦§å–å¾—
3. `should_start(agent_id, project_id)` ãƒ„ãƒ¼ãƒ«ã®è¿½åŠ  - èµ·å‹•åˆ¤æ–­

### Phase 4-2: MCP APIè¿½åŠ ï¼ˆAgent Instanceå‘ã‘ï¼‰

1. `authenticate(agent_id, passkey, project_id)` ã®æ‹¡å¼µ - project_idè¿½åŠ ã€äºŒé‡èµ·å‹•ãƒã‚§ãƒƒã‚¯
2. `get_my_task` ãƒ„ãƒ¼ãƒ«ã®è¿½åŠ  - è©²å½“ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å˜ä¸€ã‚¿ã‚¹ã‚¯å–å¾—
3. `report_completed` ãƒ„ãƒ¼ãƒ«ã®è¿½åŠ  - ã‚¿ã‚¹ã‚¯å®Œäº†å ±å‘Šã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†

### Phase 4-3: å®Ÿè¡ŒçŠ¶æ…‹ç®¡ç†

1. (agent_id, project_id) å˜ä½ã®å®Ÿè¡ŒçŠ¶æ…‹ãƒ•ãƒ©ã‚°å®Ÿè£…
2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ©Ÿæ§‹
3. æœŸé™åˆ‡ã‚Œã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

### Phase 4-4: Coordinatorå®Ÿè£…

1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆpasskeyç®¡ç†ï¼‰
2. 3ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆhealth_check â†’ list_projects â†’ should_startï¼‰
3. Agent Instanceèµ·å‹•ç®¡ç†ï¼ˆworking_directoryæŒ‡å®šï¼‰
4. åŒæ™‚å®Ÿè¡Œæ•°åˆ¶å¾¡

### Phase 4-5: æ—¢å­˜Runnerã®éæ¨å¥¨åŒ–

1. Runner ã‚’ Coordinator + Agent Instance ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ç½®ãæ›ãˆ
2. æ—§APIã®éæ¨å¥¨ãƒãƒ¼ã‚¯
3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ä½œæˆ

---

## ãƒ¡ãƒªãƒƒãƒˆ

### è²¬å‹™ã®æ˜ç¢ºåŒ–

- **Coordinator**: ã€Œèª°ã‚’èµ·å‹•ã™ã‚‹ã‹ã€ã ã‘ã«å°‚å¿µ
- **Agent**: ã€Œä½•ã‚’ã™ã‚‹ã‹ã€ã ã‘ã«å°‚å¿µ
- **MCP**: çŠ¶æ…‹ç®¡ç†ã€èªè¨¼ã€APIã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤

### ã‚«ã‚¹ã‚¿ãƒ Runnerä¸è¦

Claude Codeï¼ˆã‚„ä»–ã®MCPå¯¾å¿œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰ãŒãã®ã¾ã¾å‹•ä½œï¼š
- ç‰¹åˆ¥ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…ãŒä¸è¦
- LLMãŒè‡ªç„¶ã«MCPãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™
- instruction ã§æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’èª˜å°

### ã‚«ãƒ—ã‚»ãƒ«åŒ–

- å†…éƒ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆ`in_progress`ç­‰ï¼‰ã‚’å¤–éƒ¨ã«å…¬é–‹ã—ãªã„
- ã‚¿ã‚¹ã‚¯ç®¡ç†ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’éš è”½
- APIå¤‰æ›´ã®å½±éŸ¿ç¯„å›²ã‚’é™å®š

### æ‹¡å¼µæ€§

- `instruction` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å‹•çš„ã«æŒ¯ã‚‹èˆã„ã‚’å¤‰æ›´å¯èƒ½
- æ–°ã—ã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¿½åŠ ã—ã‚„ã™ã„
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç¨®åˆ¥ã”ã¨ã«ç•°ãªã‚‹ instruction ã‚’è¿”ã›ã‚‹

---

## å¾Œæ–¹äº’æ›æ€§

### éæ¨å¥¨ã¨ãªã‚‹API

| æ—§API | æ–°API | å‚™è€ƒ |
|-------|-------|------|
| `list_managed_agents` | `list_active_projects_with_agents` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã«å¤‰æ›´ |
| `should_start(agent_id)` | `should_start(agent_id, project_id)` | project_idè¿½åŠ  |
| `authenticate(agent_id, passkey)` | `authenticate(agent_id, passkey, project_id)` | project_idè¿½åŠ  |
| `get_pending_tasks` | `get_my_task` | å˜ä¸€ã‚¿ã‚¹ã‚¯ã«ç°¡ç•¥åŒ– |
| `report_execution_start` | ä¸è¦ | `get_my_task` å‘¼ã³å‡ºã—æ™‚ã«è‡ªå‹•è¨˜éŒ² |
| `report_execution_complete` | `report_completed` | ç°¡ç•¥åŒ– |

### ç§»è¡ŒæœŸé–“

- Phase 4å®Œäº†å¾Œã€æ—§APIã¯6ãƒ¶æœˆé–“ç¶­æŒ
- éæ¨å¥¨è­¦å‘Šã‚’ãƒ­ã‚°å‡ºåŠ›
- æ–°APIã¸ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰ã‚’æä¾›

### ã‚¢ãƒ—ãƒªå´ã®å‰ææ¡ä»¶

æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚¢ãƒ—ãƒªå´å®Ÿè£…ãŒå¿…è¦ï¼š

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‰²ã‚Šå½“ã¦**: ã©ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã©ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½œæ¥­å¯èƒ½ã‹ã‚’è¨­å®š
2. **Project.workingDirectory**: å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š
3. **ã‚¿ã‚¹ã‚¯ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰€å±**: ã‚¿ã‚¹ã‚¯ã¯å¿…ãšãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç´ã¥ãï¼ˆæ—¢å­˜ï¼‰
