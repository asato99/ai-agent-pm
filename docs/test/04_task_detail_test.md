# タスク詳細画面 テストシナリオ

**対応UI仕様**: `docs/ui/04_task_detail.md`
**テストクラス**: `TaskDetailTests`
**最終更新**: 2024-12-31

---

## 進捗サマリ

| 状態 | 件数 |
|------|------|
| ✅ 実装済み | 6 |
| 🔸 スタブ | 0 |
| ⏳ 未実装 | 6 |

---

## 画面概要

タスクの詳細表示・編集、コンテキスト管理、ハンドオフを行う画面。モーダルまたは右パネルで表示。

```
┌────────────────────────────────────────────────────────────────┐
│  API実装                                        [編集] [×]     │
├────────────────────────────────────────────────────────────────┤
│  ┌──────┬──────────────┬────────────┬──────────┐              │
│  │ 概要 │ コンテキスト │ ハンドオフ │ 履歴     │              │
│  └──────┴──────────────┴────────────┴──────────┘              │
│                                                                │
│  ステータス: 🟢 In Progress    優先度: 🔵 Medium               │
│  担当: 🤖 backend-dev          作成者: 👤 owner                │
│                                                                │
│  ─── 説明 ───                                                  │
│  REST APIエンドポイントの実装                                  │
│  - ユーザー認証API                                             │
│  - 商品CRUD API                                                │
│                                                                │
│  ─── 依存関係 ───                                              │
│  ← DB設計 ✅    ← 認証設計 ✅                                  │
│  → API統合 (blocked)                                           │
└────────────────────────────────────────────────────────────────┘
```

※ サブタスクタブは削除（要件: TASKS.md）。タスク間の関係は依存関係で表現。

---

## テストシナリオ

### TS-04-001: タスク詳細画面構成確認

**目的**: タスク詳細画面に必要な要素が表示されること

**前提条件**:
- タスクボード画面でタスクが選択されている

**手順**:
1. タスク詳細画面を確認する

**期待結果**:
- タスクタイトルが表示される
- ステータスが表示される
- 優先度が表示される
- 担当者が表示される
- 説明が表示される

**PRD参照**: 画面概要

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。タスク詳細要素（タイトル、ステータス、優先度等）の検証なし。
**テストメソッド**: `testTaskDetailStructure()`

---

### TS-04-002: タブ存在確認

**目的**: 必要なタブが全て存在すること

**前提条件**:
- タスク詳細画面が表示されている

**手順**:
1. タブバーを確認する

**期待結果**:
- 以下のタブが存在する:
  1. 概要
  2. コンテキスト
  3. ハンドオフ
  4. 履歴

**PRD参照**: タブ詳細
```
│ 概要 │ コンテキスト │ ハンドオフ │ 履歴 │
```

※ サブタスクタブは削除（要件: TASKS.md）

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。タブ（概要、コンテキスト等）の存在確認なし。
**テストメソッド**: `testTaskDetailTabs()`

---

### TS-04-003: コンテキスト追加機能 ※旧TS-04-004

**目的**: コンテキスト追加ボタンが存在し機能すること

**前提条件**:
- タスク詳細画面が表示されている

**手順**:
1. コンテキストタブを選択する
2. 「+ コンテキストを追加」ボタンを確認する
3. ボタンをタップする

**期待結果**:
- 追加ボタンが存在する
- タップするとコンテキスト追加モーダルが表示される
- 以下のタイプが選択可能:
  - 💡 決定事項 (Decision)
  - ⚠️ 前提条件 (Assumption)
  - 🚧 ブロッカー (Blocker)
  - 📎 成果物 (Artifact)
  - 📝 メモ (Note)

**PRD参照**: コンテキスト追加モーダル

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。コンテキストタブ、追加ボタン、モーダル表示の検証なし。
**テストメソッド**: `testContextAddButton()`

---

### TS-04-004: ハンドオフ作成機能 ※旧TS-04-005

**目的**: ハンドオフ作成ボタンが存在し機能すること

**前提条件**:
- タスク詳細画面が表示されている

**手順**:
1. ハンドオフタブを選択する
2. 「+ 新規ハンドオフを作成」ボタンを確認する
3. ボタンをタップする

**期待結果**:
- 作成ボタンが存在する
- タップするとハンドオフ作成モーダルが表示される
- 以下の入力項目が存在:
  - 宛先エージェント選択
  - サマリ入力
  - 次のステップ入力
  - 注意点入力

**PRD参照**: ハンドオフ作成モーダル
```
┌────────────────────────────────────────────────────────────────┐
│  ハンドオフを作成                                       [×]   │
├────────────────────────────────────────────────────────────────┤
│  宛先エージェント                                              │
│  サマリ *                                                      │
│  次のステップ                                                  │
│  注意点                                                        │
│                                    [キャンセル]  [送信]        │
└────────────────────────────────────────────────────────────────┘
```

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。ハンドオフタブ、作成ボタン、モーダル表示の検証なし。
**テストメソッド**: `testHandoffCreateButton()`

---

### TS-04-005: 編集ボタン存在確認 ※旧TS-04-006

**目的**: タスク編集ボタンが存在すること

**前提条件**:
- タスク詳細画面が表示されている

**手順**:
1. 画面右上の編集ボタンを確認する

**期待結果**:
- 編集ボタンが存在する
- タップすると編集モードに切り替わる

**PRD参照**:
```
│  API実装                                        [編集] [×]     │
```

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。編集ボタンの存在と編集モード切替の検証なし。
**テストメソッド**: `testEditButtonExists()`

---

## 追加予定シナリオ

### TS-04-006: 編集モード画面 ※旧TS-04-007

**目的**: 編集モードで正しい入力フォームが表示されること

**期待結果**:
- タイトル編集フィールド
- 説明編集フィールド（Markdown対応）
- 優先度選択
- 担当者選択
- 変更理由入力
- 依存タスク選択

**PRD参照**: 編集モード
```
│  タイトル *                                                    │
│  説明 (Markdown対応)                                           │
│  優先度        担当                                            │
│  [Medium ▼]    [backend-dev ▼]                                 │
│  変更理由 (任意)                                               │
│  依存タスク                                                    │
```

**実装状態**: ⏳ 未実装

---

### TS-04-007: ステータス変更モーダル ※旧TS-04-008

**目的**: ステータス変更時に理由入力モーダルが表示されること

**手順**:
1. ステータスドロップダウンを変更する
2. モーダルの表示を確認する

**期待結果**:
- 現在のステータスが表示される
- 新しいステータス選択が可能
- 変更理由入力フィールドが存在する

**PRD参照**: ステータス変更モーダル
```
│  現在: 🟡 In Progress                              │
│  新しいステータス *                                │
│  [🟢 Done                                   ▼ │    │
│  変更理由 (任意)                                   │
│  💡 理由を記録すると履歴で確認できます            │
```

※ Reviewステータスは削除（要件: TASKS.md）

**実装状態**: ⏳ 未実装

---

### TS-04-008: 履歴タブ - イベント一覧 ※旧TS-04-009

**目的**: タスクの変更履歴が正しく表示されること

**期待結果**:
- 日付別にグループ化されたイベント一覧
- 各イベントに以下が表示される:
  - 時刻
  - イベントタイプアイコン
  - アクター情報
  - 変更内容
  - 理由（存在する場合）

**PRD参照**: 履歴タブ
```
│  📅 2024-12-30                                                │
│  ├─ 14:30  🔄 ステータス変更                                  │
│  │         🤖 backend-dev (Claude Code)                       │
│  │         In Progress → Done                                 │
│  │         📝 理由: "実装完了"                                │
```

※ Reviewステータスは削除（要件: TASKS.md）

**実装状態**: ⏳ 未実装

---

### TS-04-009: 履歴フィルター ※旧TS-04-010

**目的**: 履歴イベントをフィルタリングできること

**期待結果**:
- フィルタードロップダウンが存在する
- 以下のフィルターオプション:
  - すべて
  - ステータス変更
  - 担当者変更
  - 優先度変更
  - コンテキスト追加
  - ハンドオフ
  - 依存関係変更

**PRD参照**: 変更履歴フィルター

**実装状態**: ⏳ 未実装

---

### TS-04-010: コンテキスト一覧表示 ※旧TS-04-011

**目的**: 登録済みコンテキストが正しく表示されること

**期待結果**:
- タイプ別アイコン
- 作成日時
- 作成者情報
- コンテンツ

**PRD参照**: コンテキストタブ
```
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 💡 決定事項                                    2024-12-30│ │
│  │ by 🤖 backend-dev                                        │ │
│  │ JWT認証を採用。トークン有効期限は1時間...                │ │
│  └──────────────────────────────────────────────────────────┘ │
```

**実装状態**: ⏳ 未実装

---

### TS-04-011: ハンドオフ一覧表示 ※旧TS-04-012

**目的**: 受信・送信ハンドオフが正しく表示されること

**期待結果**:
- 送受信の方向が明確
- ステータス（受領済み/未確認/完了）
- サマリ
- 次のステップ
- 注意点

**PRD参照**: ハンドオフタブ
```
│  │ 🔄 受信: design-agent → backend-dev           2024-12-28│ │
│  │ ステータス: ✅ 受領済み                                  │ │
│  │ サマリ:                                                  │ │
│  │ DB設計が完了しました。ER図とスキーマ定義を確認...       │ │
```

**実装状態**: ⏳ 未実装

---

### TS-04-012: 依存関係表示 ※旧TS-04-013

**目的**: タスクの依存関係が正しく表示されること

**期待結果**:
- 前提タスク（このタスクの前提）
- 後続タスク（このタスクを待っている）
- 完了/ブロック状態のアイコン

**PRD参照**: 依存関係
```
│  このタスクの前提:                                              │
│    ✅ DB設計 (完了)                                             │
│    ✅ 認証設計 (完了)                                           │
│  このタスクを待っている:                                        │
│    🔴 API統合 (blocked)                                         │
│    🔴 E2Eテスト (blocked)                                       │
```

**実装状態**: ⏳ 未実装

---

## コンテキストタイプ仕様

| タイプ | アイコン | 用途 |
|--------|---------|------|
| Decision | 💡 | 決定事項 |
| Assumption | ⚠️ | 前提条件 |
| Blocker | 🚧 | ブロッカー |
| Artifact | 📎 | 成果物 |
| Note | 📝 | メモ |

---

## イベントタイプ仕様

| イベント | アイコン | 説明 |
|----------|---------|------|
| created | ✨ | タスク作成 |
| status_changed | 🔄 | ステータス変更 |
| assigned | 👤 | 担当者変更 |
| priority_changed | 📊 | 優先度変更 |
| context_added | 📝 | コンテキスト追加 |
| handoff_created | 📤 | ハンドオフ作成 |
| dependency_added | 🔗 | 依存関係追加 |

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2024-12-31 | 初版作成（実装状況を「✅実装済み」と誤記） |
| 2024-12-31 | 実装状況を正確に修正（全て🔸スタブまたは⏳未実装） |
| 2025-01-01 | 要件再整理: サブタスクタブ削除、Reviewステータス削除、シナリオ番号を連番に修正 |
