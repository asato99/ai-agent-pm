# エージェント管理画面 テストシナリオ

**対応UI仕様**: `docs/ui/03_agent_management.md`
**テストクラス**: `AgentManagementTests`
**最終更新**: 2024-12-31

---

## 進捗サマリ

| 状態 | 件数 |
|------|------|
| ✅ 実装済み | 6 |
| 🔸 スタブ | 0 |
| ⏳ 未実装 | 9 |

---

## 画面概要

エージェントの作成・編集・階層管理・Claude Code設定の管理を行う画面。
**エージェントはプロジェクト横断のトップレベル概念。ツリー構造で親子関係を持つ。**

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  👥 エージェント管理                                [+ 新規]    ⚙️          │
├────────────┬────────────────────────────────────────────────────────────────┤
│            │                                                                │
│ 📁 Projects│  ┌────────────────────────────────────────────────────────────┐│
│   Project A│  │  エージェント一覧 (ツリー表示)              🔍 検索...    ││
│   Project B│  ├────────────────────────────────────────────────────────────┤│
│            │  │                                                            ││
│ 👥 Agents  │  │  ▼ 👤 owner                                   🟡 アイドル ││
│ ┌────────┐ │  │      Role: Owner | 並列: 5/5                              ││
│ │ ▼owner │ │  │      参加プロジェクト: Project A, Project B               ││
│ │  ├─dev1│ │  │    ├─ 🤖 frontend-dev                        🟢 接続中   ││
│ │  └─dev2│ │  │    │    Role: Worker | 並列: 1/3                          ││
│ └────────┘ │  │    │    MCP設定: ✅ 設定済み                              ││
│            │  │    └─ 🤖 backend-dev                         ⚫ オフライン ││
│ 🛡️ Audit   │  │         Role: Worker | 並列: 0/2                          ││
│   Team A   │  │                                                            ││
│            │  └────────────────────────────────────────────────────────────┘│
│ 📜 History │                                                                │
│            │                                                                │
├────────────┴────────────────────────────────────────────────────────────────┤
│  3 agents | 🟢 1 active | 🟡 1 idle | ⚫ 1 offline                          │
└─────────────────────────────────────────────────────────────────────────────┘
```

※ エージェントはトップレベル管理（プロジェクトに「参加」する形式）
※ ツリー構造: 親エージェント（parentAgentId）による階層
※ 並列実行: `in_progress中のタスク数 / maxParallelTasks`

---

## テストシナリオ

### TS-03-001: エージェント管理画面アクセス

**目的**: サイドバーからエージェント管理画面にアクセスできること

**前提条件**:
- アプリが起動している

**手順**:
1. サイドバーの「Agents」セクションをクリックする
2. 画面遷移を確認する

**期待結果**:
- エージェント管理画面が表示される
- 「エージェント一覧」タイトルが表示される

**PRD参照**: 画面概要

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。「エージェント一覧」タイトルの存在確認なし。
**テストメソッド**: `testAgentManagementAccessible()`

---

### TS-03-002: エージェント一覧表示

**目的**: 登録済みエージェントがカード形式で一覧表示されること

**前提条件**:
- エージェント管理画面が表示されている
- 少なくとも1つのエージェントが登録されている

**手順**:
1. エージェント一覧を確認する

**期待結果**:
- 登録済みエージェントがカード形式で表示される
- 各カードに基本情報が表示される

**PRD参照**: エージェント一覧

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。エージェントカード表示の検証なし。
**テストメソッド**: `testAgentListDisplay()`

---

### TS-03-003: 新規エージェント作成ボタン

**目的**: 新規エージェント作成ボタンが存在すること

**前提条件**:
- エージェント管理画面が表示されている

**手順**:
1. ツールバーで「+ 新規」ボタンを探す

**期待結果**:
- 新規作成ボタンが存在する
- タップするとエージェント作成ウィザードが表示される

**PRD参照**:
```
│  👥 エージェント管理                        [+ 新規]  ⚙️   │
```

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。「+ 新規」ボタンの存在確認とウィザード表示の検証なし。
**テストメソッド**: `testNewAgentButtonExists()`

---

### TS-03-004: エージェントステータスインジケーター

**目的**: エージェントのステータスが正しく表示されること

**前提条件**:
- エージェント管理画面が表示されている
- 各ステータスのエージェントが存在する

**手順**:
1. 各エージェントカードのステータス表示を確認する

**期待結果**:
| 状態 | アイコン | 説明 |
|------|---------|------|
| 接続中 | 🟢 | アクティブなセッションがあり、作業中 |
| アイドル | 🟡 | 有効だがセッションなし（人間の場合は常にこれ） |
| オフライン | ⚫ | 無効化されている、または長期間未接続 |

**PRD参照**: エージェントステータス

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。ステータスインジケーター（🟢/🟡/⚫）の検証なし。
**テストメソッド**: `testAgentStatusIndicators()`

---

### TS-03-005: エージェントカード構成要素

**目的**: エージェントカードに必要な情報が表示されること

**前提条件**:
- エージェント管理画面が表示されている
- 少なくとも1つのエージェントが存在する

**手順**:
1. エージェントカードの構成要素を確認する

**期待結果**:
- アイコン（👤 または 🤖）
- 名前
- ステータス（🟢/🟡/⚫）
- Role（Owner/Manager/Worker/Viewer/Auditor）
- Type（Human/AI）
- 親エージェント（ツリー構造で表示）
- 並列実行可能数（in_progress中 / maxParallelTasks）
- 参加プロジェクト
- MCP設定状態（AIの場合）

**PRD参照**: エージェントカード
```
┌────────────────────────────────────────────────────────────────┐
│ [アイコン] [名前]                              [ステータス]    │
│    Role: [権限タイプ] | Type: [Human/AI]                       │
│    親: [親エージェント名]                                      │
│    並列: [実行中/最大] | プロジェクト: [参加数]                │
│    ┌────────────────────────────────────────────────────────┐ │
│    │ MCP設定: [ステータス]            [アクション]          │ │
│    └────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────────┘
```

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。カード構成要素（アイコン、名前、Role、Type等）の検証なし。
**テストメソッド**: `testAgentCardStructure()`

---

### TS-03-006: エージェント詳細表示

**目的**: エージェントを選択すると詳細が表示されること

**前提条件**:
- エージェント管理画面が表示されている
- 少なくとも1つのエージェントが存在する

**手順**:
1. エージェントカードをクリックする
2. 詳細表示を確認する

**期待結果**:
- 詳細パネルまたはモーダルが表示される
- 以下のタブが存在する:
  - 基本情報
  - 階層（親子関係管理）
  - タスク（担当タスク一覧）
  - 統計
  - MCP設定

**PRD参照**: エージェント詳細・編集

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。詳細パネル表示とタブ（基本情報、統計等）の検証なし。
**テストメソッド**: `testAgentDetailView()`

---

## 追加予定シナリオ

### TS-03-007: エージェント作成ウィザード - ステップ1

**目的**: 基本情報入力ステップが正しく動作すること

**手順**:
1. 新規エージェント作成ボタンをタップ
2. ステップ1の画面を確認

**期待結果**:
- タイプ選択（AI/人間）
- 名前入力（英数字、ハイフン）
- 役割入力

**PRD参照**: ステップ1: 基本情報
```
│  タイプ *                                                      │
│  ┌──────────────────┐  ┌──────────────────┐                   │
│  │       🤖         │  │       👤         │                   │
│  │       AI         │  │      人間        │                   │
│  └──────────────────┘  └──────────────────┘                   │
│  名前 * (英数字、ハイフン)                                     │
│  役割 *                                                        │
```

**実装状態**: ⏳ 未実装

---

### TS-03-008: エージェント作成ウィザード - ステップ2

**目的**: 権限・階層・リソース設定ステップが正しく動作すること

**期待結果**:
- 権限タイプ選択（Owner/Manager/Worker/Viewer/Auditor）
- 親エージェント選択（ツリー構造から選択）
- 並列実行可能数（maxParallelTasks: 1-10）
- 専門分野入力（カンマ区切り）
- システムプロンプト入力

**PRD参照**: ステップ2: 権限と階層
```
│  権限タイプ *                                                  │
│  [Worker                                           ▼]          │
│                                                                │
│  親エージェント                                                │
│  [owner                                            ▼]          │
│                                                                │
│  並列実行可能数 *                                              │
│  [3                                                ▼]          │
```

**実装状態**: ⏳ 未実装

---

### TS-03-009: エージェント作成ウィザード - ステップ3

**目的**: MCP設定ステップが正しく動作すること

**期待結果**:
- MCP設定JSONが表示される
- コピーボタンが機能する
- 自動設定ボタンが存在する

**PRD参照**: ステップ3: Claude Code設定
```
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ {                                                        │ │
│  │   "mcpServers": {                                        │ │
│  │     "agent-pm-frontend-dev": {                           │ │
│  │       "command": "/Applications/AI Agent PM.app/..."     │ │
│  │     }                                                    │ │
│  │   }                                                      │ │
│  │ }                                                        │ │
│  └──────────────────────────────────────────────────────────┘ │
│  [📋 コピー]  [🔧 自動設定]                                    │
```

**実装状態**: ⏳ 未実装

---

### TS-03-010: 統計タブ

**目的**: エージェントの統計情報が表示されること

**期待結果**:
- サマリー（セッション数、総作業時間、完了タスク数など）
- 今週の活動グラフ
- AIツール使用履歴

**PRD参照**: 統計タブ

**実装状態**: ⏳ 未実装

---

### TS-03-011: 活動履歴タブ

**目的**: エージェントの活動履歴が表示されること

**期待結果**:
- 日付別の活動一覧
- イベントタイプ別フィルター
- 期間フィルター

**PRD参照**: 活動履歴タブ
```
│  ─── 活動履歴 ───                                 [フィルター▼] │
│  📅 今日                                                       │
│  ├─ 14:30  🔄 ステータス変更                                   │
│  ├─ 14:00  📤 ハンドオフ作成                                   │
│  ├─ 12:00  📝 コンテキスト追加                                 │
```

**実装状態**: ⏳ 未実装

---

### TS-03-012: コンテキストメニュー

**目的**: エージェントを右クリックするとコンテキストメニューが表示されること

**期待結果**:
```
┌─────────────────────────┐
│ 📋 詳細を開く           │
├─────────────────────────┤
│ ✏️ 編集                 │
│ 📊 統計を見る           │
│ 👥 階層を管理           │
├─────────────────────────┤
│ 🔧 MCP設定を表示        │
│ 🔄 MCP設定を再生成      │
├─────────────────────────┤
│ 📦 アーカイブ           │
│ 🗑️ 削除                 │
└─────────────────────────┘
```

**実装状態**: ⏳ 未実装

---

### TS-03-013: 階層タブ表示

**目的**: エージェント詳細の階層タブで親子関係が表示されること

**前提条件**:
- エージェント詳細画面が表示されている
- 親子関係のあるエージェントが存在する

**手順**:
1. 階層タブを選択する

**期待結果**:
- 親エージェント情報が表示される
- 子エージェント一覧が表示される
- 「+ 子エージェントを追加」ボタンが存在する
- 親エージェント変更ボタンが存在する

**PRD参照**: 階層タブ
```
│  ─── 親エージェント ───                                       │
│  👤 owner (Owner)                                              │
│                                                   [変更]       │
│                                                                │
│  ─── 子エージェント ───                                       │
│  🤖 frontend-dev (Worker)                                      │
│  🤖 backend-dev (Worker)                                       │
│                                      [+ 子エージェントを追加]  │
```

**実装状態**: ⏳ 未実装

---

### TS-03-014: 子エージェント追加

**目的**: 子エージェントを追加できること

**前提条件**:
- エージェント詳細の階層タブが表示されている

**手順**:
1. 「+ 子エージェントを追加」ボタンをクリック
2. エージェント選択ダイアログを確認

**期待結果**:
- エージェント選択ダイアログが表示される
- 既存の子エージェントは選択不可
- 選択すると子エージェントとして追加される

**実装状態**: ⏳ 未実装

---

### TS-03-015: 親エージェント変更

**目的**: 親エージェントを変更できること

**前提条件**:
- エージェント詳細の階層タブが表示されている

**手順**:
1. 親エージェントの「変更」ボタンをクリック
2. 新しい親エージェントを選択

**期待結果**:
- エージェント選択ダイアログが表示される
- 自分自身と子孫エージェントは選択不可（循環防止）
- 選択すると親エージェントが変更される

**実装状態**: ⏳ 未実装

---

## MCP設定ステータス仕様

| ステータス | 表示 | アクション |
|-----------|------|-----------|
| 設定済み | ✅ 設定済み | [設定を表示] |
| 未設定 | ⚠️ 未設定 | [設定を生成] |
| 人間 | - | (表示なし) |

---

## AIツール種類仕様

| ツール | 表示 |
|--------|------|
| Claude Code | Claude Code |
| Gemini | Gemini |
| その他 | Other |
| 人間 | - (非表示) |

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2024-12-31 | 初版作成（実装状況を「✅実装済み」と誤記） |
| 2024-12-31 | 実装状況を正確に修正（全て🔸スタブまたは⏳未実装） |
| 2025-01-01 | 要件再整理: トップレベル化、ツリー階層、maxParallelTasks追加、階層管理シナリオ追加 |

---

## 権限タイプ仕様

| 権限 | 説明 |
|------|------|
| Owner | 全権限 |
| Manager | タスク管理権限 |
| Worker | タスク実行権限 |
| Viewer | 閲覧のみ |
| Auditor | 監査権限（ロック操作、全プロジェクト閲覧） |

※ Auditor は監査チームに所属するエージェント専用（要件: AUDIT.md）
