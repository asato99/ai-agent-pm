# タスクボード画面 テストシナリオ

**対応UI仕様**: `docs/ui/02_task_board.md`
**テストクラス**: `TaskBoardTests`
**最終更新**: 2025-01-06

---

## 進捗サマリ

| 状態 | 件数 |
|------|------|
| ✅ 実装済み | 9 |
| ⚠️ XCUITest自動テスト不可 | 1 |
| ⏳ 未実装（UI未実装） | 6 |

**注記**:
- TS-02-008（ドラッグ&ドロップ）: UI実装済みだがXCUITestがSwiftUIドラッグコールバックをトリガーしないため自動テスト不可
- TS-02-009〜014: アプリのUI機能自体が未実装のためテスト不可

---

## 画面概要

プロジェクトのタスクをカンバン形式で管理するメイン画面。5つのステータスカラムで構成。

```
┌─────────┬─────────┬──────────┬─────────┬─────────┐
│ Backlog │  To Do  │ Progress │ Blocked │  Done   │
│   (3)   │   (2)   │   (2)    │   (1)   │   (5)   │
├─────────┼─────────┼──────────┼─────────┼─────────┤
│ ┌─────┐ │ ┌─────┐ │ ┌──────┐ │ ┌─────┐ │ ┌─────┐ │
│ │UI設計│ │ │DB設計│ │ │API   │ │ │API  │ │ │要件 │ │
│ │     │ │ │🔵   │ │ │実装  │ │ │統合 │ │ │定義 │ │
│ └─────┘ │ └─────┘ │ │🟢    │ │ │ 🔴  │ │ │ ✅  │ │
│         │         │ │back  │ │ │待ちA│ │ └─────┘ │
│         │         │ └──────┘ │ └─────┘ │         │
└─────────┴─────────┴──────────┴─────────┴─────────┘
```

※ `in_review` は不要（要件: TASKS.md）
※ `cancelled` はカラムに表示せず、フィルターで表示可能

---

## テストシナリオ

### TS-02-001: カンバンカラム構造確認

**目的**: 正しいカンバンカラム構造が表示されること

**前提条件**:
- アプリが起動している
- プロジェクトが選択されている

**手順**:
1. タスクボード画面を表示する
2. カラム構造を確認する

**期待結果**:
- 以下のカラムが左から順に表示される:
  1. Backlog
  2. To Do
  3. In Progress
  4. Blocked
  5. Done

**PRD参照**: 画面概要
```
│ Backlog │  To Do  │ Progress │ Blocked │  Done   │
```

※ `in_review` カラムは不要（要件: TASKS.md）

**実装状態**: ✅ 実装済み
**検証内容**: 全5カラム(Backlog, To Do, In Progress, Blocked, Done)の存在確認とframe.xによる左右順序検証
**テストメソッド**: `testKanbanColumnsStructure()`, `testKanbanColumnIdentifiers()`

---

### TS-02-002: カラムヘッダー表示

**目的**: 各カラムヘッダーにステータス名と件数が表示されること

**前提条件**:
- タスクボード画面が表示されている

**手順**:
1. 各カラムのヘッダーを確認する

**期待結果**:
- ステータス名が表示される
- タスク件数が括弧内に表示される（例: "Todo (3)"）

**PRD参照**: カラムヘッダー
```
┌─────────────────────────────────┐
│ [ステータス名]           (件数) │
└─────────────────────────────────┘
```

**実装状態**: ✅ 実装済み
**検証内容**: 全カラムヘッダーの存在確認、タスクカードの存在確認、件数バッジの存在確認（オプショナル）
**テストメソッド**: `testColumnHeadersShowTaskCount()`

---

### TS-02-003: 新規タスク作成ボタン

**目的**: 新規タスク作成ボタンが存在し機能すること

**前提条件**:
- タスクボード画面が表示されている

**手順**:
1. ツールバーまたはカラム内で「+ タスク」ボタンを探す
2. ボタンをタップする

**期待結果**:
- 新規タスク作成ボタンが存在する
- タップすると新規タスク作成シートが表示される

**PRD参照**:
```
│  📁 ECサイト開発    🔍 検索...  [+ タスク]  👥  ⚙️  │
```

**実装状態**: ✅ 実装済み
**検証内容**: キーボードショートカット(⇧⌘T)でシートが表示されることを検証（macOS SwiftUIのツールバーボタンはXCUITestに公開されないため代替手法）
**テストメソッド**: `testNewTaskButtonExists()`

---

### TS-02-004: タスクカード構造確認

**目的**: タスクカードに必要な情報が表示されること

**前提条件**:
- タスクボード画面が表示されている
- 少なくとも1つのタスクが存在する

**手順**:
1. タスクカードを確認する

**期待結果**:
- タスクタイトルが表示される
- 優先度バッジが表示される
- 担当エージェント名が表示される（アサイン済みの場合）
- 依存関係情報が表示される（blocked状態の場合）

**PRD参照**: タスクカード
```
┌────────────────────────────────────┐
│ [優先度] タスクタイトル            │
│ 🤖 担当エージェント名              │
│ 🔗 依存: 2 (blocked)               │
└────────────────────────────────────┘
```

※ サブタスクは不要（要件: TASKS.md）。タスク間の関係は依存関係で表現。

**実装状態**: ✅ 実装済み
**検証内容**: TaskCard_*識別子のカード存在確認、アクセシビリティラベル存在確認、ボタン要素タイプ確認
**テストメソッド**: `testTaskCardStructure()`

---

### TS-02-005: タスク選択で詳細表示

**目的**: タスクを選択すると右側に詳細パネルが表示されること

**前提条件**:
- タスクボード画面が表示されている
- 少なくとも1つのタスクが存在する

**手順**:
1. タスクカードをクリックする
2. 右側パネルの変化を確認する

**期待結果**:
- タスクが選択状態になる
- 右側に詳細パネルが表示される
- 詳細パネルに以下が含まれる:
  - タスクタイトル
  - ステータス
  - 優先度
  - 担当者
  - 説明

**PRD参照**: タスク選択
- **クリック**: タスク詳細パネルを右側に表示
- **ダブルクリック**: タスク詳細モーダルを開く

**実装状態**: ✅ 実装済み
**検証内容**: タスクカードクリック後にTaskDetailView識別子を持つ詳細パネルが表示されることを確認
**テストメソッド**: `testTaskSelectionShowsDetail()`

---

### TS-02-006: 優先度バッジ色分け

**目的**: 優先度に応じて正しい色のバッジが表示されること

**前提条件**:
- タスクボード画面が表示されている
- 各優先度のタスクが存在する

**手順**:
1. 各優先度のタスクカードを確認する

**期待結果**:
| 優先度 | バッジ色 |
|--------|---------|
| Urgent | 🔴 赤バー |
| High | 🟠 オレンジバー |
| Medium | 🔵 青バー |
| Low | ⚪ グレーバー |

**PRD参照**: 優先度表示

**実装状態**: ✅ 実装済み
**検証内容**: PriorityBadge_*識別子の存在確認（またはタスクカード存在での間接確認）
**テストメソッド**: `testPriorityBadgeDisplay()`

---

### TS-02-007: リフレッシュボタン

**目的**: リフレッシュボタンが存在すること

**前提条件**:
- タスクボード画面が表示されている

**手順**:
1. ツールバーでリフレッシュボタンを探す

**期待結果**:
- リフレッシュボタン（🔄 または類似アイコン）が存在する

**PRD参照**: ツールバー

**実装状態**: ✅ 実装済み
**検証内容**: キーボードショートカット(⌘R)でリフレッシュ実行、タスクボードが引き続き表示されることを確認
**テストメソッド**: `testRefreshButtonExists()`

---

## 追加予定シナリオ

### TS-02-008: ドラッグ&ドロップによるステータス変更

**目的**: タスクカードをドラッグ&ドロップでステータス変更できること

**手順**:
1. タスクカードをドラッグする
2. 別のカラムにドロップする

**期待結果**:
- タスクが新しいカラムに移動する
- ステータスが更新される

**PRD参照**: ドラッグ&ドロップ
```
タスクカードをドラッグ → 別のカラムにドロップ → ステータス変更確認
```

**ドラッグ制約**:
- Worker: 自分のタスクのみドラッグ可能
- todo → in_progress: 依存タスクがすべてdoneであること（ブロック）
- todo → in_progress: 担当エージェントの並列実行可能数を超えていないこと（リソースブロック）
- blocked へのドラッグは理由入力必須

※ 依存関係・リソース可用性による強制ブロックあり（要件: TASKS.md, AGENTS.md）

**実装状態**: ⚠️ XCUITest自動テスト不可
**備考**:
- UIのドラッグ&ドロップ機能は実装済み（`onDrag` + `onDrop` API使用）
- XCUITestの `click(forDuration:thenDragTo:)` および `press(forDuration:thenDragTo:)` はSwiftUIのドラッグコールバックをトリガーしない
- 検証済みアプローチ:
  1. `draggable` + `dropDestination` (Transferable API) - コールバック未呼出
  2. `onDrag` + `onDrop` (NSItemProvider API) - コールバック未呼出
  3. UTType登録追加 - 効果なし
  4. 各種XCUITestドラッグAPI（press/click, 速度変更, ホールド時間延長） - 全て効果なし
- **手動テストで動作確認が必要**
**テストメソッド**: `testDragAndDropStatusChange()` - XCUITest制限により自動テスト不可として記録

---

### TS-02-009: コンテキストメニュー表示

**目的**: タスクを右クリックするとコンテキストメニューが表示されること

**期待結果**:
```
┌─────────────────────────┐
│ 📋 詳細を開く           │
├─────────────────────────┤
│ ✏️ 編集                 │
│ 👤 アサイン変更         │
│ 🔗 依存関係を編集       │
├─────────────────────────┤
│ ➡️ ステータス変更 ▶     │
├─────────────────────────┤
│ 📑 複製                 │
│ 🗑️ 削除                 │
└─────────────────────────┘
```

**実装状態**: ⏳ 未実装（UI未実装）
**備考**: アプリのコンテキストメニュー機能自体が未実装。テストはXCTFailで明示的に失敗。
**テストメソッド**: `testTaskContextMenu()`

---

### TS-02-010: 検索機能

**目的**: タスクを検索できること

**手順**:
1. 検索フィールドにテキストを入力する
2. 結果を確認する

**期待結果**:
- タイトル、説明文、コンテキストを対象に検索
- インクリメンタルサーチ
- `⌘ F` でフォーカス

**PRD参照**: 検索

**実装状態**: ⏳ 未実装（UI未実装）
**備考**: アプリの検索機能自体が未実装。テストはXCTFailで明示的に失敗。
**テストメソッド**: `testSearchFunction()`

---

### TS-02-011: フィルターバー

**目的**: タスクをフィルタリングできること

**期待結果**:
| フィルター | オプション |
|-----------|-----------|
| 担当 | 全員 / 自分 / 未アサイン / 特定エージェント |
| 優先度 | 全て / Urgent / High / Medium / Low |
| 依存 | 全て / Ready のみ / Blocked のみ |

**PRD参照**: フィルターバー
```
│ 担当: [全員 ▼]  優先度: [全て ▼]  依存: [全て ▼]  🔍 検索... │
```

**実装状態**: ⏳ 未実装（UI未実装）
**備考**: アプリのフィルターバー機能自体が未実装。テストはXCTFailで明示的に失敗。
**テストメソッド**: `testFilterBar()`

---

### TS-02-012: エージェント活動インジケーター

**目的**: サイドバーにエージェント活動状態が表示されること

**期待結果**:
| 状態 | アイコン | 説明 |
|------|----------|------|
| Active | 🟢 | セッション中、作業中 |
| Idle | 🟡 | セッション中、作業なし |
| Offline | ⚫ | セッションなし |

**PRD参照**: エージェント活動インジケーター
```
👥 Agents
  🟢 owner        (active)
  🟢 frontend-dev (active, working on: 画面実装)
  ⚫ backend-dev  (offline, last: 2h ago)
```

**実装状態**: ⏳ 未実装（UI未実装）
**備考**: アプリのエージェント活動インジケーター機能自体が未実装。テストはXCTFailで明示的に失敗。
**テストメソッド**: `testAgentActivityIndicator()`

---

### TS-02-013: 依存関係によるブロック表示

**目的**: 依存タスクが未完了の場合にブロック状態が表示されること

**前提条件**:
- タスクAがタスクBに依存している
- タスクBが未完了（done以外）

**手順**:
1. タスクAを確認する

**期待結果**:
- タスクAがBlockedカラムに表示される
- 依存関係情報が表示される（🔗 依存: タスクB (待ち)）
- todo → in_progress への移動が制限される

**PRD参照**: ドラッグ制約
- todo → in_progress: 依存タスクがすべてdoneであること

**実装状態**: ⏳ 未実装（UI未実装）
**備考**: アプリの依存関係ブロック表示機能自体が未実装。テストは未作成。
**テストメソッド**: なし

---

### TS-02-014: リソース可用性によるブロック表示

**目的**: エージェントの並列実行可能数を超えている場合にブロック状態が表示されること

**前提条件**:
- エージェントAのmaxParallelTasksが2
- エージェントAが既に2つのタスクをin_progressで担当

**手順**:
1. エージェントAに割り当てられた別のtodoタスクを確認する

**期待結果**:
- タスクがtodoカラムに留まる
- in_progressへの移動が制限される
- リソース制約の理由が表示される

**PRD参照**: ドラッグ制約
- todo → in_progress: 担当エージェントの並列実行可能数を超えていないこと

**実装状態**: ⏳ 未実装（UI未実装）
**備考**: アプリのリソースブロック表示機能自体が未実装。テストは未作成。
**テストメソッド**: なし

---

## 担当エージェント表示仕様

| 状態 | 表示 |
|------|------|
| AIエージェント | 🤖 名前 |
| 人間 | 👤 名前 |
| 未アサイン | 👻 未アサイン (グレー) |

---

## 新規タスク作成シート仕様

```
┌────────────────────────────────────────────────────┐
│  新規タスク                                 [×]   │
├────────────────────────────────────────────────────┤
│  タイトル *                                        │
│  説明                                              │
│  ステータス        優先度                          │
│  [Backlog ▼]      [Medium ▼]                      │
│  担当エージェント                                  │
│  [未アサイン ▼]                                   │
│  依存タスク                                        │
│                     [キャンセル]  [作成]          │
└────────────────────────────────────────────────────┘
```

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2024-12-31 | 初版作成（実装状況を「✅実装済み」と誤記） |
| 2024-12-31 | 実装状況を正確に修正（全て🔸スタブまたは⏳未実装） |
| 2025-01-01 | 要件再整理: Reviewカラム削除、サブタスク削除、依存関係・リソースブロックシナリオ追加 |
| 2025-01-02 | カラム順序修正: Backlog → To Do → In Progress → Blocked → Done（UIテストと整合） |
| 2025-01-06 | ドキュメントを実装状態に合わせて修正。テストメソッド名更新。進捗サマリ修正。 |
| 2026-01-06 | TS-02-008: XCUITestがSwiftUIドラッグコールバックをトリガーしない問題を検証・記録。自動テスト不可として更新。 |
