# 共通テストシナリオ

**テストクラス**: `CommonNavigationTests`, `CommonAccessibilityTests`, `CommonPerformanceTests`
**テストファイル**: `UITests/Common/CommonUITests.swift`
**最終更新**: 2025-01-06

---

## 進捗サマリ

| 状態 | 件数 |
|------|------|
| ✅ 実装済み | 7 |
| ⏳ 未実装（UI未実装/未着手） | 18 |

**注記**: ドキュメントには25シナリオを記載しているが、実際のテストは7メソッドのみ実装。設定画面、ディープリンク、エラーハンドリング、データ永続性等は未実装。

---

## 1. アプリ起動テスト (AppLaunchTests)

### TS-05-001: アプリ起動確認

**目的**: アプリが正常に起動すること

**前提条件**: なし

**手順**:
1. アプリを起動する

**期待結果**:
- アプリがクラッシュせずに起動する
- メインウィンドウが表示される

**実装状態**: ⏳ 未実装
**備考**: 専用テストなし。起動確認は`CommonPerformanceTests.testAppLaunchPerformance()`のパフォーマンス計測に含まれる。

---

### TS-05-002: メインウィンドウ構造確認

**目的**: メインウィンドウが正しい構造を持つこと

**前提条件**:
- アプリが起動している

**手順**:
1. メインウィンドウを確認する

**期待結果**:
- 3カラムレイアウト（NavigationSplitView）
  - 左: サイドバー（Projects/Agents/Audit/History）
  - 中央: コンテンツ（タスクボード等）
  - 右: 詳細（タスク詳細等）

※ サイドバー構成は要件再整理により変更（要件: UI_MODIFICATIONS.md）

**実装状態**: ✅ 実装済み
**検証内容**: メインウィンドウ、サイドバー（ProjectList識別子）、「No Project Selected」プレースホルダーの存在確認
**テストメソッド**: `CommonNavigationTests.testThreeColumnLayout()`

---

### TS-05-003: 初期状態表示

**目的**: 初期状態が正しく表示されること

**前提条件**:
- アプリが起動している

**手順**:
1. 初期画面状態を確認する

**期待結果**:
- プロジェクト未選択状態が表示される
- または空状態メッセージが表示される

**実装状態**: ✅ 実装済み
**検証内容**: 「No Project Selected」プレースホルダーテキストの表示確認
**テストメソッド**: `CommonNavigationTests.testThreeColumnLayout()`（統合）

---

## 2. ナビゲーションテスト (NavigationTests)

### TS-05-004: 3カラムナビゲーション動作

**目的**: 3カラム間のナビゲーションが正しく動作すること

**前提条件**:
- アプリが起動している
- データが存在する

**手順**:
1. サイドバーでプロジェクトを選択
2. 中央カラムでタスクを選択
3. 右カラムに詳細が表示されることを確認

**期待結果**:
- サイドバー選択 → 中央カラム更新
- 中央カラム選択 → 右カラム更新
- 各カラムが連動して動作する

**実装状態**: ✅ 実装済み
**検証内容**: プロジェクト選択後にTaskBoardが表示されることを確認
**テストメソッド**: `CommonNavigationTests.testProjectSelectionUpdatesContent()`

---

### TS-05-005: シート表示動作

**目的**: 新規作成・編集でシートが正しく表示されること

**前提条件**:
- アプリが起動している

**手順**:
1. 新規作成ボタンをタップ
2. シートの表示を確認

**期待結果**:
- モーダルシートが表示される
- 背景が暗くなる
- 閉じるボタン（×）が機能する

**実装状態**: ✅ 実装済み
**検証内容**: Cmd+Nで新規プロジェクトシートが表示されることを確認
**テストメソッド**: `CommonNavigationTests.testKeyboardShortcuts()`

---

### TS-05-006: 設定画面アクセス

**目的**: 設定画面にアクセスできること

**前提条件**:
- アプリが起動している

**手順**:
1. 設定ボタン（⚙️）をタップ
2. または メニュー > 設定 を選択

**期待結果**:
- 設定画面が表示される

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。設定ボタンと設定画面表示の検証なし。
**テストメソッド**: `testSettingsAccessible()`

---

### TS-05-007: ディープリンク処理

**目的**: ディープリンクが正しく処理されること

**前提条件**:
- アプリが起動している

**手順**:
1. ディープリンクURLを開く
   - `aiagentpm://project/{id}`
   - `aiagentpm://task/{id}`
   - `aiagentpm://agent/{id}`

**期待結果**:
- 指定されたリソースに直接ナビゲートする

**PRD参照**: Deep Link URL scheme

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。ディープリンク処理の検証なし。
**テストメソッド**: `testDeepLinkHandling()`

---

## 3. 空状態テスト (EmptyStateTests)

### TS-05-008: プロジェクトなし空状態

**目的**: プロジェクトがない場合に適切な空状態が表示されること

**前提条件**:
- アプリが起動している
- プロジェクトが0件

**期待結果**:
- 空状態メッセージが表示される
- 新規作成を促すボタンが表示される

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。空状態メッセージと新規作成ボタンの検証なし。
**テストメソッド**: `testNoProjectsEmptyState()`

---

### TS-05-009: プロジェクト未選択状態

**目的**: プロジェクト未選択時に適切なメッセージが表示されること

**前提条件**:
- アプリが起動している
- プロジェクトが存在するが未選択

**期待結果**:
- 「No Project Selected」または同等のメッセージが表示される
- プロジェクト選択を促すガイダンスが表示される

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。「No Project Selected」メッセージの検証なし。
**テストメソッド**: `testNoProjectSelectedState()`

---

### TS-05-010: タスクなし空状態

**目的**: タスクがない場合に適切な空状態が表示されること

**前提条件**:
- プロジェクトが選択されている
- タスクが0件

**期待結果**:
- 空状態メッセージが表示される
- タスク作成を促すボタンが表示される

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。タスク空状態メッセージの検証なし。
**テストメソッド**: `testNoTasksEmptyState()`

---

### TS-05-011: タスク未選択状態

**目的**: タスク未選択時に適切なメッセージが表示されること

**前提条件**:
- プロジェクトが選択されている
- タスクが存在するが未選択

**期待結果**:
- 「No Selection」または同等のメッセージが表示される
- タスク選択を促すガイダンスが表示される

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。「No Selection」メッセージの検証なし。
**テストメソッド**: `testNoTaskSelectedState()`

---

## 4. インタラクションテスト (InteractionTests)

### TS-05-012: ボタン応答確認

**目的**: ボタンがタップに応答すること

**前提条件**:
- アプリが起動している

**手順**:
1. ボタン要素を取得する
2. ボタンの存在を確認する

**期待結果**:
- ボタン要素が存在する
- ボタンがタップ可能な状態

**実装状態**: 🔸 スタブ
**現状**: ボタン存在確認のみ。タップ応答性の検証なし。
**テストメソッド**: `testButtonClickResponsiveness()`

---

### TS-05-013: リスト項目選択

**目的**: リスト項目が選択可能であること

**前提条件**:
- リストが表示されている

**手順**:
1. リスト項目をタップする

**期待結果**:
- 選択状態が視覚的に示される
- 関連するコンテンツが更新される

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。リスト選択と視覚フィードバックの検証なし。
**テストメソッド**: `testListItemSelection()`

---

### TS-05-014: フォーム入力

**目的**: フォーム入力が正しく動作すること

**前提条件**:
- 新規作成シートが表示されている

**手順**:
1. テキストフィールドをタップ
2. テキストを入力
3. 送信ボタンをタップ

**期待結果**:
- テキストフィールドにフォーカスが移る
- 入力したテキストが反映される
- バリデーションが動作する

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。フォーム入力とバリデーションの検証なし。
**テストメソッド**: `testFormInput()`

---

### TS-05-015: シートキャンセル操作

**目的**: シートをキャンセルして閉じられること

**前提条件**:
- シートが表示されている

**手順**:
1. キャンセルボタンをタップ
2. または閉じるボタン（×）をタップ

**期待結果**:
- シートが閉じる
- 入力内容が破棄される
- 元の画面に戻る

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。シートキャンセル動作の検証なし。
**テストメソッド**: `testSheetCancellation()`

---

## 5. アクセシビリティテスト (AccessibilityTests)

### TS-05-016: アクセシビリティラベル確認

**目的**: 主要なUI要素にアクセシビリティラベルがあること

**前提条件**:
- アプリが起動している

**手順**:
1. 主要なUI要素のアクセシビリティラベルを確認

**期待結果**:
- ボタン、リスト項目、フォーム要素にラベルが設定されている
- ラベルが意味のある内容である

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。アクセシビリティラベルの検証なし。
**テストメソッド**: `testAccessibilityLabelsExist()`

---

### TS-05-017: キーボードナビゲーション

**目的**: キーボードでナビゲーションできること

**前提条件**:
- アプリが起動している

**手順**:
1. Tabキーでフォーカスを移動
2. Enterキーで選択/実行

**期待結果**:
- フォーカスが順番に移動する
- フォーカスが視覚的に示される
- キーボードでアクションを実行できる

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。キーボードナビゲーションの検証なし。
**テストメソッド**: `testKeyboardNavigation()`

---

### TS-05-018: VoiceOver互換性

**目的**: VoiceOverで操作できること

**前提条件**:
- アプリが起動している

**手順**:
1. VoiceOverを有効化
2. 主要な操作を実行

**期待結果**:
- 全ての要素が読み上げ可能
- 操作が音声で確認できる

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。VoiceOver互換性の検証なし。
**テストメソッド**: `testVoiceOverCompatibility()`

---

## 6. パフォーマンステスト (PerformanceTests)

### TS-05-019: アプリ起動時間

**目的**: アプリが許容時間内に起動すること

**前提条件**: なし

**手順**:
1. アプリを起動
2. 起動時間を計測

**期待結果**:
- 起動時間が許容範囲内（<1秒推奨）
- 5回の計測で安定した結果

**計測指標**: `XCTApplicationLaunchMetric`

**実装状態**: ✅ 実装済み
**テストメソッド**: `testAppLaunchPerformance()`

---

### TS-05-020: 画面遷移レスポンス

**目的**: 画面遷移が滑らかに行われること

**前提条件**:
- アプリが起動している

**手順**:
1. 各画面間の遷移を実行
2. レスポンスを確認

**期待結果**:
- 遷移がスムーズ（60fps維持）
- フリーズやスタッタリングがない

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。画面遷移パフォーマンスの計測なし。
**テストメソッド**: `testNavigationPerformance()`

---

## 7. エラーハンドリングテスト (ErrorHandlingTests)

### TS-05-021: エラーアラート表示

**目的**: エラー発生時にアラートが表示されること

**前提条件**:
- アプリが起動している

**手順**:
1. エラーを発生させる操作を実行
2. アラートの表示を確認

**期待結果**:
- エラーアラートが表示される
- エラーメッセージが分かりやすい
- 閉じるボタンが機能する

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。エラーアラート表示の検証なし。
**テストメソッド**: `testErrorAlertDisplay()`

---

### TS-05-022: ネットワークエラー処理

**目的**: ネットワークエラー時に適切に処理されること

**前提条件**:
- アプリが起動している

**手順**:
1. ネットワークエラーを発生させる
2. アプリの動作を確認

**期待結果**:
- アプリがクラッシュしない
- エラーメッセージが表示される
- リトライオプションが提供される

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。ネットワークエラー処理の検証なし。
**テストメソッド**: `testNetworkErrorHandling()`

---

### TS-05-023: バリデーションエラー表示

**目的**: フォームバリデーションエラーが表示されること

**前提条件**:
- 新規作成シートが表示されている

**手順**:
1. 必須フィールドを空のまま送信
2. エラー表示を確認

**期待結果**:
- バリデーションエラーが表示される
- エラーのあるフィールドがハイライトされる
- エラーメッセージが具体的

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。バリデーションエラー表示の検証なし。
**テストメソッド**: `testValidationErrorDisplay()`

---

## 8. データ永続性テスト (DataPersistenceTests)

### TS-05-024: 再起動後データ保持

**目的**: 作成したデータが再起動後も保持されること

**前提条件**:
- データが作成されている

**手順**:
1. データを作成
2. アプリを終了
3. アプリを再起動
4. データの存在を確認

**期待結果**:
- 作成したデータが存在する
- データの内容が正確

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。データ永続性の検証なし。
**テストメソッド**: `testDataPersistsAfterRestart()`

---

### TS-05-025: 選択状態保持

**目的**: プロジェクト選択状態などが保持されること

**前提条件**:
- プロジェクトが選択されている

**手順**:
1. プロジェクトを選択
2. アプリを終了
3. アプリを再起動
4. 選択状態を確認

**期待結果**:
- 最後に選択したプロジェクトが選択された状態で起動

**実装状態**: 🔸 スタブ
**現状**: `assertWindowExists()` のみ。選択状態の保持検証なし。
**テストメソッド**: `testSelectionStatePersists()`

---

## テストクラス対応表

| シナリオID | テストクラス | メソッド |
|-----------|-------------|---------|
| TS-05-001〜003 | AppLaunchTests | 3メソッド |
| TS-05-004〜007 | NavigationTests | 4メソッド |
| TS-05-008〜011 | EmptyStateTests | 4メソッド |
| TS-05-012〜015 | InteractionTests | 4メソッド |
| TS-05-016〜018 | AccessibilityTests | 3メソッド |
| TS-05-019〜020 | PerformanceTests | 2メソッド |
| TS-05-021〜023 | ErrorHandlingTests | 3メソッド |
| TS-05-024〜025 | DataPersistenceTests | 2メソッド |

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2024-12-31 | 初版作成（実装状況を「✅実装済み」と誤記） |
| 2024-12-31 | 実装状況を正確に修正（`testAppLaunchPerformance()`以外は全て🔸スタブ） |
| 2025-01-01 | 要件再整理: サイドバー構成変更（Projects/Agents/Audit/History） |
