# 履歴・タイムライン画面 テストシナリオ

**対応UI仕様**: `docs/ui/08_history.md`
**テストクラス**: `HistoryTests`
**最終更新**: 2025-01-01

---

## 進捗サマリ

| 状態 | 件数 |
|------|------|
| ✅ 実装済み | 0 |
| 🔸 スタブ | 0 |
| ⏳ 未実装 | 10 |

---

## 画面概要

アプリに対するすべての入出力を時系列で閲覧する画面。監査チームと連携し、エージェント活動の透明性を担保する。

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  📜 操作履歴                                        [🔍 検索]    ⚙️          │
├────────────┬────────────────────────────────────────────────────────────────┤
│            │  フィルター                                                    │
│ 📁 Projects│  エージェント: [全員 ▼]  種別: [全て ▼]  期間: [今日 ▼]       │
│ 👥 Agents  │                                                                │
│ 🛡️ Audit   │  📅 2024-12-30                                                │
│ 📜 History │  ────────────────────────────────────────────────────────────  │
│ ┌────────┐ │  14:30:25  🔄 タスク状態変更                                  │
│ │Timeline│ │            🤖 backend-dev                                     │
│ └────────┘ │            📋 API実装: in_progress → done                     │
│            │                                                                │
├────────────┴────────────────────────────────────────────────────────────────┤
│  1,234 events | Archive: 5,678 events | Last sync: Just now                 │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## テストシナリオ

### TS-08-001: 履歴画面構成確認

**目的**: 履歴画面に必要な要素が表示されること

**前提条件**:
- アプリが起動している
- サイドバーでHistoryセクションが選択されている

**手順**:
1. 履歴画面を表示する
2. 画面構成を確認する

**期待結果**:
- 「操作履歴」タイトルが表示される
- 検索ボタンが存在する
- フィルターバーが表示される
- イベント一覧が表示される
- フッターにサマリ（イベント数、アーカイブ数、最終同期）が表示される

**PRD参照**: 画面概要
```
│  📜 操作履歴                                        [🔍 検索]    ⚙️          │
│  1,234 events | Archive: 5,678 events | Last sync: Just now                 │
```

**実装状態**: ⏳ 未実装

---

### TS-08-002: イベントカード表示

**目的**: イベントカードに必要な情報が表示されること

**前提条件**:
- 履歴画面が表示されている
- 少なくとも1つのイベントが存在する

**手順**:
1. イベントカードを確認する

**期待結果**:
- 時刻が表示される
- イベント種別アイコンと名前が表示される
- 操作者アイコンと名前が表示される
- 対象情報（タスク名等）が表示される
- プロジェクト名が表示される

**PRD参照**: イベントカード
```
│  14:30:25  🔄 タスク状態変更                                  │
│            🤖 backend-dev                                     │
│            📋 API実装: in_progress → done                     │
│            📁 ECサイト開発                                    │
```

**実装状態**: ⏳ 未実装

---

### TS-08-003: フィルターバー機能

**目的**: フィルターバーでイベントを絞り込めること

**前提条件**:
- 履歴画面が表示されている
- 複数のイベントが存在する

**手順**:
1. フィルターバーを確認する
2. 各フィルターを変更する
3. 結果を確認する

**期待結果**:
- 以下のフィルターが存在する:
  - エージェント（全員 / 特定エージェント）
  - 種別（全て / 状態変更 / 割り当て / 作成・編集 / MCP操作 / ロック操作）
  - 期間（今日 / 昨日 / 過去7日 / 過去30日 / カスタム）
- フィルター変更で一覧が即座に更新される

**PRD参照**: フィルターバー
```
│ エージェント: [全員 ▼]  種別: [全て ▼]  期間: [今日 ▼]  [🔍検索] │
```

**実装状態**: ⏳ 未実装

---

### TS-08-004: 詳細フィルター機能

**目的**: 詳細フィルターで複合条件を設定できること

**前提条件**:
- 履歴画面が表示されている

**手順**:
1. 詳細フィルターを展開する
2. 複数条件を設定する
3. 「適用」ボタンをタップする

**期待結果**:
- 詳細フィルターパネルが展開される
- 以下の設定が可能:
  - エージェント（チェックボックス複数選択）
  - イベント種別（チェックボックス複数選択）
  - 期間（カスタム日付範囲）
- 「リセット」ボタンでフィルターがクリアされる
- 「適用」ボタンでフィルターが適用される

**PRD参照**: 詳細フィルター
```
│  │ ☑ 🤖 backend-dev     │     │ ☑ 🔄 状態変更       │            │
│  │ ☑ 🤖 frontend-dev    │     │ ☑ 👤 割り当て       │            │
│  期間: 開始: [2024-12-01] ─ 終了: [2024-12-30]                    │
```

**実装状態**: ⏳ 未実装

---

### TS-08-005: イベント詳細モーダル

**目的**: イベントをクリックすると詳細モーダルが表示されること

**前提条件**:
- 履歴画面が表示されている
- 少なくとも1つのイベントが存在する

**手順**:
1. イベントカードをクリックする
2. モーダルの表示を確認する

**期待結果**:
- 詳細モーダルが表示される
- 以下の情報が表示される:
  - 種別
  - 日時
  - 操作者
  - 対象（タスク、プロジェクト）
  - 変更内容（変更前/変更後）
  - 関連情報（依存タスク、後続タスク等）
- 「タスクを開く」ボタンが存在する
- 「閉じる」ボタンが存在する

**PRD参照**: イベント詳細モーダル
```
│  種別           🔄 タスク状態変更                              │
│  日時           2024-12-30 14:30:25                           │
│  操作者         🤖 backend-dev                                │
│  変更前         🟢 in_progress                                 │
│  変更後         ✅ done                                        │
```

**実装状態**: ⏳ 未実装

---

### TS-08-006: MCP操作表示

**目的**: MCP操作イベントが正しく表示されること

**前提条件**:
- 履歴画面が表示されている
- MCP操作イベントが存在する

**手順**:
1. MCP操作イベントを確認する

**期待結果**:
- 閲覧系操作（🔍 MCP閲覧操作）が表示される
- 更新系操作（✏️ MCP更新操作）が表示される
- 操作名（list_tasks, update_task_status等）が表示される
- パラメータ情報が表示される
- 結果情報（閲覧系の場合）が表示される

**PRD参照**: MCP操作の表示
```
│  13:30:22  🔍 MCP閲覧操作                                          │
│            🤖 backend-dev                                          │
│            list_tasks                                              │
│            ├─ project: ECサイト開発                                │
│            └─ 結果: 12件                                          │
```

**実装状態**: ⏳ 未実装

---

### TS-08-007: 監査連携表示

**目的**: 監査関連イベントが正しく表示されること

**前提条件**:
- 履歴画面が表示されている
- ロック操作または監査警告イベントが存在する

**手順**:
1. ロック操作イベントを確認する
2. 監査警告イベントを確認する

**期待結果**:
- ロックイベント（🔒 タスクロック）が表示される
- 監査チーム名が表示される
- ロック理由が表示される
- 監査警告（⚠️ 監査警告）が表示される
- 警告内容が表示される

**PRD参照**: 監査連携表示
```
│  15:00:00  🔒 タスクロック                                         │
│            🛡️ security-auditor (セキュリティ監査チーム)            │
│            📋 API実装                                              │
│            理由: セキュリティレビュー待ち                           │
```

**実装状態**: ⏳ 未実装

---

### TS-08-008: アーカイブ管理

**目的**: アーカイブ情報の確認とアーカイブ閲覧ができること

**前提条件**:
- 履歴画面が表示されている

**手順**:
1. フッターのアーカイブ情報を確認する
2. 「アーカイブを閲覧」ボタンをタップする
3. アーカイブ閲覧モーダルを確認する

**期待結果**:
- アーカイブ件数が表示される
- アーカイブ閲覧モーダルが表示される
- 月別アーカイブ一覧が表示される
- 各月の以下の情報が表示される:
  - イベント数
  - サイズ
  - 「展開して閲覧」ボタン

**PRD参照**: アーカイブ管理
```
│  現在の履歴        1,234 件 (過去30日)                             │
│  アーカイブ済み    5,678 件                                        │
│  最終アーカイブ    2024-12-01 00:00                                │
```

**実装状態**: ⏳ 未実装

---

### TS-08-009: コンテキストメニュー表示

**目的**: イベントを右クリックするとコンテキストメニューが表示されること

**前提条件**:
- 履歴画面が表示されている
- 少なくとも1つのイベントが存在する

**手順**:
1. イベントカードを右クリックする
2. メニューの表示を確認する

**期待結果**:
- 以下のメニュー項目が表示される:
  - 詳細を開く
  - 関連タスクを開く
  - 操作者の活動を表示
  - 類似イベントを検索
  - 統計に追加
  - コピー

**PRD参照**: コンテキストメニュー
```
┌─────────────────────────────┐
│ 📋 詳細を開く               │
│ 📌 関連タスクを開く         │
│ 👤 操作者の活動を表示       │
│ 🔍 類似イベントを検索       │
│ 📊 統計に追加               │
│ 📋 コピー                   │
└─────────────────────────────┘
```

**実装状態**: ⏳ 未実装

---

### TS-08-010: リアルタイム更新

**目的**: 新規イベントがリアルタイムで表示されること

**前提条件**:
- 履歴画面が表示されている
- ライブモードが有効

**手順**:
1. ライブモードの状態を確認する
2. 新しいイベントが発生するのを待つ（または発生させる）
3. タイムラインの更新を確認する

**期待結果**:
- ライブモードインジケーターが表示される
- 新規イベント通知バナーが表示される（または自動追加）
- 新しいイベントがタイムラインの先頭に追加される
- 「一時停止」ボタンでライブ更新を停止できる

**PRD参照**: リアルタイム更新
```
│  ⚡ ライブモード: ON                                    [一時停止] │
│  🔔 新しいイベントがあります (3件)            [表示] [無視]        │
```

**実装状態**: ⏳ 未実装

---

## イベント種別仕様

| 種別 | アイコン | 説明 |
|------|---------|------|
| タスク状態変更 | 🔄 | backlog → todo → in_progress → done 等 |
| タスク割り当て | 👤 | エージェントへのアサイン・変更 |
| タスク作成 | ➕ | 新規タスク作成 |
| タスク編集 | ✏️ | タイトル・説明・優先度等の変更 |
| 依存関係設定 | 🔗 | タスク間依存関係の追加・削除 |
| コンテキスト追加 | 📝 | タスクへのコンテキスト情報追加 |
| ハンドオフ作成 | 🤝 | エージェント間引き継ぎ |
| MCP閲覧操作 | 🔍 | list_tasks, get_task_detail 等 |
| MCP更新操作 | ✏️ | update_task_status, create_task 等 |
| エージェント操作 | 🤖 | エージェント作成・編集・階層変更 |
| ロック操作 | 🔒 | タスクロック・エージェントロック |
| プロジェクト操作 | 📁 | プロジェクト作成・編集・アーカイブ |
| 監査警告 | ⚠️ | 監査チームからの警告 |

---

## フィルターオプション仕様

| フィルター | オプション |
|-----------|-----------|
| エージェント | 全員 / 特定エージェント選択（複数可） |
| 種別 | 全て / 状態変更 / 割り当て / 作成・編集 / MCP操作 / ロック操作 |
| 期間 | 今日 / 昨日 / 過去7日 / 過去30日 / カスタム範囲 |
| プロジェクト | 全て / 特定プロジェクト選択 |
| タスク | 特定タスクのみ（検索から選択） |

---

## キーボードショートカット仕様

| ショートカット | アクション |
|---------------|-----------|
| ⌘ F | 検索フォーカス |
| ⌘ 5 | 履歴画面を開く |
| ↑ / ↓ | イベント間移動 |
| Enter | イベント詳細を開く |
| Esc | モーダルを閉じる / フィルターリセット |
| ⌘ R | 履歴を更新 |

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2025-01-01 | 初版作成 |
