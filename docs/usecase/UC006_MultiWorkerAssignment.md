# UC006: 複数ワーカーへのタスク割り当て

## 概要

マネージャーエージェントが複数のワーカーに対して、各ワーカーの特性（専門分野）に応じてタスクを適切に割り当てるフロー。

---

## 検証したいこと

1. **複数ワーカーへの委任**: マネージャーが複数のワーカーにサブタスクを割り当てられる
2. **特性に基づく割り当て**: 各ワーカーの役割（role）に応じて適切なタスクが割り当てられる
3. **並列実行**: 複数のワーカーが並行してタスクを実行できる
4. **成果物の生成**: 各ワーカーが期待される成果物を生成する

---

## フロー

```
親タスク「ドキュメントを翻訳」
  │
  │ マネージャーが受け取る
  │ マネージャーがサブタスクを作成
  │ ・日本語翻訳タスク → 日本語担当ワーカー
  │ ・中国語翻訳タスク → 中国語担当ワーカー
  ↓
サブタスク A（日本語翻訳、assignee: agt_uc006_ja）
  │ → hello_ja.txt 生成

サブタスク B（中国語翻訳、assignee: agt_uc006_zh）
  │ → hello_zh.txt 生成
```

---

## 前提条件

- マネージャーエージェントが登録済み
- 日本語翻訳ワーカーエージェントが登録済み（role: 日本語への翻訳）
- 中国語翻訳ワーカーエージェントが登録済み（role: 中国語への翻訳）
- プロジェクトが存在（working_directory: /tmp/uc006）
- 入力ファイルが存在（hello.txt: "Hello, World!"）
- 親タスクが存在し、マネージャーに割り当て済み

---

## アクター

| アクター | 種別 | ID | 役割 |
|----------|------|-----|------|
| 翻訳マネージャー | AI | agt_uc006_manager | タスクを分解し、適切なワーカーに割り当て |
| 日本語翻訳担当 | AI | agt_uc006_ja | 日本語への翻訳を担当 |
| 中国語翻訳担当 | AI | agt_uc006_zh | 中国語への翻訳を担当 |

---

## 検証項目（アサーション）

### タスク割り当ての検証

| # | 検証内容 | 確認方法 |
|---|----------|----------|
| 1 | マネージャーがサブタスクを作成した | DBに親タスクを`parent_task_id`に持つタスクが2つ存在 |
| 2 | 日本語翻訳タスクが日本語担当に割り当てられた | DB: 日本語関連タスクの`assignee_id = agt_uc006_ja` |
| 3 | 中国語翻訳タスクが中国語担当に割り当てられた | DB: 中国語関連タスクの`assignee_id = agt_uc006_zh` |

### 成果物の検証

| # | 検証内容 | 確認方法 |
|---|----------|----------|
| 4 | 日本語翻訳ファイルが生成された | `test -f /tmp/uc006/hello_ja.txt` |
| 5 | 中国語翻訳ファイルが生成された | `test -f /tmp/uc006/hello_zh.txt` |

### ステータスの検証

| # | 検証内容 | 確認方法 |
|---|----------|----------|
| 6 | 全サブタスクのステータスが`done` | DB: 全サブタスクの`status = 'done'` |
| 7 | 親タスクのステータスが`done` | DB: `tasks.status = 'done'` |

---

## テストデータ

```
プロジェクト:
  - prj_uc006: UC006テスト用プロジェクト（working_dir: /tmp/uc006）

エージェント:
  - agt_uc006_manager: 翻訳マネージャー（hierarchy_type: manager）
  - agt_uc006_ja: 日本語翻訳担当（hierarchy_type: worker, role: 日本語への翻訳）
  - agt_uc006_zh: 中国語翻訳担当（hierarchy_type: worker, role: 中国語への翻訳）

タスク（初期状態）:
  - tsk_uc006_main: 親タスク（assignee: マネージャー、status: backlog）
    title: "ドキュメントを翻訳してください"
    description: "hello.txt を日本語と中国語に翻訳してください"
    ※ワーカーへの言及なし（マネージャーが自分で判断する）

入力ファイル:
  - /tmp/uc006/hello.txt: "Hello, World!"
```

---

## 成功条件

```
1. DBにサブタスクが2つ存在する
   - parent_task_id = tsk_uc006_main

2. 日本語タスクが日本語担当に割り当てられている
   - サブタスクのtitleまたはdescriptionに「日本語」を含む
   - assignee_id = agt_uc006_ja

3. 中国語タスクが中国語担当に割り当てられている
   - サブタスクのtitleまたはdescriptionに「中国語」を含む
   - assignee_id = agt_uc006_zh

4. 成果物ファイルが存在する
   - /tmp/uc006/hello_ja.txt
   - /tmp/uc006/hello_zh.txt

5. 全タスクのステータスが done
   - tsk_uc006_main.status = done
   - 全サブタスク.status = done
```

---

## 関連ユースケース

| UC | 関係 |
|----|------|
| UC001 | 単一エージェントによるタスク実行（基本形） |
| UC005 | マネージャー → 単一ワーカー委任 |
| **UC006** | **マネージャー → 複数ワーカー割り当て（本UC）** |

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2026-01-10 | 初版作成 |
