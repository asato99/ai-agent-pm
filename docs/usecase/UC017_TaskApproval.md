# UC017: ã‚¿ã‚¹ã‚¯æ‰¿èªãƒ•ãƒ­ãƒ¼

## æ¦‚è¦

Workerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒä½œæˆã—ãŸã‚¿ã‚¹ã‚¯ã‚’Managerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæ‰¿èªãƒ»å´ä¸‹ã™ã‚‹æ©Ÿèƒ½ã€‚
ã‚¿ã‚¹ã‚¯ã®å“è³ªç®¡ç†ã¨æ¨©é™éšŽå±¤ã«åŸºã¥ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã‚’å®Ÿç¾ã™ã‚‹ã€‚

---

## å‰ææ¡ä»¶

- Manageræ¨©é™ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå­˜åœ¨
- Workeræ¨©é™ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå­˜åœ¨
- WorkerãŒä½œæˆã—ãŸ`pendingApproval`çŠ¶æ…‹ã®ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨
  - `requesterId`ã«Workerã®IDãŒè¨­å®šæ¸ˆã¿

---

## ã‚¢ã‚¯ã‚¿ãƒ¼

| ã‚¢ã‚¯ã‚¿ãƒ¼ | ç¨®åˆ¥ | å½¹å‰² |
|----------|------|------|
| Manager | AI/Human | ã‚¿ã‚¹ã‚¯ã®æ‰¿èªãƒ»å´ä¸‹ã‚’è¡Œã† |
| Worker | AI | ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—æ‰¿èªã‚’ä¾é ¼ã™ã‚‹ |

---

## åŸºæœ¬ãƒ•ãƒ­ãƒ¼ï¼ˆæ‰¿èªï¼‰

### 1. ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆManagerï¼‰

```
Manager â†’ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§Agent ID/Passkeyã‚’å…¥åŠ›
  â†“
ã‚·ã‚¹ãƒ†ãƒ  â†’ èªè¨¼æˆåŠŸã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã¸é·ç§»
```

### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠžï¼ˆManagerï¼‰

```
Manager â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‹ã‚‰ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯
  â†“
ã‚·ã‚¹ãƒ†ãƒ  â†’ ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰ç”»é¢ã‚’è¡¨ç¤º
```

### 3. æ‰¿èªå¾…ã¡ã‚¿ã‚¹ã‚¯ã®ç¢ºèªï¼ˆManagerï¼‰

```
Manager â†’ ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰ã§æ‰¿èªå¾…ã¡ã‚¿ã‚¹ã‚¯ã‚’ç¢ºèª
  - è¡¨ç¤º: ã‚ªãƒ¬ãƒ³ã‚¸èƒŒæ™¯
  - è¡¨ç¤º: ã€ŒðŸ”” æ‰¿èªå¾…ã¡ã€ãƒãƒƒã‚¸
  â†“
Manager â†’ ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯
  â†“
ã‚·ã‚¹ãƒ†ãƒ  â†’ ã‚¿ã‚¹ã‚¯è©³ç´°ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
```

### 4. ã‚¿ã‚¹ã‚¯è©³ç´°ã®ç¢ºèªï¼ˆManagerï¼‰

```
è©³ç´°ãƒ‘ãƒãƒ«è¡¨ç¤ºå†…å®¹:
  - ã€Œæ‰¿èªå¾…ã¡ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰
  - ã€Œä¾é ¼è€…: [Workerå]ã€
  - ã€Œæ‰¿èªã€ãƒœã‚¿ãƒ³
  - ã€Œå´ä¸‹ã€ãƒœã‚¿ãƒ³
```

### 5. æ‰¿èªå®Ÿè¡Œï¼ˆManagerï¼‰

```
Manager â†’ ã€Œæ‰¿èªã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
  â†“
ã‚·ã‚¹ãƒ†ãƒ  â†’ ApproveTaskUseCaseå®Ÿè¡Œ
  - approvalStatus: pendingApproval â†’ approved
  - ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²: task_approved
  â†“
ã‚·ã‚¹ãƒ†ãƒ  â†’ è©³ç´°ãƒ‘ãƒãƒ«ã‚’æ›´æ–°
  - æ‰¿èªå¾…ã¡ãƒãƒƒã‚¸ãŒæ¶ˆãˆã‚‹
  - ä¾é ¼è€…æƒ…å ±ãŒæ¶ˆãˆã‚‹
  - æ‰¿èª/å´ä¸‹ãƒœã‚¿ãƒ³ãŒæ¶ˆãˆã‚‹
```

### 6. ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰ç¢ºèªï¼ˆManagerï¼‰

```
Manager â†’ ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
  â†“
ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰è¡¨ç¤º:
  - ã‚ªãƒ¬ãƒ³ã‚¸èƒŒæ™¯ãŒæ¶ˆãˆã¦ã„ã‚‹
  - ã€ŒðŸ”” æ‰¿èªå¾…ã¡ã€ãƒãƒƒã‚¸ãŒæ¶ˆãˆã¦ã„ã‚‹
  - é€šå¸¸ã®ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
```

---

## ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

```
Manager           Web UI            REST API          UseCase
   |                 |                  |                |
   |--ãƒ­ã‚°ã‚¤ãƒ³------>|                  |                |
   |                 |--POST /login---->|                |
   |                 |<---200 OK--------|                |
   |                 |                  |                |
   |--ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ-->|                  |                |
   |  é¸æŠž           |--GET /projects-->|                |
   |                 |<---projects------|                |
   |                 |                  |                |
   |--ã‚¿ã‚¹ã‚¯ç¢ºèª---->|                  |                |
   |  (ã‚ªãƒ¬ãƒ³ã‚¸èƒŒæ™¯) |--GET /tasks----->|                |
   |                 |<---tasks---------|                |
   |                 |                  |                |
   |--ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯>|                  |                |
   |                 |--è©³ç´°ãƒ‘ãƒãƒ«è¡¨ç¤º--|                |
   |                 |                  |                |
   |--æ‰¿èªãƒœã‚¿ãƒ³---->|                  |                |
   |                 |--POST /approve-->|                |
   |                 |                  |--execute------>|
   |                 |                  |  ApproveTask   |
   |                 |                  |<---success-----|
   |                 |<---200 OK--------|                |
   |                 |                  |                |
   |<--UIæ›´æ–°--------|                  |                |
   |  (ãƒãƒƒã‚¸æ¶ˆåŽ»)   |                  |                |
```

---

## UIçŠ¶æ…‹é·ç§»

### ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ï¼ˆTaskBoardViewï¼‰

| çŠ¶æ…‹ | èƒŒæ™¯è‰² | ãƒãƒƒã‚¸ |
|------|--------|--------|
| pendingApproval | ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆopacity 0.1ï¼‰ | ðŸ”” æ‰¿èªå¾…ã¡ |
| rejected | ã‚°ãƒ¬ãƒ¼ï¼ˆopacity 0.1ï¼‰ | âŒ å´ä¸‹ |
| approved | æ¨™æº–ï¼ˆtextBackgroundColorï¼‰ | ãªã— |

### è©³ç´°ãƒ‘ãƒãƒ«ï¼ˆTaskDetailViewï¼‰

| çŠ¶æ…‹ | è¡¨ç¤ºè¦ç´  |
|------|----------|
| pendingApproval | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã€ä¾é ¼è€…ã€æ‰¿èªãƒœã‚¿ãƒ³ã€å´ä¸‹ãƒœã‚¿ãƒ³ |
| rejected | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã€ä¾é ¼è€…ã€å´ä¸‹ç†ç”± |
| approved | ãªã—ï¼ˆæ‰¿èªã‚»ã‚¯ã‚·ãƒ§ãƒ³éžè¡¨ç¤ºï¼‰ |

---

## æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ

| ã‚¹ãƒ†ãƒƒãƒ— | æ¤œè¨¼å†…å®¹ |
|---------|---------|
| 3 | pendingApprovalã‚¿ã‚¹ã‚¯ãŒã‚ªãƒ¬ãƒ³ã‚¸èƒŒæ™¯ã¨ãƒãƒƒã‚¸ã§è¡¨ç¤ºã•ã‚Œã‚‹ |
| 4 | è©³ç´°ãƒ‘ãƒãƒ«ã«æ‰¿èªUIè¦ç´ ï¼ˆãƒãƒƒã‚¸ã€ä¾é ¼è€…ã€ãƒœã‚¿ãƒ³ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ |
| 5 | æ‰¿èªãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯å¾Œã€UIè¦ç´ ãŒé©åˆ‡ã«æ¶ˆãˆã‚‹ |
| 6 | ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ãŒé€šå¸¸è¡¨ç¤ºã«æˆ»ã‚‹ |

---

## é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

| ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ | æ“ä½œ |
|--------------|------|
| Task | æ›´æ–°ï¼ˆapprovalStatus: pendingApproval â†’ approvedï¼‰ |
| Agent | å‚ç…§ï¼ˆä¾é ¼è€…æƒ…å ±ã€æ‰¿èªè€…æ¨©é™ç¢ºèªï¼‰ |
| StateChangeEvent | è¨˜éŒ²ï¼ˆtask_approved ã‚¤ãƒ™ãƒ³ãƒˆï¼‰ |

---

## ä»£æ›¿ãƒ•ãƒ­ãƒ¼ï¼ˆå´ä¸‹ï¼‰

### 5b. å´ä¸‹å®Ÿè¡Œï¼ˆManagerï¼‰

```
Manager â†’ ã€Œå´ä¸‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
  â†“
ã‚·ã‚¹ãƒ†ãƒ  â†’ å´ä¸‹ç†ç”±ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
  â†“
Manager â†’ å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ç¢ºå®š
  â†“
ã‚·ã‚¹ãƒ†ãƒ  â†’ RejectTaskUseCaseå®Ÿè¡Œ
  - approvalStatus: pendingApproval â†’ rejected
  - rejectedReason: [å…¥åŠ›ã•ã‚ŒãŸç†ç”±]
  - ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²: task_rejected
```

---

## å‚™è€ƒ

- æ‰¿èªæ¨©é™ã¯Managerä»¥ä¸Šã®éšŽå±¤ã‚’æŒã¤ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é™å®š
- Workeræ¨©é™ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¯æ‰¿èª/å´ä¸‹ãƒœã‚¿ãƒ³ã¯è¡¨ç¤ºã•ã‚Œãªã„
- æ‰¿èªå¾Œã®ã‚¿ã‚¹ã‚¯ã¯é€šå¸¸ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆtodo â†’ in_progress â†’ doneï¼‰ã«å¾“ã†
