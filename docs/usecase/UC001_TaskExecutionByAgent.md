# UC001: エージェントによるタスク実行

## 概要

ユーザーがタスクを作成し、エージェントに割り当てて実行させる基本フロー。

---

## 前提条件

- エージェントが1名登録済み
- プロジェクトが存在し、エージェントがアサイン可能な状態

---

## アクター

| アクター | 種別 | 役割 |
|----------|------|------|
| ユーザー | Human | タスク作成・割り当て・監視（上位エージェント） |
| エージェント | AI | タスク実行・作業タスク管理（下位エージェント） |

---

## 基本フロー

### 1. タスク作成（ユーザー）

```
ユーザー → タスク作成
  - タイトル: ドキュメントの作成
  - 説明: テストのドキュメント.md を作成してください。内容はテスト１について記述してください。
  - ステータス: backlog
```

※ ファイル名や成果物の内容は、タスクの説明（description）に指示として含める

### 2. エージェント割り当て（ユーザー）

```
ユーザー → タスクにエージェントをアサイン
  - assigneeId: [エージェントID]
```

### 3. ステータス変更（ユーザー）

```
ユーザー → ステータスを in_progress に変更
  ↓
システム → エージェントをキック（実行開始通知）
```

### 4. 作業計画（エージェント）

```
エージェント → 自分の作業を作業タスクとして追加（依存関係で親タスクに紐づけ）
  - 作業タスク1: 要件確認 (todo) ← 親タスクに依存
  - 作業タスク2: 下書き作成 (todo) ← 作業タスク1に依存
  - 作業タスク3: レビュー依頼 (todo) ← 作業タスク2に依存
  - 作業タスク4: 最終調整 (todo) ← 作業タスク3に依存
```

### 5. タスク実行（エージェント）

```
エージェント → 作業タスクを順次実行（依存関係に従って）
  作業タスク1: todo → in_progress → done
  作業タスク2: todo → in_progress → done
  作業タスク3: todo → in_progress → done
  作業タスク4: todo → in_progress → done
```

### 6. 完了通知（エージェント）

```
エージェント → 親タスクを done に変更
  ↓
システム → 親（ユーザー）に完了通知
```

---

## シーケンス図

```
ユーザー          システム          エージェント
   |                 |                   |
   |--タスク作成---->|                   |
   |                 |                   |
   |--エージェント-->|                   |
   |  割り当て       |                   |
   |                 |                   |
   |--in_progress--->|                   |
   |                 |---キック--------->|
   |                 |                   |
   |                 |                   |--作業計画
   |                 |                   |  (作業タスク追加)
   |                 |                   |
   |                 |                   |--順次実行
   |                 |                   |  ループ
   |                 |                   |
   |                 |<--完了通知--------|
   |<--通知----------|                   |
   |                 |                   |
```

---

## ステータス遷移

### 親タスク
```
backlog → (割り当て) → todo → in_progress → done
```

### 作業タスク（下位エージェント作成）
```
todo → in_progress → done
```

---

## 関連エンティティ

| エンティティ | 操作 |
|--------------|------|
| Task | 作成、更新（ステータス、assigneeId、dependencies） |
| Agent | 参照（割り当て対象、親子関係） |
| StateChangeEvent | 記録（ステータス変更履歴） |
| Handoff | 作成（完了通知時） |

---

## 備考

- エージェントのキック方法は実装依存（Webhook、MCP通知など）
- 作業タスクは `dependencies` で親タスクに紐づく（依存関係）
- エージェントの並列実行数は `maxParallelTasks` で制限
- エージェント間の親子関係は `parentAgentId` で表現（AGENTS.md参照）
