# UC001: エージェントによるタスク実行

## 概要

ユーザーがタスクを作成し、エージェントに割り当てて実行させる基本フロー。

---

## 前提条件

- エージェントが1名登録済み
- プロジェクトが存在し、エージェントがアサイン可能な状態

---

## アクター

| アクター | 種別 | 役割 |
|----------|------|------|
| ユーザー | Human | タスク作成・割り当て・監視 |
| エージェント | AI | タスク実行・子タスク管理 |

---

## 基本フロー

### 1. タスク作成（ユーザー）

```
ユーザー → タスク作成
  - タイトル: ドキュメントの作成
  - ファイル名: テストのドキュメント
  - 内容: テスト１
  - ステータス: backlog
```

### 2. エージェント割り当て（ユーザー）

```
ユーザー → タスクにエージェントをアサイン
  - assigneeId: [エージェントID]
```

### 3. ステータス変更（ユーザー）

```
ユーザー → ステータスを in_progress に変更
  ↓
システム → エージェントをキック（実行開始通知）
```

### 4. 作業計画（エージェント）

```
エージェント → 自分の作業を子タスクとして追加
  - 子タスク1: 要件確認 (todo)
  - 子タスク2: 下書き作成 (todo)
  - 子タスク3: レビュー依頼 (todo)
  - 子タスク4: 最終調整 (todo)
```

### 5. タスク実行（エージェント）

```
エージェント → 子タスクを順次実行
  子タスク1: todo → in_progress → done
  子タスク2: todo → in_progress → done
  子タスク3: todo → in_progress → done
  子タスク4: todo → in_progress → done
```

### 6. 完了通知（エージェント）

```
エージェント → 親タスクを done に変更
  ↓
システム → 親（ユーザー）に完了通知
```

---

## シーケンス図

```
ユーザー          システム          エージェント
   |                 |                   |
   |--タスク作成---->|                   |
   |                 |                   |
   |--エージェント-->|                   |
   |  割り当て       |                   |
   |                 |                   |
   |--in_progress--->|                   |
   |                 |---キック--------->|
   |                 |                   |
   |                 |                   |--作業計画
   |                 |                   |  (子タスク追加)
   |                 |                   |
   |                 |                   |--順次実行
   |                 |                   |  ループ
   |                 |                   |
   |                 |<--完了通知--------|
   |<--通知----------|                   |
   |                 |                   |
```

---

## ステータス遷移

### 親タスク
```
backlog → (割り当て) → todo → in_progress → done
```

### 子タスク（エージェント作成）
```
todo → in_progress → done
```

---

## 関連エンティティ

| エンティティ | 操作 |
|--------------|------|
| Task | 作成、更新（ステータス、assigneeId） |
| Agent | 参照（割り当て対象） |
| StateChangeEvent | 記録（ステータス変更履歴） |
| Handoff | 作成（完了通知時） |

---

## 備考

- エージェントのキック方法は実装依存（Webhook、MCP通知など）
- 子タスクは `parentTaskId` で親タスクに紐づく
- エージェントの並列実行数は `maxParallelTasks` で制限
