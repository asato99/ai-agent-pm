# æ¨©é™ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å‰²ã‚Šå½“ã¦ã‚‹æ¨©é™ã‚¿ã‚¤ãƒ—ï¼ˆRoleï¼‰ã®å®šç¾©ã¨ã€å„æ“ä½œã®èªå¯ãƒ«ãƒ¼ãƒ«ã€‚

---

## è¨­è¨ˆæ–¹é‡

1. **ã‚¢ãƒ—ãƒªå´ã§äº‹å‰å®šç¾©** - 4ã¤ã®æ¨™æº–æ¨©é™ã‚¿ã‚¤ãƒ—ã‚’æä¾›
2. **å°†æ¥ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯¾å¿œ** - ã‚«ã‚¹ã‚¿ãƒ æ¨©é™ã‚¿ã‚¤ãƒ—ä½œæˆã®æ‹¡å¼µæ€§ã‚’ç¢ºä¿
3. **æœ€å°æ¨©é™ã®åŸå‰‡** - å¿…è¦æœ€å°é™ã®æ¨©é™ã®ã¿ä»˜ä¸

---

## æ¨©é™ã‚¿ã‚¤ãƒ—ï¼ˆAgentRoleï¼‰

### æ¨™æº–æ¨©é™ã‚¿ã‚¤ãƒ—

```
AgentRole {
    id: RoleID                     // ä¸€æ„è­˜åˆ¥å­
    name: String                   // è¡¨ç¤ºå
    description: String            // èª¬æ˜
    permissions: [Permission]      // è¨±å¯ã•ã‚ŒãŸæ“ä½œã®ãƒªã‚¹ãƒˆ
    isSystem: Bool                 // ã‚·ã‚¹ãƒ†ãƒ å®šç¾©ï¼ˆç·¨é›†ä¸å¯ï¼‰
    createdAt: Date
    updatedAt: Date
}
```

| Role | åå‰ | èª¬æ˜ | æƒ³å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ |
|------|------|------|-------------|
| `owner` | Owner | å…¨æ¨©é™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†ã‚’å«ã‚€ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆäººé–“ï¼‰ |
| `manager` | Manager | ã‚¿ã‚¹ã‚¯ç®¡ç†æ¨©é™ã€‚ä½œæˆãƒ»ã‚¢ã‚µã‚¤ãƒ³ãƒ»é€²æ—ç®¡ç† | PMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ãƒªãƒ¼ãƒ‰ |
| `worker` | Worker | ã‚¿ã‚¹ã‚¯å®Ÿè¡Œæ¨©é™ã€‚è‡ªåˆ†ã®ã‚¿ã‚¹ã‚¯ã®ä½œæ¥­ | é–‹ç™ºã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ |
| `viewer` | Viewer | é–²è¦§ã®ã¿ã€‚å¤‰æ›´æ¨©é™ãªã— | ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã€ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ |

### æ¨©é™ã®éšå±¤

```
Owner âŠƒ Manager âŠƒ Worker âŠƒ Viewer

Owner:   å…¨ã¦ã®æ“ä½œãŒå¯èƒ½
Manager: Owneræ¨©é™ - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†
Worker:  Manageræ¨©é™ - ã‚¿ã‚¹ã‚¯ä½œæˆ/ã‚¢ã‚µã‚¤ãƒ³ï¼ˆè‡ªåˆ†ã¸ã®ã‚¢ã‚µã‚¤ãƒ³ã¯å¯ï¼‰
Viewer:  èª­ã¿å–ã‚Šã®ã¿
```

---

## æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œ

| æ“ä½œ | Owner | Manager | Worker | Viewer |
|------|:-----:|:-------:|:------:|:------:|
| `project.create` | âœ… | âŒ | âŒ | âŒ |
| `project.read` | âœ… | âœ… | âœ… | âœ… |
| `project.update` | âœ… | âœ… | âŒ | âŒ |
| `project.delete` | âœ… | âŒ | âŒ | âŒ |
| `project.archive` | âœ… | âœ… | âŒ | âŒ |

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ“ä½œ

| æ“ä½œ | Owner | Manager | Worker | Viewer |
|------|:-----:|:-------:|:------:|:------:|
| `agent.create` | âœ… | âŒ | âŒ | âŒ |
| `agent.read` | âœ… | âœ… | âœ… | âœ… |
| `agent.update` | âœ… | âŒ | âŒ | âŒ |
| `agent.delete` | âœ… | âŒ | âŒ | âŒ |
| `agent.list` | âœ… | âœ… | âœ… | âœ… |

### ã‚¿ã‚¹ã‚¯æ“ä½œ

| æ“ä½œ | Owner | Manager | Worker | Viewer |
|------|:-----:|:-------:|:------:|:------:|
| `task.create` | âœ… | âœ… | âŒ | âŒ |
| `task.read` | âœ… | âœ… | âœ… | âœ… |
| `task.update` | âœ… | âœ… | âŒ | âŒ |
| `task.delete` | âœ… | âœ… | âŒ | âŒ |
| `task.assign` | âœ… | âœ… | âŒ | âŒ |
| `task.assign_self` | âœ… | âœ… | âœ… | âŒ |
| `task.unassign_self` | âœ… | âœ… | âœ… | âŒ |
| `task.status.update_own` | âœ… | âœ… | âœ… | âŒ |
| `task.status.update_any` | âœ… | âœ… | âŒ | âŒ |

### ã‚µãƒ–ã‚¿ã‚¹ã‚¯æ“ä½œ

| æ“ä½œ | Owner | Manager | Worker | Viewer |
|------|:-----:|:-------:|:------:|:------:|
| `subtask.create_own` | âœ… | âœ… | âœ… | âŒ |
| `subtask.create_any` | âœ… | âœ… | âŒ | âŒ |
| `subtask.read` | âœ… | âœ… | âœ… | âœ… |
| `subtask.update_own` | âœ… | âœ… | âœ… | âŒ |
| `subtask.update_any` | âœ… | âœ… | âŒ | âŒ |
| `subtask.delete_own` | âœ… | âœ… | âœ… | âŒ |
| `subtask.delete_any` | âœ… | âœ… | âŒ | âŒ |

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ“ä½œ

| æ“ä½œ | Owner | Manager | Worker | Viewer |
|------|:-----:|:-------:|:------:|:------:|
| `context.create` | âœ… | âœ… | âœ… | âŒ |
| `context.read` | âœ… | âœ… | âœ… | âœ… |
| `context.update_own` | âœ… | âœ… | âœ… | âŒ |
| `context.delete_own` | âœ… | âœ… | âœ… | âŒ |
| `context.delete_any` | âœ… | âœ… | âŒ | âŒ |

### ãƒãƒ³ãƒ‰ã‚ªãƒ•æ“ä½œ

| æ“ä½œ | Owner | Manager | Worker | Viewer |
|------|:-----:|:-------:|:------:|:------:|
| `handoff.create` | âœ… | âœ… | âœ… | âŒ |
| `handoff.read` | âœ… | âœ… | âœ… | âœ… |
| `handoff.acknowledge` | âœ… | âœ… | âœ… | âŒ |
| `handoff.reject` | âœ… | âœ… | âœ… | âŒ |

### ã‚»ãƒƒã‚·ãƒ§ãƒ³æ“ä½œ

| æ“ä½œ | Owner | Manager | Worker | Viewer |
|------|:-----:|:-------:|:------:|:------:|
| `session.start` | âœ… | âœ… | âœ… | âœ… |
| `session.end` | âœ… | âœ… | âœ… | âœ… |
| `session.read_own` | âœ… | âœ… | âœ… | âœ… |
| `session.read_any` | âœ… | âœ… | âŒ | âŒ |

---

## Permission ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

```
Permission {
    id: String                     // ä¾‹: "task.create", "task.assign"
    resource: ResourceType         // å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹
    action: ActionType             // æ“ä½œç¨®åˆ¥
    scope: Scope                   // é©ç”¨ç¯„å›²
}

ResourceType {
    project
    agent
    task
    subtask
    context
    handoff
    session
}

ActionType {
    create
    read
    update
    delete
    assign
    unassign
    archive
    acknowledge
    reject
}

Scope {
    all                            // å…¨ã¦ã®ãƒªã‚½ãƒ¼ã‚¹
    own                            // è‡ªåˆ†ãŒé–¢ä¿‚ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ã¿
    assigned                       // è‡ªåˆ†ã«ã‚¢ã‚µã‚¤ãƒ³ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã®ã¿
}
```

---

## æ¨©é™ãƒã‚§ãƒƒã‚¯ã®å®Ÿè£…

### MCP Toolå‘¼ã³å‡ºã—æ™‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. MCPã‚µãƒ¼ãƒãƒ¼ãŒToolå‘¼ã³å‡ºã—ã‚’å—ä¿¡                         â”‚
â”‚     â†“                                                       â”‚
â”‚  2. --agent-id ã‹ã‚‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæƒ…å ±ã‚’å–å¾—                   â”‚
â”‚     â†“                                                       â”‚
â”‚  3. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®Roleã‹ã‚‰æ¨©é™ãƒªã‚¹ãƒˆã‚’å–å¾—                  â”‚
â”‚     â†“                                                       â”‚
â”‚  4. è¦æ±‚ã•ã‚ŒãŸæ“ä½œãŒæ¨©é™ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã‹ç¢ºèª              â”‚
â”‚     â†“                                                       â”‚
â”‚  5a. æ¨©é™ã‚ã‚Š â†’ æ“ä½œå®Ÿè¡Œ                                    â”‚
â”‚  5b. æ¨©é™ãªã— â†’ ã‚¨ãƒ©ãƒ¼è¿”å´ (permission_denied)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨©é™ãƒã‚§ãƒƒã‚¯ä¾‹ï¼ˆSwiftï¼‰

```swift
protocol PermissionChecker {
    func canPerform(_ permission: Permission, agent: Agent) -> Bool
}

final class RoleBasedPermissionChecker: PermissionChecker {
    func canPerform(_ permission: Permission, agent: Agent) -> Bool {
        let role = agent.role
        return role.permissions.contains(permission)
    }
}

// ä½¿ç”¨ä¾‹
func assignTask(taskId: TaskID, toAgent: AgentID, byAgent: Agent) throws {
    guard permissionChecker.canPerform(.taskAssign, agent: byAgent) else {
        throw PermissionError.denied(
            agent: byAgent.id,
            permission: .taskAssign,
            message: "Workeræ¨©é™ã§ã¯ã‚¿ã‚¹ã‚¯ã®ã‚¢ã‚µã‚¤ãƒ³ã¯ã§ãã¾ã›ã‚“"
        )
    }
    // ã‚¢ã‚µã‚¤ãƒ³å‡¦ç†...
}
```

---

## å…¸å‹çš„ãªæ§‹æˆä¾‹

### ä¾‹1: å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ1äºº + AIè¤‡æ•°ï¼‰

```
ğŸ‘¤ owner (human, Owner)
   â””â”€â”€ å…¨ã¦ã®ç®¡ç†

ğŸ¤– dev-agent (ai, Worker)
   â””â”€â”€ ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¨˜éŒ²
```

### ä¾‹2: è‡ªå¾‹å‹AIãƒãƒ¼ãƒ 

```
ğŸ‘¤ owner (human, Owner)
   â””â”€â”€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã€ç›£ç£

ğŸ¤– pm-agent (ai, Manager)
   â””â”€â”€ ã‚¿ã‚¹ã‚¯ä½œæˆãƒ»åˆ†è§£ã€ã‚¢ã‚µã‚¤ãƒ³ã€é€²æ—ç®¡ç†

ğŸ¤– frontend-dev (ai, Worker)
ğŸ¤– backend-dev (ai, Worker)
ğŸ¤– test-agent (ai, Worker)
   â””â”€â”€ å„è‡ªã®ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ

ğŸ¤– reviewer (ai, Viewer)
   â””â”€â”€ ã‚³ãƒ¼ãƒ‰é–²è¦§ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆå°†æ¥æ‹¡å¼µï¼‰
```

### ä¾‹3: äººé–“ãƒãƒ¼ãƒ  + AIè£œåŠ©

```
ğŸ‘¤ owner (human, Owner)
ğŸ‘¤ pm (human, Manager)
ğŸ‘¤ dev-lead (human, Manager)

ğŸ¤– coding-assistant (ai, Worker)
ğŸ¤– doc-generator (ai, Worker)
```

---

## å°†æ¥ã®æ‹¡å¼µ: ã‚«ã‚¹ã‚¿ãƒ æ¨©é™ã‚¿ã‚¤ãƒ—

### è¨­è¨ˆæ–¹é‡

```
1. ã‚·ã‚¹ãƒ†ãƒ å®šç¾©ã®4ã‚¿ã‚¤ãƒ—ã¯ç·¨é›†ä¸å¯ï¼ˆisSystem: trueï¼‰
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚«ã‚¹ã‚¿ãƒ æ¨©é™ã‚¿ã‚¤ãƒ—ã‚’ä½œæˆå¯èƒ½
3. ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒ—ã¯å€‹åˆ¥ã®Permissionã‚’é¸æŠã—ã¦æ§‹æˆ
```

### ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¤ãƒ—ã®ä¾‹

```
ã‚«ã‚¹ã‚¿ãƒ : "Reviewer"
â”œâ”€â”€ context.read âœ…
â”œâ”€â”€ context.create âœ… (ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆç”¨)
â”œâ”€â”€ task.read âœ…
â”œâ”€â”€ task.status.update_any âŒ
â”œâ”€â”€ handoff.read âœ…
â””â”€â”€ ...

ã‚«ã‚¹ã‚¿ãƒ : "Architect"
â”œâ”€â”€ task.create âœ…
â”œâ”€â”€ task.assign âŒ
â”œâ”€â”€ context.create âœ…
â”œâ”€â”€ subtask.create_any âœ… (è¨­è¨ˆåˆ†è§£ç”¨)
â””â”€â”€ ...
```

### UIï¼ˆå°†æ¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚«ã‚¹ã‚¿ãƒ æ¨©é™ã‚¿ã‚¤ãƒ—ä½œæˆ                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åå‰: [Reviewer          ]              â”‚
â”‚ èª¬æ˜: [ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‹…å½“ ]              â”‚
â”‚                                         â”‚
â”‚ ãƒ™ãƒ¼ã‚¹: [Viewer â–¼]                      â”‚
â”‚                                         â”‚
â”‚ è¿½åŠ æ¨©é™:                               â”‚
â”‚ â˜‘ context.create                        â”‚
â”‚ â˜ task.status.update_any                â”‚
â”‚ â˜‘ handoff.create                        â”‚
â”‚                                         â”‚
â”‚           [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [ä½œæˆ]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## MCP Toolsã¸ã®å½±éŸ¿

### æ¨©é™ã‚¨ãƒ©ãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```json
{
  "error": {
    "code": "permission_denied",
    "message": "ã“ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“",
    "details": {
      "agent_id": "agt_abc123",
      "agent_role": "worker",
      "required_permission": "task.assign",
      "hint": "Managerä»¥ä¸Šã®æ¨©é™ãŒå¿…è¦ã§ã™"
    }
  }
}
```

### æ¨©é™ç¢ºèªToolï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

| Tool | èª¬æ˜ |
|------|------|
| `get_my_permissions` | è‡ªåˆ†ã®æ¨©é™ãƒªã‚¹ãƒˆã‚’å–å¾— |
| `can_i_perform` | ç‰¹å®šã®æ“ä½œãŒå¯èƒ½ã‹ç¢ºèª |

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|-----------|----------|
| 2024-12-30 | 1.0.0 | åˆç‰ˆä½œæˆ |
