# エージェント管理画面

エージェントの作成・編集・Claude Code設定の管理を行う画面。

---

## 画面概要

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  👥 エージェント管理                              [+ 新規]    ⚙️            │
├────────────┬────────────────────────────────────────────────────────────────┤
│            │                                                                │
│ 📁 Projects│  ┌────────────────────────────────────────────────────────────┐│
│            │  │  エージェント一覧                              🔍 検索... ││
│ 👥 Agents  │  ├────────────────────────────────────────────────────────────┤│
│ ┌────────┐ │  │                                                            ││
│ │ owner  │ │  │  ┌──────────────────────────────────────────────────────┐ ││
│ │  👤    │ │  │  │ 👤 owner                                🟡 アイドル │ ││
│ └────────┘ │  │  │    Role: Owner | Type: Human                         │ ││
│ ┌────────┐ │  │  │    役割: プロジェクトオーナー                        │ ││
│ │frontend│ │  │  │    セッション: - | タスク: 0                         │ ││
│ │ 🤖 🟢  │ │  │  └──────────────────────────────────────────────────────┘ ││
│ └────────┘ │  │                                                            ││
│ ┌────────┐ │  │  ┌──────────────────────────────────────────────────────┐ ││
│ │backend │ │  │  │ 🤖 frontend-dev                         🟢 接続中   │ ││
│ │ 🤖 ⚫  │ │  │  │    Role: Worker | Type: AI                           │ ││
│ └────────┘ │  │  │    役割: フロントエンド開発                          │ ││
│            │  │  │    専門: React, TypeScript, CSS                      │ ││
│ 💬 Sessions│  │  │    ツール: Claude Code | セッション: 5 | タスク: 3   │ ││
│            │  │  │    ┌──────────────────────────────────────────────┐  │ ││
│            │  │  │    │ MCP設定: ✅ 設定済み     [設定を表示]        │  │ ││
│            │  │  │    └──────────────────────────────────────────────┘  │ ││
│            │  │  └──────────────────────────────────────────────────────┘ ││
│            │  │                                                            ││
│            │  │  ┌──────────────────────────────────────────────────────┐ ││
│            │  │  │ 🤖 backend-dev                         ⚫ オフライン│ ││
│            │  │  │    Role: Worker | Type: AI                           │ ││
│            │  │  │    役割: バックエンド開発                            │ ││
│            │  │  │    専門: Go, PostgreSQL, REST API                    │ ││
│            │  │  │    ツール: Claude Code | セッション: 3 | タスク: 2   │ ││
│            │  │  │    ┌──────────────────────────────────────────────┐  │ ││
│            │  │  │    │ MCP設定: ⚠️ 未設定      [設定を生成]         │  │ ││
│            │  │  │    └──────────────────────────────────────────────┘  │ ││
│            │  │  └──────────────────────────────────────────────────────┘ ││
│            │  │                                                            ││
│            │  └────────────────────────────────────────────────────────────┘│
│            │                                                                │
├────────────┴────────────────────────────────────────────────────────────────┤
│  3 agents | 🟢 1 接続中 | 🟡 1 アイドル | ⚫ 1 オフライン                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## エージェントステータス

| 状態 | アイコン | 説明 |
|------|---------|------|
| 接続中 | 🟢 | アクティブなセッションがあり、作業中 |
| アイドル | 🟡 | 有効だがセッションなし（人間の場合は常にこれ） |
| オフライン | ⚫ | 無効化されている、または長期間未接続 |

---

## コンポーネント

### エージェントカード

```
┌────────────────────────────────────────────────────────────────┐
│ [アイコン] [名前]                              [ステータス]    │
│    Role: [権限タイプ] | Type: [Human/AI]                       │
│    役割: [役割説明]                                            │
│    専門: [専門分野リスト] (AIのみ)                             │
│    ツール: [AIツール種類] | セッション: [数] | タスク: [数]    │
│    ┌────────────────────────────────────────────────────────┐ │
│    │ MCP設定: [ステータス]            [アクション]          │ │
│    └────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────────┘
```

**MCP設定ステータス:**
| ステータス | 表示 | アクション |
|-----------|------|-----------|
| 設定済み | ✅ 設定済み | [設定を表示] |
| 未設定 | ⚠️ 未設定 | [設定を生成] |
| 人間 | - | (表示なし) |

**AIツール種類:**
| ツール | 表示 |
|--------|------|
| Claude Code | Claude Code |
| Gemini | Gemini |
| その他 | Other |
| 人間 | - (非表示) |

---

## 新規エージェント作成

### ステップ1: 基本情報

```
┌────────────────────────────────────────────────────────────────┐
│  新規エージェント作成                                   [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ステップ 1/3: 基本情報                                        │
│  ━━━━━━━━━━●━━━━━━━━━━○━━━━━━━━━━○                              │
│                                                                │
│  タイプ *                                                      │
│  ┌──────────────────┐  ┌──────────────────┐                   │
│  │       🤖         │  │       👤         │                   │
│  │       AI         │  │      人間        │                   │
│  │    [選択中]      │  │                  │                   │
│  └──────────────────┘  └──────────────────┘                   │
│                                                                │
│  名前 * (英数字、ハイフン)                                     │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ frontend-dev                                             │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  役割 *                                                        │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ フロントエンド開発担当                                   │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│                                           [キャンセル] [次へ] │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### ステップ2: 権限と専門

```
┌────────────────────────────────────────────────────────────────┐
│  新規エージェント作成                                   [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ステップ 2/3: 権限と専門                                      │
│  ━━━━━━━━━━━━━━━━━━━━●━━━━━━━━━━○                              │
│                                                                │
│  権限タイプ *                                                  │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ ○ Owner   - 全権限                                       │ │
│  │ ○ Manager - タスク管理権限                               │ │
│  │ ● Worker  - タスク実行権限 (推奨)                        │ │
│  │ ○ Viewer  - 閲覧のみ                                     │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  専門分野 (カンマ区切り)                                       │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ React, TypeScript, CSS, Tailwind                         │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  システムプロンプト (任意)                                     │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ このエージェントはフロントエンド開発を担当します。       │ │
│  │ Reactのベストプラクティスに従い、アクセシビリティを      │ │
│  │ 重視した実装を行ってください。                           │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│                                      [戻る] [キャンセル] [次へ]│
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### ステップ3: MCP設定

```
┌────────────────────────────────────────────────────────────────┐
│  新規エージェント作成                                   [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ステップ 3/3: Claude Code設定                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━●                              │
│                                                                │
│  以下の設定をClaude Codeに追加してください:                    │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ {                                                        │ │
│  │   "mcpServers": {                                        │ │
│  │     "agent-pm-frontend-dev": {                           │ │
│  │       "command": "/Applications/AI Agent PM.app/..."     │ │
│  │       "args": [                                          │ │
│  │         "--db", "~/Library/Application Support/...",     │ │
│  │         "--agent-id", "agt_abc123"                        │ │
│  │       ]                                                  │ │
│  │     }                                                    │ │
│  │   }                                                      │ │
│  │ }                                                        │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  [📋 コピー]  [🔧 自動設定]                                    │
│                                                                │
│  ⚠️ 設定後、Claude Codeを再起動してください                   │
│                                                                │
│                                      [戻る] [キャンセル] [完了]│
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## エージェント詳細・編集

```
┌────────────────────────────────────────────────────────────────┐
│  🤖 frontend-dev                                        [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌─────────┬─────────┬─────────┬─────────┬──────────────────┐ │
│  │ 基本情報 │  統計   │ 活動履歴 │セッション│   MCP設定        │ │
│  └─────────┴─────────┴─────────┴─────────┴──────────────────┘ │
│                                                                │
│  ─── 基本情報 ───                                              │
│                                                                │
│  名前           frontend-dev                                   │
│  タイプ         AI                                             │
│  役割           フロントエンド開発担当                         │
│  権限           Worker                                         │
│  専門           React, TypeScript, CSS                         │
│  ステータス     🟢 接続中 (Claude Code)                        │
│  作成日         2024-12-28                                     │
│                                                                │
│  ─── システムプロンプト ───                                    │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ このエージェントはフロントエンド開発を担当します...      │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│                                                     [編集]     │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 統計タブ

```
│  ─── 統計 ───                                                  │
│                                                                │
│  ┌──────────────────────────────┐  ┌────────────────────────┐ │
│  │ 📊 サマリー                  │  │ 📈 今週の活動         │ │
│  │                              │  │                        │ │
│  │ セッション数        12       │  │  Mon ████░░░░ 2h      │ │
│  │ 総作業時間      24時間32分   │  │  Tue ██████░░ 3h      │ │
│  │ 完了タスク           8       │  │  Wed ████████ 4h      │ │
│  │ 進行中タスク         2       │  │  Thu ██░░░░░░ 1h      │ │
│  │ 作成ハンドオフ       5       │  │  Fri ██████░░ 3h      │ │
│  │ 受領ハンドオフ       3       │  │                        │ │
│  └──────────────────────────────┘  └────────────────────────┘ │
│                                                                │
│  ─── AIツール使用履歴 ───                                      │
│  │                                                             │
│  │  Claude Code    ████████████████████ 95% (20 sessions)     │
│  │  Gemini         █░░░░░░░░░░░░░░░░░░░  5% (1 session)       │
│  │                                                             │
```

### 活動履歴タブ (新規追加)

```
│  ─── 活動履歴 ───                                 [フィルター▼] │
│                                                                │
│  フィルター: [すべて ▼]  期間: [過去7日 ▼]                     │
│                                                                │
│  📅 今日                                                       │
│  │                                                             │
│  ├─ 14:30  🔄 ステータス変更                                   │
│  │         📋 API実装タスク                                    │
│  │         in_progress → review                                │
│  │         理由: "実装完了、レビュー依頼"                       │
│  │                                                             │
│  ├─ 14:00  📤 ハンドオフ作成                                   │
│  │         → backend-dev へ                                    │
│  │         "API仕様の確認お願いします"                          │
│  │                                                             │
│  ├─ 12:00  📝 コンテキスト追加                                 │
│  │         📋 ログイン画面タスク                               │
│  │         💡 決定事項: "JWT認証を採用、有効期限1時間"         │
│  │                                                             │
│  ├─ 10:15  🔄 ステータス変更                                   │
│  │         📋 ログイン画面タスク                               │
│  │         in_progress → done                                  │
│  │                                                             │
│  ├─ 10:00  🔌 セッション開始                                   │
│  │         ツール: Claude Code                                 │
│  │         セッション #12                                      │
│  │                                                             │
│  📅 昨日                                                       │
│  │                                                             │
│  ├─ 18:00  🔌 セッション終了                                   │
│  │         ツール: Claude Code                                 │
│  │         サマリ: "認証APIとの接続を完了"                      │
│  │                                                             │
│  └─ ...                                                        │
│                                                                │
│  [さらに読み込む]                                               │
```

### セッション履歴タブ

```
│  ─── セッション履歴 ───                                        │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ #12  🟢 進行中                                           │ │
│  │      開始: 2024-12-30 10:00                              │ │
│  │      ツール: Claude Code                                 │ │
│  │      タスク: 画面実装, API実装                           │ │
│  └──────────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ #11  2024-12-30 10:00 - 12:00 (2h)                       │ │
│  │      ツール: Claude Code                                 │ │
│  │      タスク: API統合                                     │ │
│  │      サマリ: 認証APIとの接続を完了                        │ │
│  └──────────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ #10  2024-12-29 14:00 - 17:30 (3.5h)                     │ │
│  │      ツール: Gemini                                      │ │
│  │      タスク: テスト作成                                  │ │
│  │      サマリ: ユニットテスト50件を作成                     │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  [もっと見る]                                                  │
```

### MCP設定タブ

```
│  ─── MCP設定 ───                                               │
│                                                                │
│  ステータス: ✅ 設定済み                                       │
│  Agent ID: agt_abc123                                          │
│                                                                │
│  設定内容:                                                     │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ {                                                        │ │
│  │   "mcpServers": {                                        │ │
│  │     "agent-pm-frontend-dev": { ... }                     │ │
│  │   }                                                      │ │
│  │ }                                                        │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  [📋 コピー]  [🔄 再生成]  [🗑️ 設定削除]                       │
```

---

## コンテキストメニュー

```
┌─────────────────────────┐
│ 📋 詳細を開く           │
├─────────────────────────┤
│ ✏️ 編集                 │
│ 📊 統計を見る           │
│ 📜 活動履歴             │
│ 💬 セッション履歴       │
├─────────────────────────┤
│ 🔧 MCP設定を表示        │
│ 🔄 MCP設定を再生成      │
├─────────────────────────┤
│ 📦 アーカイブ           │
│ 🗑️ 削除                 │
└─────────────────────────┘
```

---

## 状態管理

```swift
struct AgentManagementState {
    var agents: [Agent]
    var selectedAgentId: AgentID?
    var activeSessions: [AgentID: Session]
    var agentActivities: [AgentID: [StateChangeEvent]]  // 活動履歴
    var isCreating: Bool
    var createWizardStep: Int
    var newAgentDraft: AgentDraft?
    var activityFilter: ActivityFilter
}

struct AgentDraft {
    var type: AgentType
    var name: String
    var role: String
    var roleType: AgentRole
    var capabilities: [String]
    var systemPrompt: String?
}

struct ActivityFilter {
    var eventTypes: [EventType]?     // nil = すべて
    var dateRange: DateRange
}

enum DateRange {
    case today
    case pastWeek
    case pastMonth
    case custom(from: Date, to: Date)
}

// AGENT_CONCEPT.md との整合性
enum AgentStatus {
    case connected(toolType: AIToolType)  // 🟢 接続中
    case idle                              // 🟡 アイドル
    case offline                           // ⚫ オフライン
}

enum AIToolType: String, Codable {
    case claudeCode = "claude_code"
    case gemini = "gemini"
    case human = "human"
    case other = "other"
}
```

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|----------|
| 2024-12-30 | 1.0.0 | 初版作成 |
| 2024-12-30 | 1.1.0 | AGENT_CONCEPT/STATE_HISTORY対応: ステータス3状態化、活動履歴タブ追加、AIツール種類表示追加 |
