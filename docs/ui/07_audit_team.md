# 監査チーム管理画面

監査チームの作成・編集・ロック操作を行う画面。
**監査チームはプロジェクトと同列のトップレベル概念。**

---

## 画面概要

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  🛡️ 監査チーム管理                               [+ 新規]    ⚙️            │
├────────────┬────────────────────────────────────────────────────────────────┤
│            │                                                                │
│ 📁 Projects│  ┌────────────────────────────────────────────────────────────┐│
│   Project A│  │  監査チーム一覧                                🔍 検索... ││
│   Project B│  ├────────────────────────────────────────────────────────────┤│
│            │  │                                                            ││
│ 👥 Agents  │  │  ┌──────────────────────────────────────────────────────┐ ││
│   owner    │  │  │ 🛡️ セキュリティ監査チーム              ⚡ Active    │ ││
│   frontend │  │  │    監査エージェント: 2                               │ ││
│            │  │  │    監視対象プロジェクト: Project A, Project B        │ ││
│ 🛡️ Audit   │  │  │    アクティブロック: 1                               │ ││
│ > Security │  │  └──────────────────────────────────────────────────────┘ ││
│   QA Team  │  │                                                            ││
│            │  │  ┌──────────────────────────────────────────────────────┐ ││
│ 📜 History │  │  │ 🛡️ QA監査チーム                        📦 Archived  │ ││
│            │  │  │    監査エージェント: 1                               │ ││
│            │  │  │    監視対象プロジェクト: -                           │ ││
│            │  │  │    アクティブロック: 0                               │ ││
│            │  │  └──────────────────────────────────────────────────────┘ ││
│            │  │                                                            ││
│            │  └────────────────────────────────────────────────────────────┘│
│            │                                                                │
├────────────┴────────────────────────────────────────────────────────────────┤
│  2 teams | 1 active | 1 lock active                                         │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 監査チームステータス

| 状態 | アイコン | 説明 |
|------|---------|------|
| Active | ⚡ | 有効な監査チーム |
| Archived | 📦 | アーカイブ済み |

---

## コンポーネント

### 監査チームカード

```
┌────────────────────────────────────────────────────────────────┐
│ 🛡️ [チーム名]                                    [ステータス]  │
│    監査エージェント: [数]                                      │
│    監視対象プロジェクト: [プロジェクト名リスト]                │
│    アクティブロック: [数]                                      │
└────────────────────────────────────────────────────────────────┘
```

---

## 新規監査チーム作成

```
┌────────────────────────────────────────────────────────────────┐
│  新規監査チーム作成                                     [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  チーム名 *                                                    │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ セキュリティ監査チーム                                   │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  説明                                                          │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ セキュリティ要件の遵守を監視するチーム                   │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  監査エージェントを割り当て                                    │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 🔍 エージェントを検索...                                 │ │
│  │ ☑ 🤖 security-auditor                                   │ │
│  │ ☐ 🤖 qa-auditor                                         │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│                                    [キャンセル]  [作成]        │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## 監査チーム詳細

```
┌────────────────────────────────────────────────────────────────┐
│  🛡️ セキュリティ監査チーム                              [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌─────────┬─────────┬─────────┬─────────────────────────────┐ │
│  │ 基本情報 │エージェント│ ロック  │ 監視対象                    │ │
│  └─────────┴─────────┴─────────┴─────────────────────────────┘ │
│                                                                │
│  ─── 基本情報 ───                                              │
│                                                                │
│  チーム名       セキュリティ監査チーム                         │
│  ステータス     ⚡ Active                                      │
│  説明           セキュリティ要件の遵守を監視するチーム         │
│  作成日         2024-12-28                                     │
│                                                                │
│                                                     [編集]     │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### エージェントタブ

```
│  ─── 監査エージェント ───                                      │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 🤖 security-auditor                         🟢 接続中    │ │
│  │    Role: Auditor | 権限: 全プロジェクト閲覧 + ロック     │ │
│  │    タスクロック: 1 | エージェントロック: 0               │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 🤖 qa-auditor                               ⚫ オフライン │ │
│  │    Role: Auditor | 権限: 全プロジェクト閲覧 + ロック     │ │
│  │    タスクロック: 0 | エージェントロック: 0               │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  [+ エージェントを追加]                                        │
```

### ロックタブ

```
│  ─── アクティブロック ───                                      │
│                                                                │
│  タスクロック                                                  │
│  ────────────────────────────────────────────────────────────  │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 🔒 API実装                                               │ │
│  │    プロジェクト: ECサイト開発                            │ │
│  │    ロック者: 🤖 security-auditor                         │ │
│  │    ロック日時: 2024-12-30 14:00                          │ │
│  │    理由: セキュリティレビュー待ち                        │ │
│  │                                        [ロック解除]      │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  エージェントロック                                            │
│  ────────────────────────────────────────────────────────────  │
│  (なし)                                                        │
│                                                                │
│  [+ タスクをロック]  [+ エージェントをロック]                  │
```

---

## ロック操作モーダル

### タスクロック

```
┌────────────────────────────────────────────────────────────────┐
│  🔒 タスクをロック                                       [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  対象タスク *                                                  │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 🔍 タスクを検索...                                       │ │
│  │                                                          │ │
│  │ 📋 API実装 (ECサイト開発)                               │ │
│  │ 📋 認証機能 (ECサイト開発)                              │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ロック理由 *                                                  │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ セキュリティレビューが完了するまで作業を停止             │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ⚠️ ロック中はタスクの状態変更が禁止されます                  │
│                                                                │
│                                    [キャンセル]  [ロック]      │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### エージェントロック

```
┌────────────────────────────────────────────────────────────────┐
│  🔒 エージェントをロック                                 [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  対象エージェント *                                            │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 🔍 エージェントを検索...                                 │ │
│  │                                                          │ │
│  │ 🤖 frontend-dev                                         │ │
│  │ 🤖 backend-dev                                          │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ロック理由 *                                                  │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 不正な操作パターンを検出。調査完了まで活動を停止         │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ⚠️ ロック中はエージェントの全操作が禁止されます              │
│                                                                │
│                                    [キャンセル]  [ロック]      │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### ロック解除

```
┌────────────────────────────────────────────────────────────────┐
│  🔓 ロックを解除                                         [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  対象: 📋 API実装                                              │
│                                                                │
│  ロック情報:                                                   │
│  ────────────────────────────────────────────────────────────  │
│  ロック者: 🤖 security-auditor                                 │
│  ロック日時: 2024-12-30 14:00                                  │
│  理由: セキュリティレビュー待ち                                │
│                                                                │
│  解除理由 *                                                    │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ セキュリティレビュー完了。問題なし。                     │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ⚠️ 監査エージェントのみがロックを解除できます                │
│                                                                │
│                                    [キャンセル]  [解除]        │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## コンテキストメニュー

```
┌─────────────────────────┐
│ 📋 詳細を開く           │
├─────────────────────────┤
│ ✏️ 編集                 │
│ 👥 エージェント管理     │
├─────────────────────────┤
│ 🔒 タスクをロック       │
│ 🔒 エージェントをロック │
├─────────────────────────┤
│ 📦 アーカイブ           │
│ 🗑️ 削除                 │
└─────────────────────────┘
```

---

## 状態管理

```swift
struct AuditTeamManagementState {
    var auditTeams: [AuditTeam]
    var selectedTeamId: AuditTeamID?
    var activeLocks: [Lock]
    var isCreating: Bool
    var newTeamDraft: AuditTeamDraft?
    var lockFilter: LockFilter
}

struct AuditTeam {
    var id: AuditTeamID
    var name: String
    var description: String
    var status: AuditTeamStatus       // active / archived
    var auditAgentIds: [AgentID]
    var watchedProjectIds: [ProjectID]
    var createdAt: Date
}

enum AuditTeamStatus {
    case active
    case archived
}

struct AuditTeamDraft {
    var name: String
    var description: String
    var auditAgentIds: [AgentID]
}

struct Lock {
    var id: LockID
    var lockType: LockType            // task / agent
    var targetId: String              // TaskID or AgentID
    var lockedBy: AgentID             // 監査エージェントID
    var reason: String
    var lockedAt: Date
}

enum LockType {
    case task                         // タスクの状態変更を禁止
    case agent                        // エージェントの全操作を禁止
}

struct LockFilter {
    var lockType: LockType?           // nil = すべて
    var auditTeamId: AuditTeamID?     // nil = すべて
}
```

---

## 権限

| 操作 | 監査エージェント | 通常エージェント |
|------|-----------------|-----------------|
| ロック作成 | ✅ | ❌ |
| ロック解除 | ✅ | ❌ |
| 全プロジェクト閲覧 | ✅ | ❌ |
| エージェント行動ログ閲覧 | ✅ | ❌ |

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|----------|
| 2025-01-01 | 1.0.0 | 初版作成 - 監査チーム管理画面 |
