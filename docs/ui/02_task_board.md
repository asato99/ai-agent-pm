# タスクボード画面

プロジェクトのタスクをカンバン形式で管理するメイン画面。

---

## 画面概要

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  📁 ECサイト開発                    🔍 検索...     [+ タスク]  👥  ⚙️       │
├────────────┬────────────────────────────────────────────────────────────────┤
│            │                                                                │
│ 📁 Projects│  ┌─────────┬─────────┬─────────┬─────────┬─────────┬────────┐ │
│ > ECサイト │  │ Backlog │  Todo   │Progress │ Review  │  Done   │Blocked │ │
│   モバイル │  │   (3)   │   (2)   │   (2)   │   (1)   │   (5)   │  (1)   │ │
│            │  ├─────────┼─────────┼─────────┼─────────┼─────────┼────────┤ │
│ 👥 Agents  │  │         │         │         │         │         │        │ │
│   🟢 owner │  │ ┌─────┐ │ ┌─────┐ │ ┌─────┐ │ ┌─────┐ │ ┌─────┐ │┌─────┐ │ │
│   🟢 front │  │ │UI設計│ │ │DB設計│ │ │API  │ │ │ログ │ │ │要件 │ ││API  │ │ │
│   ⚫ back  │  │ │     │ │ │🔵   │ │ │実装 │ │ │イン │ │ │定義 │ ││統合 │ │ │
│            │  │ │     │ │ │     │ │ │🟢   │ │ │     │ │ │ ✅  │ ││ 🔴  │ │ │
│ 💬 Sessions│  │ └─────┘ │ └─────┘ │ │back │ │ │front│ │ └─────┘ ││待ち │ │ │
│   今日: 2  │  │         │         │ └─────┘ │ └─────┘ │         ││A, B │ │ │
│            │  │ ┌─────┐ │ ┌─────┐ │         │         │ ┌─────┐ │└─────┘ │ │
│            │  │ │決済 │ │ │認証 │ │ ┌─────┐ │         │ │DB   │ │        │ │
│            │  │ │機能 │ │ │機能 │ │ │画面 │ │         │ │設計 │ │        │ │
│            │  │ │     │ │ │🔵   │ │ │実装 │ │         │ │ ✅  │ │        │ │
│            │  │ └─────┘ │ └─────┘ │ │🟢   │ │         │ └─────┘ │        │ │
│            │  │         │         │ │front│ │         │         │        │ │
│            │  │ ┌─────┐ │         │ └─────┘ │         │ ┌─────┐ │        │ │
│            │  │ │在庫 │ │         │         │         │ │認証 │ │        │ │
│            │  │ │管理 │ │         │         │         │ │ ✅  │ │        │ │
│            │  │ └─────┘ │         │         │         │ └─────┘ │        │ │
│            │  │         │         │         │         │         │        │ │
│            │  └─────────┴─────────┴─────────┴─────────┴─────────┴────────┘ │
│            │                                                                │
├────────────┴────────────────────────────────────────────────────────────────┤
│  14 tasks | 🟢 2 agents active | Last update: 5 min ago                     │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## コンポーネント

### タスクカード

```
┌────────────────────────────────────┐
│ [優先度] タスクタイトル            │
│                                    │
│ 🤖 担当エージェント名              │
│ 📎 サブタスク: 2/5                 │
│ 🔗 依存: 2 blocked                 │
└────────────────────────────────────┘
```

**優先度表示:**
| 優先度 | 表示 |
|--------|------|
| Urgent | 🔴 赤バー (左端) |
| High | 🟠 オレンジバー |
| Medium | 🔵 青バー |
| Low | ⚪ グレーバー |

**担当エージェント表示:**
| 状態 | 表示 |
|------|------|
| AIエージェント | 🤖 名前 |
| 人間 | 👤 名前 |
| 未アサイン | 👻 未アサイン (グレー) |

### カラムヘッダー

```
┌─────────────────────────────────┐
│ [ステータス名]           (件数) │
│ ─────────────────────────────── │
│ [+ タスク追加] (hover時表示)    │
└─────────────────────────────────┘
```

---

## インタラクション

### ドラッグ&ドロップ

```
タスクカードをドラッグ
    ↓
別のカラムにドロップ
    ↓
ステータス変更確認
    ↓
権限チェック → 許可: 更新 / 拒否: エラー表示
```

**ドラッグ制約:**
- Worker: 自分のタスクのみドラッグ可能
- review → done は Owner/Manager のみ
- blocked へのドラッグは理由入力必須

### タスク選択

- **クリック**: タスク詳細パネルを右側に表示
- **ダブルクリック**: タスク詳細モーダルを開く
- **右クリック**: コンテキストメニュー

### コンテキストメニュー

```
┌─────────────────────────┐
│ 📋 詳細を開く           │
├─────────────────────────┤
│ ✏️ 編集                 │
│ 👤 アサイン変更         │
│ 🔗 依存関係を編集       │
├─────────────────────────┤
│ ➡️ ステータス変更 ▶     │
├─────────────────────────┤
│ 📑 複製                 │
│ 🗑️ 削除                 │
└─────────────────────────┘
```

---

## フィルター・検索

### フィルターバー

```
┌────────────────────────────────────────────────────────────────────┐
│ 担当: [全員 ▼]  優先度: [全て ▼]  依存: [全て ▼]  🔍 検索...      │
└────────────────────────────────────────────────────────────────────┘
```

| フィルター | オプション |
|-----------|-----------|
| 担当 | 全員 / 自分 / 未アサイン / 特定エージェント |
| 優先度 | 全て / Urgent / High / Medium / Low |
| 依存 | 全て / Ready のみ / Blocked のみ |

### 検索

- タイトル、説明文、コンテキストを対象
- インクリメンタルサーチ
- `⌘ F` でフォーカス

---

## タスク詳細パネル (右サイド)

```
┌────────────────────────────────────────────┐
│ API実装                             [×]   │
├────────────────────────────────────────────┤
│                                            │
│ ステータス: 🟢 In Progress                 │
│ 優先度:     🔵 Medium                      │
│ 担当:       🤖 backend-dev                 │
│ 作成者:     👤 owner                       │
│ 作成日:     2024-12-28                     │
│                                            │
├────────────────────────────────────────────┤
│ 📝 説明                                    │
│ ────────────────────────────────────────── │
│ REST APIエンドポイントの実装               │
│ - ユーザー認証                             │
│ - 商品CRUD                                 │
│                                            │
├────────────────────────────────────────────┤
│ 🔗 依存関係                                │
│ ────────────────────────────────────────── │
│ ← DB設計 ✅                                │
│ ← 認証設計 ✅                              │
│ → API統合 (blocked)                        │
│                                            │
├────────────────────────────────────────────┤
│ 📎 サブタスク (2/5)                        │
│ ────────────────────────────────────────── │
│ ☑ エンドポイント設計                       │
│ ☑ 認証ミドルウェア                         │
│ ☐ 商品API                                  │
│ ☐ 注文API                                  │
│ ☐ テスト作成                               │
│ [+ サブタスク追加]                          │
│                                            │
├────────────────────────────────────────────┤
│ 💬 コンテキスト                            │
│ ────────────────────────────────────────── │
│ 🤖 backend-dev (12/30 10:30)              │
│ 「JWT認証を採用、有効期限1時間」           │
│                                            │
│ 🤖 backend-dev (12/30 14:00)              │
│ 「Rate limit: 100 req/min」               │
│                                            │
│ [+ コンテキスト追加]                        │
│                                            │
├────────────────────────────────────────────┤
│ 🔄 ハンドオフ                              │
│ ────────────────────────────────────────── │
│ (なし)                                     │
│                                            │
└────────────────────────────────────────────┘
```

---

## 新規タスク作成

```
┌────────────────────────────────────────────────────┐
│  新規タスク                                 [×]   │
├────────────────────────────────────────────────────┤
│                                                    │
│  タイトル *                                        │
│  ┌──────────────────────────────────────────────┐ │
│  │                                              │ │
│  └──────────────────────────────────────────────┘ │
│                                                    │
│  説明                                              │
│  ┌──────────────────────────────────────────────┐ │
│  │                                              │ │
│  │                                              │ │
│  └──────────────────────────────────────────────┘ │
│                                                    │
│  ステータス        優先度                          │
│  [Backlog ▼]      [Medium ▼]                      │
│                                                    │
│  担当エージェント                                  │
│  [未アサイン ▼]                                   │
│                                                    │
│  依存タスク                                        │
│  ┌──────────────────────────────────────────────┐ │
│  │ 🔍 タスクを検索...                           │ │
│  │ ☑ DB設計                                     │ │
│  │ ☐ API設計                                    │ │
│  └──────────────────────────────────────────────┘ │
│                                                    │
│                     [キャンセル]  [作成]          │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

## エージェント活動インジケーター

### サイドバー表示

```
👥 Agents
  🟢 owner        (active)
  🟢 frontend-dev (active, working on: 画面実装)
  ⚫ backend-dev  (offline, last: 2h ago)
  🟡 reviewer     (idle)
```

| 状態 | アイコン | 説明 |
|------|----------|------|
| Active | 🟢 | セッション中、作業中 |
| Idle | 🟡 | セッション中、作業なし |
| Offline | ⚫ | セッションなし |

---

## 状態管理

```swift
struct TaskBoardState {
    var project: Project
    var tasks: [Task]
    var selectedTaskId: TaskID?
    var agents: [Agent]
    var activeSessions: [Session]
    var filter: TaskFilter
    var searchQuery: String
    var isLoading: Bool
}

struct TaskFilter {
    var assignee: AgentID?
    var priority: Priority?
    var dependencyStatus: DependencyFilter?
}

enum DependencyFilter {
    case all
    case readyOnly
    case blockedOnly
}
```

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|----------|
| 2024-12-30 | 1.0.0 | 初版作成 |
