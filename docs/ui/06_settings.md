# 設定画面

アプリケーション全体の設定を管理する画面。

---

## 画面概要

```
┌────────────────────────────────────────────────────────────────────────────┐
│  ⚙️ 設定                                                           [×]   │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌────────────────┐  ┌──────────────────────────────────────────────────┐ │
│  │                │  │                                                  │ │
│  │  一般          │  │  ─── 一般設定 ───                                │ │
│  │                │  │                                                  │ │
│  │  外観          │  │  アプリケーション                                │ │
│  │                │  │  ────────────────────────────────────────────── │ │
│  │  MCP設定       │  │                                                  │ │
│  │                │  │  ☑ ログイン時に起動                             │ │
│  │  データ        │  │                                                  │ │
│  │                │  │  ☐ メニューバーに表示                           │ │
│  │  監査ログ      │  │                                                  │ │
│  │                │  │  ☑ 終了時に確認                                 │ │
│  │  ショートカット│  │                                                  │ │
│  │                │  │                                                  │ │
│  │  バージョン    │  │  通知                                            │ │
│  │                │  │  ────────────────────────────────────────────── │ │
│  │                │  │                                                  │ │
│  │                │  │  ☑ ハンドオフ受信時に通知                       │ │
│  │                │  │                                                  │ │
│  │                │  │  ☑ タスク完了時に通知                           │ │
│  │                │  │                                                  │ │
│  │                │  │  ☐ エージェント接続時に通知                     │ │
│  │                │  │                                                  │ │
│  │                │  │                                                  │ │
│  │                │  │  言語                                            │ │
│  │                │  │  ────────────────────────────────────────────── │ │
│  │                │  │                                                  │ │
│  │                │  │  ┌──────────────────────────────────────────┐   │ │
│  │                │  │  │ 日本語                                ▼ │   │ │
│  │                │  │  └──────────────────────────────────────────┘   │ │
│  │                │  │                                                  │ │
│  └────────────────┘  └──────────────────────────────────────────────────┘ │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
```

---

## セクション詳細

### 一般設定

```
─── 一般設定 ───

アプリケーション
──────────────────────────────────────────────

☑ ログイン時に起動
    システム起動時にアプリを自動起動

☐ メニューバーに表示
    Dockではなくメニューバーに常駐

☑ 終了時に確認
    アプリ終了前に確認ダイアログを表示


通知
──────────────────────────────────────────────

☑ ハンドオフ受信時に通知
    エージェント宛のハンドオフを受信したら通知

☑ タスク完了時に通知
    タスクが完了したら通知

☐ エージェント接続時に通知
    エージェントがセッションを開始したら通知


言語
──────────────────────────────────────────────

┌──────────────────────────────────────────┐
│ 日本語                                ▼ │
└──────────────────────────────────────────┘
    • 日本語
    • English
```

### 外観設定

```
─── 外観設定 ───

テーマ
──────────────────────────────────────────────

┌────────────────┐ ┌────────────────┐ ┌────────────────┐
│   ☀️ Light     │ │   🌙 Dark      │ │   💻 System    │
│                │ │                │ │   [選択中]     │
└────────────────┘ └────────────────┘ └────────────────┘


アクセントカラー
──────────────────────────────────────────────

🔵 🟣 🩷 🟠 🟢 🔴

[システムのアクセントカラーを使用]


サイドバー
──────────────────────────────────────────────

サイドバーの幅
┌──────────────────────────────────────────┐
│ ━━━━━━━━━━━━━━━━━●━━━━━━━━━━            │
└──────────────────────────────────────────┘
                 220px


フォントサイズ
──────────────────────────────────────────────

┌──────────────────────────────────────────┐
│ 中 (デフォルト)                       ▼ │
└──────────────────────────────────────────┘
    • 小
    • 中 (デフォルト)
    • 大
```

### MCP設定

```
─── MCP設定 ───

MCPサーバー
──────────────────────────────────────────────

ステータス: 🟢 正常

サーバーパス:
/Applications/AI Agent PM.app/Contents/Resources/mcp-server-pm

データベース:
~/Library/Application Support/AI Agent PM/data.db

[ログを表示]  [サーバーを再起動]


Claude Code設定
──────────────────────────────────────────────

設定ファイル:
~/.claude/claude_desktop_config.json

ステータス: ✅ 設定済み (3 エージェント)

┌──────────────────────────────────────────────────────────────┐
│ 登録済みエージェント:                                        │
│   • agent-pm-owner (agt_abc123)                             │
│   • agent-pm-frontend-dev (agt_def456)                      │
│   • agent-pm-backend-dev (agt_ghi789)                       │
└──────────────────────────────────────────────────────────────┘

[設定ファイルを開く]  [設定を再生成]


デバッグ
──────────────────────────────────────────────

☐ デバッグログを有効化
    MCP通信の詳細ログを記録

☐ 開発者モード
    追加のデバッグ機能を有効化
```

### データ設定

```
─── データ設定 ───

データベース
──────────────────────────────────────────────

場所:
~/Library/Application Support/AI Agent PM/data.db

サイズ: 2.4 MB

最終バックアップ: 2024-12-30 10:00

[今すぐバックアップ]  [バックアップから復元]


エクスポート
──────────────────────────────────────────────

[全データをエクスポート (JSON)]

[プロジェクトを選択してエクスポート]


危険な操作
──────────────────────────────────────────────

⚠️ 以下の操作は取り消せません

[全データを削除]  [アプリをリセット]
```

### 監査ログ設定 (新規追加)

```
─── 監査ログ ───

概要
──────────────────────────────────────────────

総イベント数: 1,234
最終イベント: 2024-12-30 14:30
ストレージ使用量: 15.2 MB


フィルター
──────────────────────────────────────────────

プロジェクト:
┌──────────────────────────────────────────┐
│ すべてのプロジェクト                  ▼ │
└──────────────────────────────────────────┘

期間:
┌──────────────────────────────────────────┐
│ 過去30日                              ▼ │
└──────────────────────────────────────────┘

エージェント:
┌──────────────────────────────────────────┐
│ すべてのエージェント                  ▼ │
└──────────────────────────────────────────┘

イベントタイプ:
┌──────────────────────────────────────────┐
│ ☑ ステータス変更                        │
│ ☑ 担当者変更                            │
│ ☑ タスク作成/削除                       │
│ ☑ コンテキスト追加                      │
│ ☑ ハンドオフ                            │
│ ☑ セッション開始/終了                   │
│ ☑ エージェント変更                      │
└──────────────────────────────────────────┘


監査ログ一覧
──────────────────────────────────────────────

┌─────────┬──────────┬────────────┬───────────┬─────────────┐
│ 日時     │ エージェント │ 種類        │ 対象       │ 変更内容    │
├─────────┼──────────┼────────────┼───────────┼─────────────┤
│ 12/30   │ 🤖 frontend │ status     │ API実装    │ prog→review │
│ 14:30   │          │            │           │             │
├─────────┼──────────┼────────────┼───────────┼─────────────┤
│ 12/30   │ 🤖 frontend │ context    │ API実装    │ 成果物追加  │
│ 14:00   │          │            │           │             │
├─────────┼──────────┼────────────┼───────────┼─────────────┤
│ 12/30   │ 🤖 frontend │ session    │ -         │ 開始        │
│ 10:00   │          │            │           │             │
├─────────┼──────────┼────────────┼───────────┼─────────────┤
│ 12/29   │ 👤 owner  │ assigned   │ DB設計     │ →backend   │
│ 16:45   │          │            │           │             │
└─────────┴──────────┴────────────┴───────────┴─────────────┘

1-50 / 1,234 件                       [<] [1] [2] [3] ... [>]


エクスポート
──────────────────────────────────────────────

[監査ログをエクスポート (CSV)]

[監査ログをエクスポート (JSON)]


保持設定
──────────────────────────────────────────────

保持期間:
┌──────────────────────────────────────────┐
│ 無期限                                ▼ │
└──────────────────────────────────────────┘
    • 無期限
    • 1年
    • 6ヶ月
    • 3ヶ月
    • 1ヶ月

☐ 古いログを自動的にアーカイブ
    保持期間を超えたログを圧縮して保存

[古いログをアーカイブ]  [アーカイブを表示]
```

### 監査ログ詳細モーダル

イベントをクリックした際に表示される詳細モーダル。

```
┌────────────────────────────────────────────────────────────────┐
│  イベント詳細                                           [×]   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  イベントID: evt_a1b2c3d4e5f6                                  │
│                                                                │
│  ─── 基本情報 ───                                              │
│                                                                │
│  日時           2024-12-30 14:30:25                            │
│  エージェント   🤖 frontend-dev                                │
│  セッション     #12 (Claude Code)                              │
│  種類           ステータス変更                                 │
│  対象           📋 API実装 (tsk_xyz789)                        │
│                                                                │
│  ─── 変更内容 ───                                              │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ フィールド     変更前           変更後                   │ │
│  ├──────────────────────────────────────────────────────────┤ │
│  │ status        in_progress      review                   │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ─── 変更理由 ───                                              │
│                                                                │
│  "実装完了、レビュー依頼"                                      │
│                                                                │
│  ─── メタデータ ───                                            │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ {                                                        │ │
│  │   "commit_hash": "a1b2c3d",                              │ │
│  │   "files_changed": 5                                     │ │
│  │ }                                                        │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│                                              [閉じる]          │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### ショートカット設定

```
─── ショートカット設定 ───

グローバル
──────────────────────────────────────────────

アプリを表示/非表示
┌──────────────────────────────────────────┐
│ ⌘ ⇧ P                              [変更]│
└──────────────────────────────────────────┘

クイックタスク作成
┌──────────────────────────────────────────┐
│ ⌘ ⇧ T                              [変更]│
└──────────────────────────────────────────┘


ナビゲーション
──────────────────────────────────────────────

プロジェクト一覧      ⌘ 1
タスクボード          ⌘ 2
エージェント管理      ⌘ 3
監査ログ              ⌘ 4
設定                  ⌘ ,


タスク操作
──────────────────────────────────────────────

新規タスク            ⌘ N
新規プロジェクト      ⌘ ⇧ N
新規エージェント      ⌘ ⇧ A
検索                  ⌘ F
タスク詳細を開く      Enter
ステータス変更        Space


[デフォルトに戻す]
```

### バージョン情報

```
─── バージョン情報 ───

┌──────────────────────────────────────────────────────────────┐
│                                                              │
│                          🤖                                  │
│                                                              │
│                    AI Agent PM                               │
│                                                              │
│                    Version 1.0.0                             │
│                    Build 100                                 │
│                                                              │
│              © 2024 Your Company Name                        │
│                                                              │
└──────────────────────────────────────────────────────────────┘


システム情報
──────────────────────────────────────────────

macOS: 14.2 (Sonoma)
チップ: Apple M1
メモリ: 16 GB


リンク
──────────────────────────────────────────────

[📖 ドキュメント]

[🐛 バグを報告]

[💡 機能をリクエスト]

[⭐ GitHubでスターする]


ライセンス
──────────────────────────────────────────────

[オープンソースライセンスを表示]

[プライバシーポリシー]

[利用規約]


アップデート
──────────────────────────────────────────────

現在のバージョンは最新です

☑ 自動アップデートを確認

[アップデートを確認]
```

---

## ショートカット変更ダイアログ

```
┌────────────────────────────────────────────────────┐
│  ショートカットを変更                       [×]   │
├────────────────────────────────────────────────────┤
│                                                    │
│  アプリを表示/非表示                               │
│                                                    │
│  新しいショートカット:                             │
│  ┌──────────────────────────────────────────────┐ │
│  │                                              │ │
│  │      キーを押してください...                 │ │
│  │                                              │ │
│  └──────────────────────────────────────────────┘ │
│                                                    │
│  現在: ⌘ ⇧ P                                      │
│                                                    │
│              [キャンセル]  [クリア]  [保存]       │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

## データ削除確認ダイアログ

```
┌────────────────────────────────────────────────────┐
│  ⚠️ 全データを削除                          [×]   │
├────────────────────────────────────────────────────┤
│                                                    │
│  この操作は取り消せません。                        │
│                                                    │
│  以下のデータがすべて削除されます:                 │
│                                                    │
│  • 3 プロジェクト                                  │
│  • 45 タスク                                       │
│  • 4 エージェント                                  │
│  • 128 コンテキスト                                │
│  • 23 ハンドオフ                                   │
│  • 1,234 監査ログ                                  │
│                                                    │
│  確認のため「削除」と入力してください:             │
│  ┌──────────────────────────────────────────────┐ │
│  │                                              │ │
│  └──────────────────────────────────────────────┘ │
│                                                    │
│                     [キャンセル]  [削除]          │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

## 状態管理

```swift
struct SettingsState {
    var selectedSection: SettingsSection
    var generalSettings: GeneralSettings
    var appearanceSettings: AppearanceSettings
    var mcpSettings: MCPSettings
    var auditLogSettings: AuditLogSettings    // 追加
    var shortcuts: [ShortcutBinding]
    var isModified: Bool
}

enum SettingsSection {
    case general
    case appearance
    case mcp
    case data
    case auditLog       // 追加
    case shortcuts
    case about
}

struct GeneralSettings {
    var launchAtLogin: Bool
    var showInMenuBar: Bool
    var confirmOnQuit: Bool
    var notifyOnHandoff: Bool
    var notifyOnTaskComplete: Bool
    var notifyOnAgentConnect: Bool
    var language: Language
}

struct AppearanceSettings {
    var theme: Theme
    var accentColor: AccentColor
    var sidebarWidth: CGFloat
    var fontSize: FontSize
}

enum Theme {
    case light
    case dark
    case system
}

// STATE_HISTORY.md との整合性
struct AuditLogSettings {
    var filter: AuditLogFilter
    var retentionPeriod: RetentionPeriod
    var autoArchive: Bool
}

struct AuditLogFilter {
    var projectId: ProjectID?             // nil = すべて
    var agentId: AgentID?                 // nil = すべて
    var eventTypes: [EventType]
    var dateRange: DateRange
}

enum RetentionPeriod {
    case unlimited
    case oneYear
    case sixMonths
    case threeMonths
    case oneMonth
}

enum DateRange {
    case pastWeek
    case pastMonth
    case pastThreeMonths
    case pastYear
    case custom(from: Date, to: Date)
}
```

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|----------|
| 2024-12-30 | 1.0.0 | 初版作成 |
| 2024-12-30 | 1.1.0 | STATE_HISTORY対応: 監査ログセクション追加、イベント詳細モーダル追加、ショートカットに監査ログ追加 |
