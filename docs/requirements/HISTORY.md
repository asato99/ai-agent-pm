# 作業履歴 (History) 仕様

## 基本方針
アプリに対するすべての入出力を履歴として記録する。

---

## 記録対象

### アプリへの全入出力
| 種別 | 例 |
|------|-----|
| タスク状態変更 | backlog → todo → in_progress → done |
| タスク割り当て | エージェントAがエージェントBにアサイン |
| タスク作成・編集 | 新規作成、内容変更、依存関係設定 |
| MCP閲覧操作 | タスク一覧取得、詳細取得 |
| エージェント操作 | 作成、編集、依存関係設定 |

### エージェントのコンテキスト
- 思考・判断・発見もタスクとして宣言的に記録
- 可能な限りタスクとして可視化

```
例:
[タスク] 認証機能の設計方針を検討
  └─ 結果: JWT方式を採用。理由は...
```

---

## 監査との連携

### 目的
実際の作業とアプリ上の入出力を可能な限り同期させる。

### 仕組み
```
[エージェントの実作業]
        │
        ↓ 記録
[アプリへの入出力]
        │
        ↓ 監視
[監査チーム]
        │
        └─ 差異検出 → 是正要求
```

### 課題
- エージェントがアプリ外で作業した場合の検出
- 記録漏れの防止策
- 監査の自動化範囲

---

## 履歴の属性

| 属性 | 説明 |
|------|------|
| タイムスタンプ | 発生日時 |
| 操作者 | 実行したエージェント |
| 操作種別 | 何をしたか |
| 対象 | タスクID、エージェントID等 |
| 変更前 | 変更前の状態 |
| 変更後 | 変更後の状態 |
| 関連タスク | 紐づくタスク（あれば） |

---

## 閲覧UI

- 初期実装は実装しやすい形式で
- フィルタリング等は必要に応じて追加

---

## 保持・アーカイブ

- データサイズを考慮してアーカイブ仕組みを検討
- 検討事項:
  - アーカイブ条件（期間？サイズ？）
  - アーカイブ先（別DB？ファイル？）
  - アーカイブ済みデータの閲覧可否
