# タスク (Task) 仕様

## 定義
エージェントが行うすべての行動を可視化・管理する単位。

## 基本原則
- エージェントの全行動をタスクとして管理
- 自分自身へのアサインも可能（セルフアサイン）
- 他エージェントへのアサインも可能（上位→下位）

---

## 属性
| 属性 | 説明 |
|------|------|
| タイトル | タスクの概要 |
| 説明 | 詳細な内容 |
| 状態 | 現在のステータス |
| アサイン先 | 担当エージェント |
| 作成者 | タスクを作成したエージェント |
| 依存タスク | 先行して完了すべきタスク群 |
| 優先度 | urgent / high / medium / low |

---

## 状態遷移

```
backlog → todo → in_progress → done
                      ↓
                  cancelled
```

| 状態 | 説明 |
|------|------|
| backlog | 未着手（いつかやる） |
| todo | 着手予定（次にやる） |
| in_progress | 作業中 |
| done | 完了 |
| cancelled | 破棄（履歴として残る） |

### cancelled について
- 履歴管理上、削除ではなく状態として残す
- エージェントの行動判断に影響（破棄されたタスクは着手しない）
- 破棄理由も記録すべき？

---

## タスク間の依存関係

### 構造
- **DAG（有向非巡回グラフ）** を想定
- 複数の先行タスクを持てる
- 循環依存は禁止

```
[タスクA] ──→ [タスクC] ──→ [タスクD]
[タスクB] ──↗
```

### 依存関係の遵守
- **アプリで強制ブロック**
- 先行タスクが done になるまで in_progress に移行不可
- MCP経由の状態変更もブロック対象

### リソース可用性の遵守
- **アプリで強制ブロック**
- アサイン先エージェントの並列実行可能数を超える場合、in_progress に移行不可

### 可視化
- 初期実装はシンプルに（依存先タスク名の表示程度）
- グラフ表示等は将来検討

---

## 設計方針

### サブタスク
- **初期実装では不要**
- 依存関係のみでタスク間の関係を表現
- 必要になれば後から追加

### タスクの粒度
- 主観的な「大きい/小さい」の区別はない
- 依存関係の設定で構造が決まる

### blocked状態
- **採用決定**: 依存タスク未完了時に blocked として表示
- in_progress への遷移がブロックされている状態を明示
- UIではBlockedカラムとして表示

---

## エージェント行動のタスク化

### 課題
エージェントの行動を自動的にタスクとして記録・管理する仕組みの設計が必要。

### 監査チーム構想
- プロジェクトチームとは独立した「監査チーム」エージェントグループ
- エージェントの行動がアプリ要件に合致するかを監視・強制
- 要件違反の検出と是正

```
[プロジェクトチーム]          [監査チーム]
 ├─ エージェントA               ├─ 監査エージェント
 ├─ エージェントB       ←監視─  └─ ...
 └─ エージェントC
        │
        └─ 行動 → タスク化 → 要件チェック
```

※ 詳細設計が必要な領域
