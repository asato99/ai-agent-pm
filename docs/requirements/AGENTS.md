# エージェント (Agent) 仕様

## 定義
アプリ内で権限や役割を割り当てられる存在。
AI（Claude Code, Gemini等）や人間を区別なく扱う抽象概念。

## 属性
| 属性 | 説明 |
|------|------|
| 名前 | エージェントの識別名 |
| 種別 | AI / 人間 |
| 紐付け先 | AI種別（Claude, Gemini等）または人間の識別子 |
| 役割 | 担当領域（例: フロントエンド、バックエンド、レビュー） |
| 権限 | 操作可能な範囲 |
| 並列実行可能数 | 同時に in_progress にできるタスク数 |

---

## エージェント間の依存関係

### 構造
- **ツリー構造**（上下関係）
- 親エージェント（上位） → 子エージェント（下位）

### 上位エージェントの責務
1. **タスクのアサイン**: 下位エージェントにタスクを割り当てる
2. **活動のキック**: 下位エージェントの作業を開始させる（トリガー）
3. **報告の受領**: 下位エージェントからの完了/失敗報告を受け取る

### 下位エージェントの責務
1. **タスクの実行**: アサインされたタスクを遂行
2. **報告**: タスクの完了または失敗を上位エージェントに報告

```
[上位エージェント]
    │
    ├── タスクアサイン ──→ [下位エージェント]
    │                           │
    ├── 活動キック ────→        │
    │                           │
    ←── 完了/失敗報告 ─────────┘
```

---

## 活動のキック

### 概要
上位エージェントが下位エージェントの作業を開始させる仕組み。

### 実装候補（要検証）
| 方式 | 対象 | 備考 |
|------|------|------|
| CLI起動 | Claude Code | `claude` コマンドでの起動 |
| API呼び出し | Gemini等 | 各AIのAPI経由 |
| 通知 | 人間 | メール/Slack等 |

### 状態確認
- 上位エージェント自身がMCP経由で下位の状態を確認可能
- 下位からの能動的な報告は必須ではない

---

## 依存関係の構造

- **初期実装**: ツリー構造（単一の親）
- **将来検討**: DAG（複数の親）も視野に

---

## プロジェクト参加

- 1エージェントが複数プロジェクトに参加可能

---

## リソース可用性

### 初期実装
- **並列実行可能数**をエージェントごとに設定
- in_progress 状態のタスク数が上限に達したらロック

```
例:
  エージェントA: 並列数 = 1 → 1タスクのみ in_progress 可
  エージェントB: 並列数 = 3 → 3タスクまで同時 in_progress 可
```

### ロックの動作
- in_progress への状態変更時にチェック
- 上限到達時は状態変更をブロック

### 将来検討
- タスクの重さ・種類による制御
- 実際の処理状態（待ち/実行中）の反映
- 稼働時間帯の設定（人間向け）
